ASSEMBLING KI-10 VERSION
BSUBTTLDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1
FORSE.MAC	26-JUL-84 01:16		DATA BASE FOR FORTRAN OPERATING SYSTEM

BC				SUBTTL	DATA BASE FOR FORTRAN OPERATING SYSTEM
BC				;	V31/01	22-FEB-72	/DLH
BC				;	V31(215)	25-JUN-71	/DMN
BC
BC				;COPYRIGHT 1971, DIGITAL EQUIPMENT CORP. MAYNARD,MASS.,U.S.A.
BC
BDECSPEC			000032	DECSPEC==32                             ;DEC VERSION NUMBER
BTYMSPEC			000002	TYMSPEC==2                              ;TYMSHARE SPEC NUMBER
BDECRELC			000000	DECREL==0                               ;DEC RELEASE NUMBER
BTYMRELC			000074	TYMREL==74
BC
BENTRYFORSE.C				ENTRY	FORSE.
BFORSE.C	000000'			FORSE.:	
BC
BMLONC					MLON
BC
BC				;SET UP UUO HANDLER
BC
BLOCC	000041				LOC	41
BJSRUUOH.C	000041	264000	002076'		JSR	UUOH.
BRELOCC	000000'				RELOC	0
BC
BC				;COMPREHENSIVE LIB40 VERSION NUMBER
BC
BLOCC	000137				LOC	137
BDECSPETYMSPEDECRELTYMRELC	000137	032002	000074		<DECSPEC>B8+<TYMSPEC>B17+<DECREL>B26+TYMREL
BRELOCC	000000'				RELOC	0
BC
BC
BLINWDSC			000200	LINWDS==^D128
BDYDVL.C			000020	DYDVL.==20		;LENGTH OF DYNAMIC DEVICE TABLE
BVAR.C			000100	VAR.==100		;PUSHDOWN STACK LENGTH
BC
BERRLN.C			000020	ERRLN.==20		;LENGTH OF ERROR TABLE
BLENGTHC			000024	LENGTH==24		;LENGTH OF FORTRAN PD LIST FOR SUBROUTINE CALLS
BC
BDMPIO.IOWDC	000000'	777600	777777'	DMPIO.:	IOWD	200,.		;DUMP MODE I/O LIST FOR RANDOM ACCESS
BZC	000001'	000000	000000		Z			;END OF LIST
BLBPTRPOINTLINBUFC	000002'	440700	001517'	LBPTR:	POINT	7,LINBUF	;POINTER TO LINE BUFFER
BFOBPDPXWDVAR.VARPDPC	000003'	777700	001231'	FOBPDP:	XWD	-VAR.,VARPDP	;PDP TO STACK
BPDLST.XWDLENGTHC	000004'	777754	000004'	PDLST.:	XWD	-LENGTH,.
BBLOCKLENGTHC	000005'				BLOCK	LENGTH
BC
BSAVEACBLOCKC	000031'			SAVEAC:	BLOCK	20		;USER'S AC'S SAVED
BSAVFACBLOCKC	000051'			SAVFAC:	BLOCK	20		;OP SYS AC'S SAVED
BC
BINTERNFOBPDPSAVEACSAVFACC				INTERN	FOBPDP,SAVEAC,SAVFAC		;**V31/01** DEBUG & CHAIN
BINTERNVAR.ERRLN.DYDVL.RANDV.LEVEL.TNAME.OVPC.OVCNT.C				INTERN	VAR.,ERRLN.,DYDVL.,RANDV.,LEVEL.,TNAME.,OVPC.,OVCNT.
BINTERNBLOCK.ASVAR.INCNT.INIT.LINK.KA10.C				INTERN	BLOCK.,ASVAR.,INCNT.,INIT.,LINK.,KA10.
BINTERNEOL.TCNT1.TCNT2.ONLY1.EOFFL.DELIM.ILLEG.C				INTERN	EOL.,TCNT1.,TCNT2.,ONLY1.,EOFFL.,DELIM.,ILLEG.
BINTERNTPNTR.DEVNO.OVFLS.EOFFL.DVNUM.DEVIC.TYPE.TPNTR.C				INTERN	TPNTR.,DEVNO.,OVFLS.,EOFFL.,DVNUM..,DEVIC.,TYPE.,TPNTR.
BINTERNTEMP.DYNND.FMTEN.FMTBG.INCNT.MBFBG.PDLST.TABP1.DATTB.C				INTERN	TEMP.,DYNND.,FMTEN.,FMTBG.,INCNT.,MBFBG.,PDLST.,TABP1.,DATTB.
BINTERNFILE1.FILE2.FILE3.FILE4.FILE5.UNITC.FILPS.FILSZ.FNM.C				INTERN  FILE1.,FILE2.,FILE3.,FILE4.,FILE5.,UNITC.,FILPS.,FILSZ.,FNM.
BINTERNBUFHD.DYNDV.DYNCH.DYPNT.DYCHR.DYEND.DEVNO.TYPE.OVFLS.DFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-2
FORSE.MAC	26-JUL-84 01:16		DATA BASE FOR FORTRAN OPERATING SYSTEM

BC				INTERN	BUFHD.,DYNDV.,DYNCH.,DYPNT.,DYCHR.,DYEND.,DEVNO.,TYPE.,OVFLS.
BINTERNRERDV.INPDV.MTABF.REE.TRAPF.DSESC.C				INTERN	RERDV.,INPDV.,MTABF.,REE.,TRAPF.,DSESC.
BC				;GLOBALS USED BY ERROR PRINTER
BINTERNERRTB.ERRMX.DAYTM.ERRCT.XCTTM.C				INTERN	ERRTB.,ERRMX.,DAYTM.,ERRCT.,XCTTM.
BC				;GLOBALS REFERENCED BY COMPILER (F40)
BINTERNEND.ERR.RANAC.RECNO.VADDR.FNM.RLEN.C				INTERN	END.,ERR.,RANAC.,RECNO.,VADDR.,FNM.,RLEN.
BC				; THE FOLLOWING BLOCK FROM ALPHA. TO OMEGA. GETS CLEARED BY RESET
BC				;A SUBSET OF WHICH GETS CLEARED DURING FIN. UUO (INIFLG-INPDEV)
BC
BALPHA.C	000071'			ALPHA.:
BDEVNO.BLOCKC	000071'			DEVNO.:	BLOCK	1		; HIGHEST DEVICE NUMBER
BINIFLGBLOCKC	000072'			INIFLG:	BLOCK	1		; INITIALIZATION FLAG
BILLEG.BLOCKC	000073'			ILLEG.:	BLOCK	1		;ILL. CHAR. FLAG
BHDRADDBLOCKC	000074'			HDRADD:	BLOCK	1		; ADDRESS OF REAL HEADER IF LINE
BC								;BUFFER IN USE...ALSO LINE BUF. FLAG
BTEMP.BLOCKC	000075'			TEMP.:	BLOCK	6		;DIRECTORY NAME,EXT,PPN BLOCK
BUSRNAMBLOCKC	000103'			USRNAM:	BLOCK	2		;USER NAME FOR DIRECTORY BLOCK
BEDERRBLOCKC	000105'			EDERR:	BLOCK	1		;++ ENCODE - DECODE ERROR FLAG
BVADDR.BLOCKC	000106'			VADDR.:	BLOCK	1		;++ENCODE DECODE
BDECFLGBLOCKC	000107'			DECFLG:	BLOCK	1		;**V31/01**MONEY*
BINPDEVBLOCKC	000110'			INPDEV:	BLOCK	1		;-1 IF AN ASCII INPUT DEVICE
BOVFLS.BLOCKC	000111'			OVFLS.:	BLOCK	1		;LINE OVERFLOW SWITCH
BINPDV.BLOCKC	000112'			INPDV.:	BLOCK	1		;ASCII INPUT DEVICE USED LAST
BDVNUM.BLOCKC	000113'			DVNUM.:	BLOCK	1		;FOR "BUFFER"
BOPNDEVBLOCKC	000114'			OPNDEV:	BLOCK	1		;DEVICE TO USE FOR OPEN STATEMENT
BFNM.BLOCKC	000115'			FNM.:	BLOCK	1		;ADDRESS OF FILE NAME IN OPEN STATEMENT
BFNMCNTBLOCKC	000116'			FNMCNT:	BLOCK	1		;NUMBER OF CHARACTERS IN FILE NAME
BRLEN.BLOCKC	000117'			RLEN.:	BLOCK	1		;RECORD LENGTH IN OPEN STATEMENT
BEND.BLOCKC	000120'			END.:	BLOCK	1		;FOR END OF FILE ON INPUT
BERR.BLOCKC	000121'			ERR.:	BLOCK	1		;FOR ILLEGAL CHAR ON INPUT
BDSESC.BLOCKC	000122'			DSESC.: BLOCK   1               ;-1 IF ESCAPES DISABLED BY PROGRAM
BESCCLRBLOCKC	000123'			ESCCLR:	BLOCK	1		;LOCATION TO CLEAR I/O IF TRAP IN FORSE
BTRAPF.BLOCKC	000124'			TRAPF.:	BLOCK	1		;NUMBER OF TRAPS SET (ESCAPE OR TRU)
BTRPLOCBLOCKC	000125'			TRPLOC:	BLOCK	1		;TRAP ROUTINE LOCATION TO GO TO AT FORSE END
BNRMESCBLOCKC	000126'			NRMESC:	BLOCK	1		;SAVE NORMAL ESCAPE TRAP LOCATION
BNRMTRUBLOCKC	000127'			NRMTRU:	BLOCK	1		;SAVE NORMAL TRU TRAP LOCATION
BSXBTNOBLOCKC	000130'			SXBTNO:	BLOCK	1		;6-BIT F4 DEVICE # FOR INITS
BFILNUMBLOCKC	000131'			FILNUM:	BLOCK	1		;FOR FILENAME
BLINK.BLOCKC	000132'			LINK.:	BLOCK	1		;LINK TO CHAIN OF RECLAIMED BUFFERS
BTNAME.BLOCKDYDVL.C	000133'			TNAME.:	BLOCK	DYDVL.*2	;FILE NAME ENTRIES
BONLY1.BLOCKDYDVL.C	000173'			ONLY1.:	BLOCK	DYDVL.		;-1 IF EOF SKIPPED, ONE FLG /CHN
BEOFFL.BLOCKDYDVL.C	000213'			EOFFL.:	BLOCK	DYDVL.		;-1 IF EOFTST PROGRAM CALLE ON CHANNEL
BPAKFL.BLOCKDYDVL.C	000233'			PAKFL.:	BLOCK	DYDVL.		;-1 IF PACKED I/O WAS DONE ON CHANNEL
BC				;*** PART OF I/O CONSISTENCY CHECKING PATCH *** [TJB 3-4-82]
BC				;TYPFL.:
BC				;	BLOCK	DYDVL.		;RH: -1 IF SEQUENTIAL, 1 IF RANDOM, 0 UNUSED
BC				;				;LH: -1 IF INPUT, 1 IF OUTPUT, 0 DON'T CARE
BC				;*** END PART OF I/O CONSISTENCY PATCH ***
BBUFSZ.BLOCKDYDVL.C	000253'			BUFSZ.:	BLOCK	DYDVL.		;NO. OF BUFFERS,, BUFFER SIZE
BINCNT.BLOCKDYDVL.C	000273'			INCNT.:	BLOCK	DYDVL.		;COUNT OF #OF INPUT UUOS DONE ON EACH CHAN
BDYNDV.BLOCKDYDVL.C	000313'			DYNDV.:	BLOCK	DYDVL.		;DYNAMIC DEVICE TABLE
BDYNDV.DYDVL.DYNND.C			000332'	DYNND.=DYNDV.+DYDVL.-1		;V.007  PTR TO LAST DYNDV. ENTRY
BDYNCH.BLOCKDYDVL.C	000333'			DYNCH.:	BLOCK	DYDVL.		;BLOCK OF DEVICE CHARACTERISTICS
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-3
FORSE.MAC	26-JUL-84 01:16		DATA BASE FOR FORTRAN OPERATING SYSTEM

BC								;LH=LH OF DEVCHR
BC								;RH=F4 DEVICE NUMBER SPECIFIED IN USER PROGRAM
BRANDV.BLOCKDYDVL.C	000353'			RANDV.:	BLOCK	DYDVL.		;
BRLBNOBLOCKDYDVL.C	000373'			RLBNO:	BLOCK	DYDVL.		;NUMBER OF LAST BLOCK IN RANDOM FILE
BRLBSIZBLOCKDYDVL.C	000413'			RLBSIZ:	BLOCK	DYDVL.		;NUMBER OF ELEMENTS IN LAST BLOCK IN FILE
BRANBMBLOCKDYDVL.C	000433'			RANBM:	BLOCK	DYDVL.		;IS CURRENT BUFFER INPUT OR OUTPUT
BFILPS.BLOCKC	000453'			FILPS.:	BLOCK	40		;CURRENT FILE POSITION
BFILSZ.BLOCKC	000513'			FILSZ.:	BLOCK	40		;CURRENT FILE SIZE
BUNITC.BLOCKC	000553'			UNITC.:	BLOCK	40		;CHARACTERISTICS OF F4 UNIT (MODE,ACCESS,ETC.)
BFILE1.BLOCKC	000613'			FILE1.:	BLOCK	40		;RECORD VARIABLE ADDRESS
BFILE2.BLOCKC	000653'			FILE2.:	BLOCK	40		;RECORD SIZE
BFILE3.BLOCKC	000713'			FILE3.:	BLOCK	40		;PPN
BFILE4.BLOCKC	000753'			FILE4.:	BLOCK	40		;EXTENSION
BFILE5.BLOCKC	001013'			FILE5.:	BLOCK	40		;FILE NAME
BTTYUN.BLOCKC	001053'			TTYUN.:	BLOCK	40		;-1 IF UNIT IS TTY, 0 OTHERWISE
BENCHDRBLOCKC	001113'			ENCHDR:	BLOCK	3		;++ ENCODE 'BUFFER' HEADER
BDECHDRBLOCKC	001116'			DECHDR:	BLOCK	3		;++ DECODE 'BUFFER' HEADER
BMTANUMC			000010	MTANUM==^D8			;NUMBER OF MTA UNITS
BMTABF.BLOCKMTANUMC	001121'			MTABF.:	BLOCK	MTANUM		;FOR MAGDEN
BDATTB.BLOCKC	001131'			DATTB.:	BLOCK	100		;CONTIGUOUS TABLES REQUIRED
BVARPDPBLOCKVAR.C	001231'			VARPDP:	BLOCK	VAR.		;PUSHDOWN STACK
BLASTLPBLOCKC	001331'			LASTLP:	BLOCK	1		;POINTER TO LAST ( IN FORMAT
BFMTEN.BLOCKC	001332'			FMTEN.:	BLOCK	1		;POINTER TO END OF FORMAT
BFMTBG.BLOCKC	001333'			FMTBG.:	BLOCK	1		;POINTER TO BEG. OF FORMAT
BEOL.BLOCKC	001334'			EOL.:	BLOCK	1		;END OF LINE FLA COLUMN COUNT
BDADDR.BLOCKC	001335'			DADDR.:	BLOCK	1		;ADDRESS OF DATUM BEING CONVERTED
BBUFHD.BLOCKDYDVL.C	001336'			BUFHD.:	BLOCK	DYDVL.*6	;BUFFER HEADERS
BDEVIC.BLOCKC	001476'			DEVIC.:	BLOCK	1		;DEVICE NAME SAVED
BDNAMEBLOCKC	001477'			DNAME:	BLOCK	1		;DEVICE NAME ADDR
BRERDV.BLOCKC	001500'			RERDV.:	BLOCK	1		;REREAD DEVICE NAME SAVED
BRERDN.BLOCKC	001501'			RERDN.:	BLOCK	1		;REREAD DEVICE NUMBER SAVED
BDEVNAMBLOCKC	001502'			DEVNAM:	BLOCK	1		;DEVICE NAME SAVED
BTYPE.BLOCKC	001503'			TYPE.:	BLOCK	1		;CODE FOR DATA TYPE
BTPNTR.BLOCKC	001504'			TPNTR.:	BLOCK	1		;SAVED POINTER FOR T FORMAT
BTCNT1.BLOCKC	001505'			TCNT1.:	BLOCK	1		;SAVED VALUE OF EOL FOR T FORMAT
BTCNT2.BLOCKC	001506'			TCNT2.:	BLOCK	1		;SAVED ITEM COUNT FOR T FORMAT
BRPTR1BLOCKC	001507'			RPTR1:	BLOCK	1		;POINTER TO BEG. OF PREV. LINE
BRPTR2BLOCKC	001510'			RPTR2:	BLOCK	1		;POINTER TO BEG. OF CURRENT LINE
BRCNT1BLOCKC	001511'			RCNT1:	BLOCK	1		;ITEM COUNT,PREV. LINE
BRCNT2BLOCKC	001512'			RCNT2:	BLOCK	1		;ITEM COUNT,CURRENT LINE
BRINC1BLOCKC	001513'			RINC1:	BLOCK	1		;POSITION OF BLOCK IN FILE OF PREV LINE
BRINC2BLOCKC	001514'			RINC2:	BLOCK	1		;POSITION OF BLOCK IN FILE OF CURRENT LINE
BNRMEM.BLOCKC	001515'			NRMEM.:	BLOCK	1		;-1 IF NO MEMORY RELEASE ON BUFFER RETURN
BCLSBITBLOCKC	001516'			CLSBIT:	BLOCK	1		;CLOSE BITS FOR FILE RELEASE
BLINBUFBLOCKLINWDSC	001517'			LINBUF:	BLOCK	LINWDS		;LINE BUFFER
BLINHDRBLOCKC	001717'			LINHDR:	BLOCK	3		;HEADER FOR LINE BUFFER
BSAVSCNBLOCKC	001722'			SAVSCN:	BLOCK	1		;POINTER TO POSN BEFORE ILDB FOR RESCAN
BDIGPTRBLOCKC	001723'			DIGPTR:	BLOCK	1		;POINTER TO DIGIT IN FORMAT
BGRPRPTBLOCKC	001724'			GRPRPT:	BLOCK	1		;GROUP REPEAT SAVE FOR FORMAT RESCAN
BFRPTC.BLOCKC	001725'			FRPTC.:	BLOCK	1		;COUNT OF REPEAT IN FORMAT SCAN
BDELIM.BLOCKC	001726'			DELIM.:	BLOCK	1
BINIT.BLOCKC	001727'			INIT.:	BLOCK	3		;DATA FOR OPEN AND DEVSIZ UUOS
BERRTB.BLOCKERRLN.C	001732'			ERRTB.:	BLOCK	ERRLN.		;TABLE FOR ERROR MESSAGE COUNTS AND ADDRESSES
BERRMX.BLOCKDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-4
FORSE.MAC	26-JUL-84 01:16		DATA BASE FOR FORTRAN OPERATING SYSTEM

BC	001752'			ERRMX.:	BLOCK	1		;MAXIMUM # OF ERRORS OF A TYPE
BDAYTM.BLOCKC	001753'			DAYTM.:	BLOCK	1		;SAVE TIME OF DAY AT START
BERRCT.BLOCKC	001754'			ERRCT.:	BLOCK	1		;COUNT OF PRINTED ERRORS
BXCTTM.BLOCKC	001755'			XCTTM.:	BLOCK	1		;SAVE TOTAL EXECUTION TIME AT START
BWDPRECBLOCKC	001756'			WDPREC:	BLOCK	1		;WORDS PER RECORD
BRECNO.BLOCKC	001757'			RECNO.:	BLOCK	1		;RECORD IN FILE TO BE ACCESSED
BRANAC.BLOCKC	001760'			RANAC.:	BLOCK	1		;-1 = DIRECT ACCESSING, 0= NOT
BBLOCK.BLOCKC	001761'			BLOCK.:	BLOCK	1		;BLOCK # FOR USETI
BCHARS.BLOCKC	001762'			CHARS.:	BLOCK	1		;CHARS IN BUFFER UNTIL RECORD STARTS
BWORDS.BLOCKC	001763'			WORDS.:	BLOCK	1		;WORDS IN BUFFER UNTIL RECORD STARTS
BASVAR.BLOCKC	001764'			ASVAR.:	BLOCK	1		;INTERNAL VALUE OF ASSOCIATED VARIABLE
BITMCNTBLOCKC	001765'			ITMCNT:	BLOCK	1
BLEVEL.BLOCKC	001766'			LEVEL.:	BLOCK	1		;0 FOR LEVEL C , -2 FOR LEVEL D
BKA10.BLOCKC	001767'			KA10.:	BLOCK	1		;0 IF KI10, #0 IF KA10
BOVPC.BLOCKC	001770'			OVPC.:	BLOCK	1		;PC WORD WHEN TRAP OCCURS
BOVCNT.BLOCKC	001771'			OVCNT.:	BLOCK	1		;COUNT OVERFLOWS
BTTYCH.BLOCKC	001772'			TTYCH.:	BLOCK	1		; *266* TTY CHANNEL NUMBER
BDYPNT.BLOCKC	001773'			DYPNT.:	BLOCK	1		; *352* DEVICE CHANNEL POINTER
BREE.BLOCKC	001774'			REE.:	BLOCK	2		; *420* FOR REENTER ADDRESS
BDYCHR.BLOCKC	001776'			DYCHR.:	BLOCK	<77+6+8>/9	; *352* CHANNEL VS. DEVICE# TABLE 4-BIT.
BDYEND.C			002006'	DYEND.=.
BDYEND.DYCHR.ZZZC			000010	ZZZ==DYEND.-DYCHR.
BPAT.BLOCKDYDVL.ZZZC	002006'			PAT.:	BLOCK	DYDVL.*2+10-4-ZZZ	;PATCH SPACE
BOMEGA.C			002041'	OMEGA.==.-1
BC
BMTABF.MBFBG.C			001120'	MBFBG.==MTABF.-1		;USED BY
BMTABF.MTANUMTABP1.C			001131'	TABP1.==MTABF.+MTANUM		;MTABF.
BTABP1.TABPT.C			001130'	TABPT.==TABP1.-1		;ROUTINES
BC
BTITLEC				TITLE FORSE. 	 FORTRAN IV OPERATING SYSTEM 
BSUBTTLC				SUBTTL	V31(224)	30-JUN-71	/DMN
BC				;COPYRIGHT 1971, DIGITAL EQUIPMENT CORP. MAYNARD,MASS.,U.S.A.
BC
BC				;/SLG/SEARCH	DEF40		;TO GET RIGHT CPU
BC				;UNIVERSAL DEF40 PARAMETER FILE FOR FORTRAN IV LIBRARY 02/27/73
BSUBTTLC				SUBTTL	V32(412)	3-MAY-72	/TWE/DMN
BC				;***COPYRIGHT 1969,1970,1971,1972 DIGITAL EQUIPMENT CORP., MAYNARD, MASS.***
BC
BC				;*****CAUTION*****IF IT BECOMES NECESSARY TO CHANGE THIS FILE, THE
BC				;ANALOGOUS CODE IN FORSE.MAC MUST ALSO BE CHANGED. ... FORSE.MAC USED
BC				;TO SEARCH THIS FILE, BUT WAS MODIFIED TO INCLUDE THIS FILE /SLG/
BC
BIFNDEFPDP6C				IFNDEF PDP6,<IFNDEF KA10,<IFNDEF KI10,<KI10==1>>>
BIFNDEFPDP6C				IFNDEF PDP6,<PDP6==0>		;CONDITIONAL ASSEMBLY PARAMETERS
BIFNDEFKA10C				IFNDEF KA10,<KA10==0>
BIFNDEFKI10C				IFNDEF KI10,<KI10==0>
BIFNPDP6KA10KI10PDP6KA10KI10C				IFN <PDP6!KA10!KI10-PDP6-KA10-KI10>,
BC					<PRINTX MACHINE PARAMETERS DEFINED INCORRECTLY>
BC
BIF1C				IF1,<	;PRINT THE CPU FOR WHICH THIS VERSION IS BEING ASSEMBLED
BC				IFN PDP6,<PRINTX ASSEMBLING  PDP-6 VERSION>
BC				IFN KA10,<PRINTX ASSEMBLING KA-10 VERSION>
BC				IFN KI10,<PRINTX ASSEMBLING KI-10 VERSION>
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-5
FORSE.MAC	26-JUL-84 01:16		V32(412)	3-MAY-72	/TWE/DMN

BC				>
BC
BC
BC				;ACCUMULATOR ASSIGNMENTS
BAC			000000	A=0
BBC			000001	B=1
BCC			000002	C=2
BDC			000003	D=3
BEC			000004	E=4
BFC			000005	F=5
BGC			000006	G=6
BHC			000007	H=7
BC
BQC			000016	Q=16	;FOR JSA AND ARG ADDRESS FOR PUSHJ
BPC			000017	P=17	;PUSH DOWN POINTER
BC
BIFEKA10C				IFE KA10,<
BDEFINEDOUBLEC				DEFINE DOUBLE (A,B)<
BC					A
BC					B>
BC				>
BC
BIFNKA10C				IFN KA10,<
BC				DEFINE DOUBLE (A,B)<
BC				ZZ1.==A&<777000,,0>
BC				IFL ZZ1.,<ZZ1.==-ZZ1.-<1000,,0>>
BC				ZZ1.==ZZ1.-<033000,,0>
BC				IFE B,<ZZ1.==0>
BC				ZZ2.==ZZ1.+<<B+200>_-8>&<000777,,777777>
BC				IFL ZZ1.,<ZZ2.==0>
BC					A
BC					ZZ2.
BC				SUPPRESS ZZ1.,ZZ2.>
BC				DEFINE DMOVE(AC,M)<
BC					IFL <Z M>-<@>,<
BC					MOVE AC,M
BC					MOVE AC+1,1+M>
BC				
BC					IFGE <Z M>-<@>,<
BC					MOVEI AC+1,M
BC					MOVE AC,(AC+1)
BC					MOVE AC+1,1(AC+1)>
BC				>
BC				
BC				DEFINE	DMOVN(AC,M)<
BC					DMOVE AC,M
BC					DFN AC,AC+1>
BC				
BC				DEFINE DMOVEM(AC,M)<
BC					MOVEM AC,M
BC					MOVEM AC+1,1+M
BC				>
BC				
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-6
FORSE.MAC	26-JUL-84 01:16		V32(412)	3-MAY-72	/TWE/DMN

BC				DEFINE FLMUL (AC,M,%OV)<
BC					MOVEM AC,AC+2
BC					FMPR AC+2,1+M
BC					JFCL (2)
BC					FMPR AC+1,M
BC					JFCL (2)
BC					UFA AC+1,AC+2
BC					JFCL
BC					FMPL AC,M
BC					JOV %OV
BC					UFA AC+1,AC+2
BC					FADL AC,AC+2
BC				%OV: >
BC				
BC				DEFINE FLDIV(AC,M,%OV)<
BC					FDVL AC,M
BC					JOV %OV
BC					MOVN AC+2,AC
BC					FMPR AC+2,1+M
BC					JFCL (2)
BC					UFA AC+1,AC+2
BC					FDVR AC+2,M
BC					JFCL
BC					FADL AC,AC+2
BC				%OV: >
BC				
BC				DEFINE FLADD(AC,M,%OV)<
BC					UFA AC+1,1+M
BC					FADL AC,M
BC					JOV %OV
BC					UFA AC+1,AC+2
BC					FADL AC,AC+2
BC				%OV: >
BC				
BC				>	;END OF KA10 CONDITIONAL
BIFNKI10C				IFN KI10,<
BOPDEFDFADFLADDC				OPDEF	FLADD	[DFAD]
BOPDEFDFMPFLMULC				OPDEF	FLMUL	[DFMP]
BOPDEFDFDVFLDIVC				OPDEF	FLDIV	[DFDV]
BC
BDEFINEDFNC				DEFINE DFN (A,B)<	DMOVN A,A
BC				IFN < <A+1>&17-<B>>,<PRINTX "DMOVN A,A" CAN'T REPLACE "DFN A,B">
BC				>
BC				>	;END OF KI10 CONDITIONAL
BC
BC
BC
BC
BC				;REENT==1 GIVES RE-ENTRANT FORTRAN OP SYSTEM /DMN
BIFNDEFREENTC				IFNDEF REENT,<REENT==0>
BIFNREENTC				IFN REENT,<	HISEG	>
BC
BC
BIFEREENTIFNDEFFORSE.DFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-7
FORSE.MAC	26-JUL-84 01:16		V32(412)	3-MAY-72	/TWE/DMN

BC				IFE REENT,<IFNDEF FORSE.,<PRINTX ASSEMBLE WITH EITHER DATBS OR HPAR>>
BC
BC
BC				;POSSIBLE SPR FIXES NOT YET WORKING %XXX WHERE XXX IS CCO NUMBER
BC
BIFNDEF%352C				IFNDEF %352,<%352==0		;FIX FOR CHANNEL ASSIGNMENT BUG>
BSUBTTLC				SUBTTL	GLOBAL SYMBOLS
BC
BC
BENTRYBINWR.C				ENTRY		BINWR.
BEXTERNDUMER.C				EXTERN	DUMER.			;**V31/01** CHAIN
BSEXTERCHNIN.CHAIN.C				SEXTERN	CHNIN.,CHAIN.			;**V31/01** CHAIN
BSEXTERINIACTC				SEXTERN	INIACT			;ACCTG CHG
BEXTERNDEBUG.NXTCT.FRSTM.NXTFL.TRPFL.C				EXTERN	DEBUG.,NXTCT.,FRSTM.,NXTFL.,TRPFL.	;**V31/01**DEBUG*
BEXTERN.JBFF.JBREL.JBUUO.JBRENC				EXTERNAL	.JBFF,.JBREL,.JBUUO,.JBREN
BEXTERNERROR.LOGEN.ILLCH.INIER.DEVER.TBLER.MSNG.NOROM.C				EXTERNAL	ERROR.,LOGEN.,ILLCH.,INIER.,DEVER.,TBLER.,MSNG.,NOROM.
BEXTERNLISTB.REDER.ENDTP.ILUUO.BPHSE.ILLMG.ILLFN.ILLPS.C				EXTERNAL	LISTB.,REDER.,ENDTP.,ILUUO.,BPHSE.,ILLMG.,ILLFN.,ILLPS.
BEXTERNDEVTB.IOADR.DEVND.ILRED.PARER.BTLER.AROPN.C				EXTERNAL	DEVTB.,IOADR.,DEVND.,ILRED.,PARER.,BTLER.,AROPN.
BEXTERNWLKER.NMLST.TFMT.TPFCN.BUFER.RANER.FMTER.C				EXTERNAL	WLKER.,NMLST.,TFMT.,TPFCN.,BUFER.,RANER.,FMTER.
BEXTERNNEG1.NEG2.NEG3.NEG5.DVTOT.EXITP.C				EXTERNAL	NEG1.,NEG2.,NEG3.,NEG5.,DVTOT.,EXITP.
BEXTERNERRIN.TRPIN.INTAB.C				EXTERNAL	ERRIN.,TRPIN.,INTAB.
BIFNREENTC				IFN REENT,<	ENTRY	UUOP.>
BIFEREENTINTERNUUOL.UUOH.C				IFE REENT,<INTERN	UUOL.,UUOH.>
BINTERNDEPOT.CHINN.IIB.ENDLN.INP.INPT.C				INTERN		DEPOT.,CHINN.,IIB.,ENDLN.,INP.,INPT.
BINTERNXIO.OUTT.RIN.CLOS.FI.FNCTN.CLRSY.C				INTERN		XIO.,OUTT.,RIN.,CLOS.,FI.,FNCTN.,CLRSY.
BINTERNCLROU.LOOK.CLOSI.SETOU.STAT.SESTA.C				INTERN		CLROU.,LOOK.,CLOSI.,SETOU.,STAT.,SESTA.
BINTERNNXTCR.NXTLN.WAIT.BUFCA.INP.IORTR.EOFTS.C				INTERN		NXTCR.,NXTLN.,WAIT.,BUFCA.,INP.,IORTR.,EOFTS.
BINTERNUSETI.USETO.FCM1.GETDV.C				INTERN		USETI.,USETO.,FCM1.,GETDV.
BINTERNMTPZ.IOERR.C				INTERN		MTPZ.,IOERR.
BINTERNDYDVL.DISAB.ENAB.C				INTERN		DYDVL.,DISAB.,ENAB.
BIFNREENTC				IFN REENT,<
BC				EXTERNAL	ASVAR.,BLOCK.,CHARS.,WORDS.,RANAC.,RECNO.
BC				EXTERNAL	ALPHA.,OMEGA.
BC				EXTERNAL	DYNND.,FILNUM,VADDR.,UUOL.,PDLST.
BC				EXTERN	FILE1.,FILE2.,FILE3.,FILE4.,FILE5.,UNITC.,FILPS.,FILSZ.
BC				EXTERNAL	EOL.,DADDR.,TCNT1.,TCNT2.,ONLY1.,EOFFL.
BC				EXTERNAL	TPNTR.,ILLEG.,DELIM.,INIT.
BC				EXTERNAL	TEMP.,UUOH.,DEVIC.,FMTEN.,FMTBG.,FRPTC.
BC				EXTERNAL	BUFHD.,DYNDV.,DYNCH.,DYPNT.,DYCHR.,DYEND.,DEVNO.,TYPE.,OVFLS.
BC				EXTERNAL	RERDV.,INPDV.,DVNUM.,END.,ERR.
BC				EXTERNAL	MTABF.,MBFBG.,TABPT.,TABP1.,DATTB.
BC				EXTERN	VAR.,DMPIO.,LEVEL.,RANDV.,WDPREC
BC				EXTERN	DECHDR,DEVNAM,DIGPTR,DNAME,EDERR,LINK.,RLINK.,BUFSZ.
BC				EXTERN	ENCHDR,FOBPDP,GRPRPT,HDRADD,INCNT.,INIFLG,INPDEV
BC				EXTERN	LASTLP,LINBUF,LINHDR,RCNT1,RCNT2,RERDN.
BC				EXTERN	RPTR1,RPTR2,SAVEAC,SAVFAC,SAVSCN,LBPTR
BC				EXTERN	PAKFL.,TNAME.,ITMCNT,TTYCH.,REE.
BC				>
BSUBTTLC				SUBTTL	  ;ACCUMULATORS
BAC			000001	A=1		;UTILITY
BBC			000002	B=2		;UTILITY
BCC			000003	C=3		;UTILITY
BDC			000004	D=4		;UTILITY
BEDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-8
FORSE.MAC	26-JUL-84 01:16		;ACCUMULATORS

BC			000005	E=5		;FORMAT DESCRIPTOR
BFC			000006	F=6		;FLAG REGISTER (USED IN I/O ROUTINES)
BMC			000007	M=7		;ADDR. OF BUFFER HEADER(RH);DEV. NO. (LH)
BHC			000010	H=10		;SLIST AOBJN WORD
BIC			000011	I=11		;FLAG REGISTER
BJC			000012	J=12		;NOT USED
BKC			000013	K=13		;FORMAT POINTER
BLC			000014	L=14		;PARENTHESIS COUNT
BGC			000015	G=15		;INPUT BUFFER HDR ADDR.(LH);DEV. NAME ADDR.(RH)
BNC			000016	N=16		;FLAGS IN LEFT
BPC			000017	P=17		;PUSHDOWN POINTER
BIFNREENTC				IFN REENT,<LOW=16>
BIFEREENTLOWC			000000	IFE REENT,<LOW=0>
BC
BC					;UUO DEFINITIONS
BC
BOPDEFFLIST.C				OPDEF	FLIST.	[07B8]
BOPDEFFNM.C				OPDEF	FNM.	[10B8]
BOPDEFOPE.C				OPDEF	OPE.	[11B8]
BOPDEFPOS.C				OPDEF	POS.	[12B8]
BC				;*********DEBUG & CHAIN PATCH****28-FEB-72****V31/01******************
BOPDEFCHN.C				OPDEF	CHN.	[13B8]
BOPDEFSTL.C				OPDEF	STL.	[14B8]
BC				;********************END OF PATCH***************************************
BOPDEFRESET.C				OPDEF	RESET.	[15B8]
BOPDEFIN.C				OPDEF	IN.	[16B8]
BOPDEFOUT.C				OPDEF	OUT.	[17B8]
BOPDEFDATA.C				OPDEF	DATA.	[20B8]
BOPDEFFIN.C				OPDEF	FIN.	[21B8]
BOPDEFRTB.C				OPDEF	RTB.	[22B8]
BOPDEFWTB.C				OPDEF	WTB.	[23B8]
BOPDEFMTOP.C				OPDEF	MTOP.	[24B8]
BOPDEFSLIST.C				OPDEF	SLIST.	[25B8]
BOPDEFINF.C				OPDEF	INF.	[26B8]
BOPDEFOUTF.C				OPDEF	OUTF.	[27B8]
BOPDEFRERED.C				OPDEF	RERED.	[30B8]
BOPDEFNLI.C				OPDEF	NLI.	[31B8]
BOPDEFNLO.C				OPDEF	NLO.	[32B8]
BOPDEFDEC.C				OPDEF	DEC.	[33B8]
BOPDEFENC.C				OPDEF	ENC.	[34B8]
BOPDEFFCALL.C				OPDEF	FCALL.	[35B8]
BC
BOPDEFPUSHJPERRORC				OPDEF	ERROR	[PUSHJ	P,]	;NEVER RETURNS
BOPDEFJRSTPJRSTC				OPDEF	PJRST	[JRST]		;POPJ RETURN AT JUMP
BOPDEFCALLIDEVTYPC				OPDEF	DEVTYP	[CALLI 53]	;OBSOLETE UUO - ALWAYS FAILS
BOPDEFCALLIDEVSIZC				OPDEF	DEVSIZ	[CALLI	101]
BMLONC						MLON
BC
BC				    ;PARAMETER ASSIGNMENTS
BC
BLSTBYTC			000001	LSTBYT==1		;++ LAST BYTE POSN
BDQC			000042	DQ==42			;DOUBLE QUOTE
BSLC			000017	SL==17			;SLASH(SIXBIT)
BLFDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-9
FORSE.MAC	26-JUL-84 01:16		;ACCUMULATORS

BC			000012	LF==12			;LINE FEED
BVTC			000013	VT==13			;VERTICAL TAB
BFFC			000014	FF==14			;FORM FEED
BCRC			000015	CR==15			;CARRIAGE RETURN
BLINWDSLINCHC			001177	LINCH==5*LINWDS-1	;NO. OF CHARACTERS IN LINE BUFFER
BDYDVL.C			000020	DYDVL.==20		;LENGTH OF DYNAMIC DEVICE TABLE
BESCC			000175	ESC==175		;**V31/01**ESCAPE*
BC
BC				;DEVCHR BITS
BC
BDSKBITC			200000	DSKBIT==(1B1)		;DSK
BCRDBITC			100000	CRDBIT==(1B2)		;CARD I/O
BLPTBITC			040000	LPTBIT==(1B3)		;LPT
BUSRTTYC			020000	USRTTY==(1B4)		;TTY IS USER'S CONSOL
BAVABITC			000040	AVABIT==(1B12)		;DEVICE IS AVAILABLE
BMTABITC			000020	MTABIT==(1B13)		;MTA
BTTYBITC			000010	TTYBIT==(1B14)		;TTY
BDIRBITC			000004	DIRBIT==(1B15)		;DEVICE HAS A DIRECTORY
BC
BC				;FLAGS STORED IN RIGHT OF DYNCH.
BC
BASSCONC			400000	ASSCON==1B18		;ASSIGNED BY CONSOL
BDFLBITC			200000	DFLBIT==1B19		;THIS DEVICE WAS A DEFAULT DEVICE (-1 TO -5)
BSPLBITC			100000	SPLBIT==1B20		;THIS DEVICE IS SPOOLED
BDMPBITC			040000	DMPBIT==1B21		;DEV. IS IN RANDOM ACCESS DUMP MODE
BC
BC				;DEVTYP BITS
BC
B.TYSPLC			000020	.TYSPL==(1B13)		;DEVICE IS SPOOLED TO DSK
BC
BC				;FLAGS IN LEFT OF N, PREVIOUSLY FULL WORDS
BC
BTTYFL.C			000001	TTYFL.==1		;TTY OR LPT
BCDSFL.C			000002	CDSFL.==2		;CARD I/O
BDOLFL.C			000004	DOLFL.==4		;NO CR AFTER TEXT
BRRDFL.C			000010	RRDFL.==10		;REREAD
BRDWFL.C			000020	RDWFL.==20		;FORMAT READ TO WRITE ATTEMPT
BENCFL.C			000040	ENCFL.==40		;ENCODE/DECODE
BSPLFL.C			000100	SPLFL.==100		;SPOOLING TO DSK FOR THIS DEVICE
BFKNFL.C			000200	FKNFL.==200		;DOING RANDOM ACCESS LOOKUP/ENTER FOR UPDATING
BDFLFL.C			000400	DFLFL.==400		;DEFAULT DEVICE
BASSFL.C			001000	ASSFL.==1000		;ASSIGNED  LOGICAL NAME FOR THIS DEVICE
BRELFL.C			002000	RELFL.==2000		;DOING RELEAS UUO (FCALL. 0)
BSMTTY.C			004000	SMTTY.==4000		;DOING SIMULATE TTY UUO (FCALL. 2,)
BTERMF.C			010000	TERMF.==10000		;TERMINAL
BUUOFL.C			400000	UUOFL.==(1B0)		;STILL DOING UUO'S  (DON'T SAVE ACCS AGAIN)
BC
BC				;FLAGS CLEARED BY FIN UUO.
BFINFL.C		777777	777777	FINFL.==-1
BC
BC				;INTERRUPT CHANNEL ASSIGNMENTS
BESCCHNC			000002	ESCCHN==2
BTRUCHNC			000001	TRUCHN==1
BINTERNTTYFL.DFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-10
FORSE.MAC	26-JUL-84 01:16		;ACCUMULATORS

BC				INTERN	TTYFL.
BC				;THE FOLLOWING ASSIGNMENTS ARE USED AS ARGUMENTS IN
BC				;TLO INSTRUCTIONS WHICH GENERATE UUO'S.
BC
BMTAPENMTAPEC			072000	NMTAPE==(MTAPE)
BCLOSENCLOSEC			070000	NCLOSE==(CLOSE)
BINPUTNINPUTC			066000	NINPUT==(INPUT)
BOUTPUTNOUTPTC			067000	NOUTPT==(OUTPUT)
BSETSTSNSETSTC			060000	NSETST==(SETSTS)
BINBUFNINBUFC			064000	NINBUF==(INBUF)
BOUTBUFNOUBUFC			065000	NOUBUF==(OUTBUF)
BUSETINUSETIC			074000	NUSETI==(USETI)
BUSETONUSETOC			075000	NUSETO==(USETO)
BLOOKUPNLOKUPC			076000	NLOKUP==(LOOKUP)
BC
BC				;STATUS CHECK FLAGS
BC
BIOWERRC			400000	IOWERR==400000		;WRITE PROTECTION ERROR
BIODERRC			200000	IODERR==200000		;DATA MISSED ERROR
BIOPERRC			100000	IOPERR==100000		;PARITY OR CHECKSUM ERROR
BIOBKTLC			040000	IOBKTL==40000		;BLOCK TOO LARGE ON INPUT
BIODENDC			020000	IODEND==20000		;END OF FILE
BIOTENDC			002000	IOTEND==2000		;END OF TAPE
BIOCONC			000040	IOCON==40		;CONTINUOUS I-O
BC
BC				;   FLAG		MEANING			ON/OFF
BC
BIOF.C			400000	IOF.==	400000		;OUTPUT/INPUT		OUTPUT/INPUT
BSFSF.C			200000	SFSF.==	200000		;SCALE FACTOR SIGN	-/+
BRTNF.C			100000	RTNF.==	100000		;RETURN SWITCH		ON/OFF
BPOSS.C			100000	POSS.== 100000		;POSITION STATEMENT	ON/OFF
BPOSF.C			040000	POSF.==	 40000		;POSITION FUNCTION	YES/NO
BTFF.C			020000	TFF.==	 20000		;T FORMAT		YES/NO
BSIZF.C			020000	SIZF.==	 20000		;SIZE FUNCTION		YES/NO
BSLIOF.C			010000	SLIOF.== 10000		;SLIST I-O		YES/NO
BOPF.C			004000	OPF.==	  4000		;OPEN STATEMENT		YES/NO
BOPDV.C			002000	OPDV.==   2000		;DEVICE IN OPEN STRING	YES/NO
BNLIOF.C			002000	NLIOF.==  2000		;NAMELIST I-O		YES/NO
BSQF.C			001000	SQF.==	  1000		;"TEXT" IN FORMAT	YES/NO
BSTPFF.C			000400	STPFF.==   400		;SPECIAL TAPE FUNCTION	YES/NO
BFCF.C			000200	FCF.==	   200		;FILE COMMAND		YES/NO
BFIOF.C			000100	FIOF.==	   100		;FORMAT I-O		YES/NO
BDDF.C			000040	DDF.==	    40		;DECTAPE OR DISC	YES/NO
BDPSF.C			000020	DPSF.==	    20		;DBL. PREC. IN SLIST.	YES/NO
BRRF.C			000010	RRF.==	    10		;REREAD UUO		YES/NO
BTFBF.C			000004	TFBF.==	     4		;T FORMAT BACKSPACE	YES/NO
BRPF.C			000002	RPF.==	     2		;() REPEAT FOR LEVEL 0,1YES/NO
BDF.C			000001	DF.==	     1		;DIGIT FLAG		YES/NO
BC
BETYP.C			400000	ETYP.==	400000		;E TYPE CONVERSION
BGTYP.C			200000	GTYP.==	200000		;G TYPE CONVERSION
BDTYP.C			100000	DTYP.==	100000		;D TYPE CONVERSION
BSUBTTLC				SUBTTL	UUO EXTRY AND EXIT
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-11
FORSE.MAC	26-JUL-84 01:16		UUO EXTRY AND EXIT

BC
BC				;RETURN TO USER...RESTORE USER'S AC'S
BC
BUXIT.HLRZBUUOH.LOWC	002042'	554120	002076'	UXIT.:	HLRZ	B,@UUOH.(LOW)	;LOOK AHEAD
BCAIGBFCALL.C	002043'	307100	035000		CAIG	B,(FCALL.)	;IS IT A FORTRAN UUO
BCAIGBFLIST.C	002044'	307100	007000		CAIG	B,(FLIST.)
BJRSTFINUXC	002045'	254000	002065'		JRST	FINUX		;NO
BTRNEBC	002046'	602100	000020		TRNE	B,(@)		;TOO COMPLEX TO HANDLE?
BJRSTFINUXC	002047'	254000	002065'		JRST	FINUX		;YES, YOU LOSE
BMOVEAUUOH.LOWC	002050'	200060	002076'		MOVE	A,@UUOH.(LOW)	;PICK UP NEW UUO
BTLZNAC	002051'	627040	000017		TLZN	A,17		;INDIRECTING?
BJRSTNOINDXC	002052'	254000	002060'		JRST	NOINDX		;NO, UUO IS COMPLETE
BHRRZCBC	002053'	550140	000002		HRRZ	C,B		;GET LEFT HALF OF UUO
BANDICC	002054'	405140	000017		ANDI	C,17		;INDEX ONLY
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>	;DON'T FORGET THE OFFSET
BMOVECSAVEACCC	002055'	200143	000031'		MOVE	C,SAVEAC(C)	;GET VALUE OUT OF STORE
BADDICAC	002056'	271141	000000		ADDI	C,(A)		;GET EFFECTIVE ADDRESS
BHRRACC	002057'	540040	000003		HRR	A,C		;TO THE UUO WITHOUT CARRY
BNOINDXLSHBC	002060'	242100	777767	NOINDX:	LSH	B,-9		;MOVE INTO RIGHTMOST QUARTER
BMOVEMA.JBUUOC	002061'	202040	000000*		MOVEM	A,.JBUUO	;SET UUO UP
BAOSUUOH.LOWC	002062'	350000	002076'		AOS	UUOH.(LOW)	;ADVANCE TO NEXT INST.
BTLONUUOFL.C	002063'	661700	400000		TLO	N,UUOFL.	;SET FLAG SO WE DON'T SAVE ACCS AGAIN
BJRSTTABUBC	002064'	254022	002214'		JRST	@TABU-7(B)	;DISPATCH TO UUO VALUE
BC
BC
BFINUXTLZNUUOFL.C	002065'	621700	400000	FINUX:	TLZ	N,UUOFL.	;ENSURE FLAG IS CLEAR
BIFNREENTC				IFN REENT,<MOVEI 0,SAVFAC+E(LOW)	;SAVE OP SYS AC'S
BC					HRLI	0,E		;BUT NOT THE TEMP. ONES>
BIFEREENTMOVEESAVFACEC	002066'	200000	007053'	IFE REENT,<MOVE 0,[E,,SAVFAC+E]>
BBLTSAVFACPLOWC	002067'	251000	000070'		BLT	0,SAVFAC+P(LOW)
BMOVSISAVEACLOWC	002070'	205740	000031'		MOVSI	17,SAVEAC(LOW)	;SET UP BLT TO RESTORE USER'S AC'S
BBLTC	002071'	251740	000015		BLT	17,15
BIFEREENTC				IFE REENT,<
BUUOL.EXCHNSAVEACNC	002072'	250700	000047'	UUOL.:	EXCH	N,SAVEAC+N	;RESTORE USER AC16>
BMOVESAVEACLOWC	002073'	200740	000050'		MOVE	17,SAVEAC+17(LOW)
BRERTNMOVESAVEACLOWC	002074'	200000	000031'	RERTN:	MOVE	0,SAVEAC+0(LOW)	;RESTORE AC0
BIFEREENTJRSTFUUOH.C	002075'	254120	002076'	IFE REENT,<JRSTF @UUOH.		;RETURN TO USER>
BIFNREENTC				IFN REENT,<JRST UUOL.(LOW)>
BC
BC
BC
BC				;ENTRY FROM USER
BC
BIFEREENTUUOH.C	002076'	000000	000000	IFE REENT,<UUOH.:	0
BMOVEMSAVEACC	002077'	202000	000031'		MOVEM	0,SAVEAC+0	;SAVE AC 0
BEXCHA.JBUUOC	002100'	250040	002061*		EXCH	A,.JBUUO	;PICK UP UUO
BLDBPOINTAC	002101'	135000	007054'		LDB	0,[POINT 9,A,8]	;PICK UP UUO OP CODE
BCAINC	002102'	306000	000014		CAIN	0,14		;**V31/01**DEBUG* CHECK FOR STL.
BJRSTDEBUG.C	002103'	254000	000000*		JRST	DEBUG.		;**V31/01**DEBUG
BCAIEC	002104'	302000	000015		CAIE	0,15		;RESET. ?>
BIFNREENTC				IFN REENT,<UUOP.:>
BJRSTNRESC	002105'	254000	002162'		JRST	NRES		;NO
BC								;YES, FALL INTO RESET.
BSUBTTLDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-12
FORSE.MAC	26-JUL-84 01:16		RESET. UUO

BC				SUBTTL	RESET. UUO
BC
BC				;RELEASE ALL DEVICES IN CASE ANY BUFFERS STILL FULL
BC
BMOVEIC	002106'	201000	000017		MOVEI	0,17		;CHANNELS 17-0
BIFNREENTC				IFN REENT,<	REL==A
BC					MOVSI	REL,(RELEAS)	;SET UP UUO>
BDPBPOINTRELC	002107'	137000	007055'		DPB	0,[POINT 4,REL,12];DEPOSIT CHANNEL NO.
BIFNREENTC				IFN REENT,<XCT	REL		;IN ACC>
BIFEREENTC				IFE REENT,<
BRELRELEASC	002110'	071000	000000	REL:	RELEAS			;****   MODIFIED>
BSOJGEC	002111'	365000	002107'		SOJGE	0,.-2
BC
BRESETC	002112'	047000	000000		RESET			;RESET I/O
BIFEREENTSETOC	002113'	474000	000000	IFE REENT,<SETO	0,		;STANDARD CPU TEST
BAOBJNC	002114'	253000	002115'		AOBJN	0,.+1		;TEST HARDWARE FOR HALF-WORD ADDER
BIFNKI10JUMPEC	002115'	322000	002120'	IFN KI10,<JUMPE	0,.+3		;ON A KI-10
BOUTSTRASCIZC	002116'	051140	007056'		OUTSTR	[ASCIZ /?KI-10 CODE WILL NOT RUN ON A KA-10/]
BEXITC	002117'	047000	000012		EXIT			;FATAL, BUT CONTINUE SHOULD WORK>
BSETZMSAVEACNC	002120'	402000	000047'		SETZM	SAVEAC+N	;CLEAR ALL FLAGS INITIALLY>
BMOVEAFOBPDPLOWC	002121'	200040	000003'		MOVE	A,FOBPDP(LOW)	;SAVE START OF PUSHDOWN
BMOVEMASAVFACPLOWC	002122'	202040	000070'		MOVEM	A,SAVFAC+P(LOW)	;SAVE POINTER FOR NEXT UUO
BSETZMALPHA.LOWC	002123'	402000	000071'		SETZM	ALPHA.(LOW)	;CLEAR DATA BLOCK
BIFEREENTMOVEXWDALPHA.ALPHA.C	002124'	200000	007066'	IFE REENT,<MOVE	0,[XWD ALPHA.,ALPHA.+1]>
BIFNREENTC				IFN REENT,<HRLI	0,ALPHA.(LOW)
BC					HRRI	0,ALPHA.+1(LOW)>
BBLTOMEGA.LOWC	002125'	251000	002041'		BLT	0,OMEGA.(LOW)	;ZERO DATA BASE
BMOVEPDLST.LOWC	002126'	200740	000004'		MOVE	17,PDLST.(LOW)	;INITIALIZE FORTRAN
BC								;FUNCTION PUSHDOWN POINTER
BSETOC	002127'	474000	000000		SETO	0,		;SET KA-10/KI-10 FLAG
BAOBJNC	002130'	253000	002131'		AOBJN	0,.+1
BMOVEMKA10.LOWC	002131'	202000	001767'		MOVEM	0,KA10.(LOW)
BPUSHJPERRIN.C	002132'	260740	000000*		PUSHJ	P,ERRIN.	;V.021- INITIALIZE ERROR HANDLER
BPUSHJPTRPIN.LOWC	002133'	260740	000000*		PUSHJ	P,TRPIN.(LOW)	;V.021- INITIALIZE TRAP HANDLER
BHRRZSUUOH.LOWC	002134'	553000	002076'		HRRZS	UUOH.(LOW)	;V.021- CLEAR ARITHMETIC FLAGS
BIFEREENTMOVEIEXITP.LOWC	002135'	201000	000000*	IFE REENT,<MOVEI 0,EXITP.(LOW)	;GET ADDRESS OF EXIT ROUTINE>
BIFNREENTC				IFN REENT,<MOVEI 0,REE.(LOW)	;OR REENTER ADDRESS>
BSKIPN.JBRENC	002136'	336000	000000*		SKIPN	.JBREN		;IS USER USING REENTER ALREADY
BMOVEM.JBRENC	002137'	202000	002136*		MOVEM	0,.JBREN	;NO, SET UP SO WE CAN CLOSE I/O
BIFNREENTC				IFN REENT,<HRLI	0,(MOVEI LOW,)	;SET UP MOVEI 16,(16)
BC					HRR	0,LOW		;SO THAT (LOW) IS CORRECT
BC					MOVEM	0,REE.(LOW)	;EACH RESET
BC					MOVE	0,[JRST	EXITP.(LOW)]
BC					MOVEM	0,REE.+1(LOW)	;ENSURES 16 IS SET UP CORRECTLY>
BMOVEPOPJC	002140'	200000	007067'		MOVE	0,[POPJ 17,]	;**V31/01**CHAIN
BPUSHJCHNIN.C	002141'	260740	000000*		PUSHJ	17,CHNIN.	;**V31/01**CHAIN
BMOVSINXTFL.C	002142'	205000	000000*		MOVSI	0,NXTFL.	;**V31/01**DEBUG* SET FLAGS FOR DEBUG
BTLOFRSTM.C	002143'	661000	000000*		TLO	0,FRSTM.	;**V31/01**DEBUG
BMOVEMTRPFL.C	002144'	202000	000000*		MOVEM	0,TRPFL.	;**V31/01**DEBUG
BMOVEIC	002145'	201000	000001		MOVEI	0,1		;**V31/01**DEBUG
BMOVEMNXTCT.C	002146'	202000	000000*		MOVEM	0,NXTCT.	;**V31/01**DEBUG
BMOVEC	002147'	200000	007070'		MOVE	0,[17,,11]	;STATES WORD
BGETTABC	002150'	047000	000041		GETTAB	0,		;GET IT
BSETZDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-13
FORSE.MAC	26-JUL-84 01:16		RESET. UUO

BC	002151'	400000	000000		  SETZ	0,		;ERROR RETURN
BTLNNC	002152'	607000	003400		TLNN	0,(7B9)		;TEST FOR LEVEL D OR LATER
BTDZAC	002153'	634000	000000		TDZA	0,0		;NOT LEVEL D
BHRROIC	002154'	561000	777776		HRROI	0,-2		;USED FOR EXTENDED LOOKUPS (FUTURE USE)
BMOVEMLEVEL.LOWC	002155'	202000	001766'		MOVEM	0,LEVEL.(LOW)	;STORE RESULT
BMOVEIINIACTC	002156'	201700	000000*		MOVEI	16,INIACT	;CHECK FOR ACCTG CHG
BJUMPERERTNC	002157'	322700	002074'		JUMPE	16,RERTN	;NO - RETURN TO USER
BJSAINIACTC	002160'	266700	002156*		JSA	16,INIACT	;YES - PROCESS IT
BJRSTRERTNC	002161'	254000	002074'		JRST	RERTN		;RETURN TO USER
BC
BSUBTTLC				SUBTTL	UUO'S OTHER THAN RESET. COME HERE
BC
BNRESCAIGC	002162'	307000	000035	NRES:	CAIG	0,35		;CHECK UUO LIMITS
BCAIGC	002163'	307000	000006		CAIG	0,6		;**V31/01** CHAIN
BPUSHJPILUUO.C	002164'	260740	000000*		PUSHJ	P,ILUUO.	;ILLEGAL UUO VALUE
BMOVEAC	002165'	200000	000001		MOVE	0,A		;SAVE UUO
BMOVEAACBLTC	002166'	200040	007050'		MOVE	A,ACBLT		;SET UP BLT FOR USER'S AC'S
BIFNREENTC				IFN REENT,<ADDI	A,(LOW)>
BBLTASAVEACLOWC	002167'	251040	000046'		BLT	A,SAVEAC+15(LOW)
BIFEREENTEXCHNSAVEACNC	002170'	250700	000047'	IFE REENT,<EXCH	N,SAVEAC+N>
BMOVEMSAVEACLOWC	002171'	202740	000050'		MOVEM	17,SAVEAC+17(LOW)
BMOVEPSAVFACPLOWC	002172'	200740	000070'		MOVE	P,SAVFAC+P(LOW)	;SET UP OP SYS PUSHDOWN POINTER
BC				;SAVE USER'S ACCUMULATORS AND DISPATCH ON UUO
BC
BLDBAPOINTC	002173'	135040	007071'		LDB	A,[POINT 9,0,8]	;**V31/01** CHAIN
BCAIEAC	002174'	302040	000013		CAIE	A,13		;**V31/01** CHAIN
BJRSTC	002175'	254000	002200'		JRST	.+3		;**V31/01** CHAIN
BMOVEJRSTDUMER.C	002176'	200000	007072'		MOVE	0,[JRST DUMER.]	;**V31/01** CHAIN
BJRSTCHAIN.C	002177'	254000	000000*		JRST	CHAIN.		;**V31/01** CHAIN
BMOVEBAC	002200'	200100	000001		MOVE	B,A		;SAVE UUO NUMBER
BMOVEAC	002201'	200040	000000		MOVE	A,0		;UUO
BMOVE.JBUUOC	002202'	200000	002100*		MOVE	0,.JBUUO	;USER'S AC A
BMOVEMSAVEACALOWC	002203'	202000	000032'		MOVEM	0,SAVEAC+A(LOW)	;USER'S AC A
BSKIPGTRAPF.LOWC	002204'	337000	000124'		SKIPG	TRAPF.(LOW)	;ARE THERE ANY TRAPS SET
BJRSTJTABUC	002205'	254000	002221'		JRST	JTABU	;NO
BPUSHPCC	002206'	261740	000003		PUSH	P,C		;NEED A REGISTER
BPUSHJPDISAB.C	002207'	260740	003563'		PUSHJ	P,DISAB.	;DISABLE ESCAPE AND TRU CHANNELS
BMOVEICFORESCC	002210'	201140	003547'		MOVEI	C,FORESC	;FORSE ESCAPE PROCESSOR
BEXCHCINTAB.ESCCHNC	002211'	250140	000003*		EXCH	C,INTAB.+<ESCCHN-1>*2+1
BMOVEMCNRMESCLOWC	002212'	202140	000126'		MOVEM	C,NRMESC(LOW)	;SAVE OLD VALUE
BMOVEICFORTRUC	002213'	201140	003556'		MOVEI	C,FORTRU	;FORSE TRU PROCESSOR
BEXCHCINTAB.TRUCHNC	002214'	250140	000001*		EXCH	C,INTAB.+<TRUCHN-1>*2+1
BMOVEMCNRMTRUC	002215'	202140	000127'		MOVEM	C,NRMTRU
BSETZMTRPLOCLOWC	002216'	402000	000125'		SETZM	TRPLOC(LOW)	;CLEAR LOCATION TO GO TO IF TRAP IN FORSE
BHRROSTRAPF.LOWC	002217'	563000	000124'		HRROS	TRAPF.(LOW)	;SET NEGATIVE SO TRAP LOCS ONLY CHANGED FIRST TIME
BPOPPCC	002220'	262740	000003		POP	P,C
BJTABUSETZHC	002221'	400400	000000	JTABU:  SETZ    H,              ; ZERO H FOR FILE EOF TEST.
BJRSTTABUBC	002222'	254022	002214'		JRST	@TABU-7(B)	;DISPATCH TO UUO ROUTINES
BC
BC
BC				;DISPATCH TABLE FOR INCOMING UUO'S..IN ORDER OF NUMERIC VALUE.
BC
BTABUFLIST.FLISTC	002223'	007000	005601'	TABU:	FLIST.	FLIST		;FLIST.
BFNM.FNMDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-14
FORSE.MAC	26-JUL-84 01:16		UUO'S OTHER THAN RESET. COME HERE

BC	002224'	010000	005565'		FNM.	FNM		;FNM.
BOPE.OPENFC	002225'	011000	005613'		OPE.	OPENF		;OPE.
BPOS.POSSC	002226'	012000	005556'		POS.	POSS		;POS.
BCHN.ILUUO.C	002227'	013000	002164*		CHN.	ILUUO.		;NOT THRU TABLE
BSTL.ILUUO.C	002230'	014000	002227*		STL.	ILUUO.		;NOT THRU TABLE
BRESET.ILUUO.C	002231'	015000	002230*		RESET.	ILUUO.		;NOT THRU TABLE
BIN.INPC	002232'	016000	004145'		IN.	INP		;IN.
BOUT.OUTPC	002233'	017000	004143'		OUT.	OUTP		;OUT.
BDATA.DATAC	002234'	020000	002664'		DATA.	DATA		;DATA.
BFIN.FINC	002235'	021000	003450'		FIN.	FIN		;FIN.
BRTB.RTBC	002236'	022000	005511'		RTB.	RTB		;RTB.
BWTB.WTBC	002237'	023000	005510'		WTB.	WTB		;WTB.
BMTOP.RRBBWC	002240'	024000	005520'		MTOP.	RRBBW		;REW.,REWUN.,BSR.,WEF.,SPR.
BSLIST.SLISTC	002241'	025000	002752'		SLIST.	SLIST		;SLIST.
BINF.INFC	002242'	026000	005456'		INF.	INF		;INF.
BOUTF.OUTFC	002243'	027000	005454'		OUTF.	OUTF		;OUTF.
BRERED.ILUUO.C	002244'	030000	002231*		RERED.	ILUUO.		;RERED. UUO NOT SUPPORTED
BNLI.NLIC	002245'	031000	005500'		NLI.	NLI		;NAMELIST INPUT
BNLO.NLOC	002246'	032000	005502'		NLO.	NLO		;NAMELIST OUTPUT
BDEC.DECC	002247'	033000	005530'		DEC.	DEC		;DECODE
BENC.ENCC	002250'	034000	005524'		ENC.	ENC		;ENCODE
BFCALL.FCALLIC	002251'	035000	004447'		FCALL.	FCALLI		;FORTRAN CALLI
BC
BC				;CALCULATE BUFFER HEADER INFORMATION
BC				;WORDS TO BE SKIPPED IN BUFFER BEFORE DESIRED RECORD= WORDS.
BC				;CHARACTERS TO BE SKIPPED IN BUFFER BEFORE RECORD   = CHARS.
BC				;THE BLOCK TO BE ACCESSED IN WHICH THE RECORD LIES  = BLOCK.
BC				;THIS IS FOR ASCII INPUT
BC
BRANASCPUSHPAC	002252'	261740	000001	RANASC:	PUSH	P,A		;NEED TWO REGISTERS
BPUSHPBC	002253'	261740	000002		PUSH	P,B
BMOVEAASVAR.LOWC	002254'	200040	001764'		MOVE	A,ASVAR.(LOW)	;CHAR # IN FILE TO BE ACCESSED NEXT
BCAMNAC	002255'	316040	007073'		CAMN	A,[-1]		;-1 IS SPECIAL
BJRSTMOVEMABLOCK.LOWC					JRST	[MOVEM	A,BLOCK.(LOW)
BSETZMCHARS.LOWC						SETZM	CHARS.(LOW)
BJRSTTSTBLKC	002256'	254000	007074'			JRST	TSTBLK]	;SET ON EOF
BIDIVIAC	002257'	231040	001200		IDIVI	A,5*200		;FIND BLOCK NUMBER
BAOJAC	002260'	340040	000000		AOJ	A,		;CONVERT BLOCK NUMBER TO 1-INDEXED
BMOVEMABLOCK.LOWC	002261'	202040	001761'		MOVEM	A,BLOCK.(LOW)
BMOVEMBCHARS.LOWC	002262'	202100	001762'		MOVEM	B,CHARS.(LOW)	;NUMBER OF CHARS FROM BLOCK START
BTSTBLKLDBCPOINTMC	002263'	135140	007077'	TSTBLK:	LDB	C,[POINT 4,M,12]
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BHRREBRANDV.CC	002264'	570103	000353'		HRRE	B,RANDV.(C)	;GET INCORE BLOCK
BCAMEBBLOCK.LOWC	002265'	312100	001761'		CAME	B,BLOCK.(LOW)	;IS IT THE ONE WE WANT?
BPUSHJPRINP.C	002266'	260740	006306'		PUSHJ	P,RINP.		;NO
BPUSHJPFIXBFC	002267'	260740	006500'		PUSHJ	P,FIXBF		;RESET WORD COUNT AND BYTE POINTER
BJUMPLIC	002270'	321440	002272'		JUMPL	I,.+2		; *301* IF INPUT
BXCTIIB.C	002271'	256000	003637'		XCT	IIB.		; *301* MUST ADVANCE BYTE POINTER TO READ FIRST CHAR.
BSKIPNBHDRADDLOWC	002272'	336100	000074'		SKIPN	B,HDRADD(LOW)	;MIGHT BE USING LINE BUFFER
BMOVEBMC	002273'	200100	000007		MOVE	B,M		;WASN'T
BMOVEBC	002274'	200002	000002		MOVE	0,2(B)		;GET CHAR COUNT
BSUBCHARS.LOWC	002275'	274000	001762'		SUB	0,CHARS.(LOW)	;SUBTRACT THOSE TO BE SKIPPED
BMOVEMBC	002276'	202002	000002		MOVEM	0,2(B)		;RESET CHAR COUNT
BMOVECHARS.LOWDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-15
FORSE.MAC	26-JUL-84 01:16		UUO'S OTHER THAN RESET. COME HERE

BC	002277'	200000	001762'		MOVE	0,CHARS.(LOW)	;CHARS FROM BLOCK START
BIDIVIC	002300'	231000	000005		IDIVI	0,5		;GET WORDS FROM BLOCK START
BADDMBC	002301'	272002	000001		ADDM	1(B)		;ADJUST POINTER
BJUMPEAC	002302'	322040	002305'		JUMPE	A,.+3		;ANY EXTRA CHARS
BIBPBC	002303'	133002	000001		IBP	1(B)		;YES. ADJUST POINTER FOR EACH CHAR
BSOJGAC	002304'	367040	002303'		SOJG	A,.-1		;ANY MORE
BPOPPBC	002305'	262740	000002		POP	P,B
BPOPPAC	002306'	262740	000001		POP	P,A
BTLNEIPOSS.C	002307'	603440	100000		TLNE	I,POSS.		;CHECK IF POSITION STATEMENT
BJRSTFIB.C	002310'	254000	003464'		JRST	FIB.		;IF SO, NO I/O TO DO
BJRSTFMTOUTC	002311'	254000	002315'		JRST	FMTOUT		;AND RETURN
BSUBTTLC				SUBTTL	FORMAT SCAN INITIALIZATION ROUTINE
BC
BIORETSKIPGERANAC.LOWC	002312'	335000	001760'	IORET:	SKIPGE	RANAC.(LOW)	;DIRECT ACCESS CALLED FOR?
BJRSTRANASCC	002313'	254000	002252'		JRST	RANASC		;YES,GO OFF TO ASCII BLOCK CALC
BJUMPGEID0C	002314'	325440	002316'		JUMPGE	I,D0		;JUMP INOUTPUT
BFMTOUTC	002315'			FMTOUT:	;SKIPN	C,HDRADD(LOW)	IS LINE BUFFER IN USE
BJRSTGETACC	002315'	254000	002341'		JRST	GETAC		;NO
BC					;MOVE	K,1(C)		YES. GET BYTE POINTER TO REAL BUFFER
BC					;TLNN	K,760000	DOES IT START ON WORD BOUNDRY
BC					;JRST	GETAC		YES
BC					;AOS	1(M)		NO. ADJUST LINE BUFFER POINTER TO FIRST WORD
BC					;HLLM	K,1(M)		SET TO POINT TO SAME BYTE AS REAL BUFFER POINTER
BC					;MOVE	0,@1(C)		GET PARTIAL WORD OF REAL BUFFER
BC					;MOVEM	0,@1(M)		PUT IN LINE BUFFER
BC					;HRLI	K,010700	SET REAL BUFFER POINTER TO START OF WORD
BC					;SOJ	K,		DECREMENT WORD ADDRESS
BC					;MOVEM	K,1(C)		RESTORE BYTE PINTER
BC					;JRST	GETAC
BD0MOVEDEVIC.LOWC	002316'	200000	001476'	D0:	MOVE	0,DEVIC.(LOW)	;GET DEVICE NAME
BMOVEMRERDV.LOWC	002317'	202000	001500'		MOVEM	0,RERDV.(LOW)	;SAVE INPUT DEVICE NAME
BTLNNIRRF.C	002320'	607440	000010		TLNN	I,RRF.		;REREAD UUO?
BJRSTGETACC	002321'	254000	002341'		JRST	GETAC		;NO
BLDBCPOINTMC	002322'	135140	007077'		LDB	C,[POINT 4,M,12]	;CHANNEL NUMBER
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BMOVERINC1LOWC	002323'	200000	001513'		MOVE	0,RINC1(LOW)	;BLOCK POSITION OF PREVIOUS LINE
BCAMNINCNT.CC	002324'	316003	000273'		CAMN	INCNT.(C)	;IS IT THE SAME AS THE CURRENT LINE
BJRSTD1C	002325'	254000	002334'		JRST	D1		;YES
BMOVEMINCNT.CC	002326'	202003	000273'		MOVEM	0,INCNT.(C)	;NO. MAKE PREV BLOCK THE CURRENT ONE
BHLLMC	002327'	500000	000007		HLL	0,M		;CHANNEL NUMBER FOR USETI
BTLONUSETIC	002330'	661000	074000		TLO	0,NUSETI	;OP CODE
BXCTC	002331'	256000	000000		XCT	0
BSOSINCNT.CC	002332'	370003	000273'		SOS	INCNT.(C)	;POINT TO PREVIOUS BLOCK
BPUSHJPDOINPC	002333'	260740	003623'		PUSHJ	P,DOINP	;GET BLOCK
BD1HRRZMC	002334'	550007	000000	D1:	HRRZ	0,(M)		;START OF BUFFER
BADDRPTR1LOWC	002335'	270000	001507'		ADD	0,RPTR1(LOW)	;ADDJUST POINTER TO BUFFER
BMOVEMMC	002336'	202007	000001		MOVEM	0,1(M)
BMOVERCNT1LOWC	002337'	200000	001511'		MOVE	0,RCNT1(LOW)	;ORIGINAL ITEM COUNT
BMOVEMMC	002340'	202007	000002		MOVEM	0,2(M)		;IN BUFFER HEADER
BGETACLDBCPTRUC	002341'	135140	007051'	GETAC:	LDB	C,PTRU		;AC CONTAINING POINTER TO FMT
BADDICSAVEACLOWC	002342'	271140	000031'		ADDI	C,SAVEAC(LOW)	;ADDRESS OF AC BLOCK
BMOVSIC	002343'	205000	350700		MOVSI	0,350700
BMOVEMFMTEN.LOWC	002344'	202000	001332'		MOVEM	0,FMTEN.(LOW)	;SET UP POINTER TO END OF FMT
BHRRZKCDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-16
FORSE.MAC	26-JUL-84 01:16		FORMAT SCAN INITIALIZATION ROUTINE

BC	002345'	550543	000000		HRRZ	K,(C)		;POINTS TO BEG. OF FORMAT
BHRLIKC	002346'	505540	000700		HRLI	K,700		;BYTE SIZE
BHLRZKC	002347'	554013	000000		HLRZ	0,(K)		;SEE IF JRST AROUND FORMAT
BTRZC	002350'	620000	000777		TRZ	0,777		;**V31/01**DEBUG* ZER POSSIBLE BREAK
BCAINC	002351'	306000	014000		CAIN	0,14000		;**V31/01**DEBUG* STL.?
BAOSKC	002352'	350000	000013		AOS	K		;**V31/01**DEBUG* YES  BUMP PAST
BHLRZKC	002353'	554013	000000		HLRZ	0,(K)		;**V31/01**DEBUG* TEST FOR JRST
BCAINJRSTC	002354'	306000	254000		CAIN	0,(JRST)
BJRSTHRSC	002355'	254000	002366'		JRST	HRS		;YES,THERE IS A JRST
BSUBIKC	002356'	275540	000001		SUBI	K,1		;NOT A JRST BUT 1ST WORD OF FMT
BHLRZCC	002357'	554003	000000		HLRZ	0,(C)		;LENGTH OF FORMAT ARRAY
BJUMPNC	002360'	326000	002362'		JUMPN	0,.+2
BMOVEIC	002361'	201000	000373		MOVEI	0,^D251		;MAX. NO OF WORDS ALLOWED
BADDKC	002362'	270000	000013		ADD	0,K		;UPPER BOUND ON FORMAT
BMOVEMKLASTLPLOWC	002363'	202540	001331'		MOVEM	K,LASTLP(LOW)	;POINTER TO BEG. OF FORMAT
BMOVEMKGRPRPTLOWC	002364'	202540	001724'		MOVEM	K,GRPRPT(LOW)	;POINTER TO BEGINNING OF FMT FOR REPEAT
BAOJAC	002365'	344000	002367'		AOJA	0,.+2		;POINT TO LAST WORD
BHRSHRRZKC	002366'	550020	000013	HRS:	HRRZ	0,@K		;SET END ADR. FOR COMPARE
BHRRMFMTEN.LOWC	002367'	542000	001332'		HRRM	0,FMTEN.(LOW)	;END ADDR. OF FORMAT
BMOVEMKFMTBG.LOWC	002370'	202540	001333'		MOVEM	K,FMTBG.(LOW)	;POINTER TO BEGINNING OF FORMAT
BTLZIIOF.FIOF.DDF.C	002371'	621440	377637		TLZ	I,-1-<IOF.!FIOF.!DDF.>	;CLEAR ALL BUT INPUT/OUTPUT, FMT,DIR/DEV
BSETOMEOL.LOWC	002372'	476000	001334'		SETOM	EOL.(LOW)	;SET END OF LINE FLAG AND CHAR. COUNT
BHRRIEC	002373'	541240	000000		HRRI	E,0		;SCALE FACTOR=0
BCLEARBLOVFLS.LOWC	002374'	403600	000111'		CLEARB	L,OVFLS.(LOW)	;() COUNT AND LINE OVERFLOW
BRIN.HRRIIC	002375'	541440	000000	RIN.:	HRRI	I,0		;CLEAR ROUTINE FLAG
BCLEARBAFRPTC.LOWC	002376'	403040	001725'		CLEARB	A,FRPTC.(LOW)	;INITIALIZE COUNTERS
BHRLIEC	002377'	505240	000000		HRLI	E,0		;INITIALIZE FIELD WIDTH
BSUBTTLC				SUBTTL	CHARACTER SCAN AND DISPATCH
BC
BINMOVEMKSAVSCNLOWC	002400'	202540	001722'	IN:	MOVEM	K,SAVSCN(LOW)
BILDBBKC	002401'	134100	000013		ILDB	B,K		;NEXT FORMAT CHARACTER
BC				;	CAIN	B,11		;CCO 30-15
BC				;	MOVEI	B,40		;CCO 30-15
BCAMGEKFMTEN.LOWC	002402'	315540	001332'		CAMGE	K,FMTEN.(LOW)	;CHECK FOR END OF FORMAT
BJRSTIN2C	002403'	254000	002407'	        JRST    IN2             ;NOT END
BJUMPELPARLC	002404'	322600	002457'	        JUMPE   L,PARL          ;( ) PAIRS MATCHED
BERRORFMTER.C	002405'	260740	000000*	        ERROR   FMTER.          ;( ) NOT MATCHED
BJRSTEDFINC	002406'	254000	003770'	        JRST    EDFIN           ;QUIT I/O
BIN2TRZBC	002407'	620100	000100	IN2:    TRZ	B,100		;CLEAR HIGH ORDER BIT
BTRCBC	002410'	640100	000040		TRC	B,40		;CONVERT TO SIXBIT ASCII
BMOVECBC	002411'	200140	000002		MOVE	C,B		;SAVE FORMAT CHARACTER
BIDIVICC	002412'	231140	000007		IDIVI	C,7		;SET FOR DISPATCH TABLE ENTRY
BLDBCPTRTABDC	002413'	135144	003047'		LDB	C,PTRTAB(D)	;PICK UP DISPATCH INDEX
BJRSTDISTABCC	002414'	254023	003070'		JRST	@DISTAB(C)	;DISPATCH TO CHARACTER ROUTINE
BC
BC				;CHARACTER IS 0-9
BC
BDIGTLOEIDF.C	002415'	663440	000001	DIG:	TLOE	I,DF.		;SET DIG FLG, SKIP IF IT WASN'T SET
BJRSTC	002416'	254000	002421'		JRST	.+3
BMOVEDSAVSCNLOWC	002417'	200200	001722'		MOVE	D,SAVSCN(LOW)	;GET PTR POSN BEFORE DIGITS
BMOVEMDDIGPTRLOWC	002420'	202200	001723'		MOVEM	D,DIGPTR(LOW)	;SAVE IT FOR RESCAN
BSUBIBC	002421'	275100	000020		SUBI	B,20		;OCTAL DIGIT
BIMULIAC	002422'	221040	000012		IMULI	A,12		;ACCUMULATE THE NUMBER
BADDABDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-17
FORSE.MAC	26-JUL-84 01:16		CHARACTER SCAN AND DISPATCH

BC	002423'	270040	000002		ADD	A,B
BJRSTINC	002424'	254000	002400'		JRST	IN
BC
BC				; CHARACTER IS .
BC
BDECPTTSOEAC	002425'	671240	000001	DECPT:	TSO	E,A		;SET FIELD WIDTH
BTLZIDF.C	002426'	621440	000001		TLZ	I,DF.		;CLEAR DIG FLG
BMOVEIAC	002427'	201040	000000		MOVEI	A,0
BSETOMDECFLGC	002430'	476000	000107'		SETOM	,DECFLG		;**V31/01**MONEY* SET DEC PT FLG
BJRSTINC	002431'	254000	002400'		JRST	IN
BC
BC
BC				;CHARACTER IS (
BC
BPARLFPUSHPAC	002432'	261740	000001	PARLF:	PUSH	P,A		;SAVE COUNT
BPUSHPKC	002433'	261740	000013		PUSH	P,K		;SAVE POINTER TO ( IN FORMAT
BTLNNIC	002434'	607440	000002		TLNN	I,2		;LAST ( ALREADY STORED?
BCAILELC	002435'	303600	000001		CAILE	L,1		;SAVE LEVEL 0 OR 1 ONLY
BJRSTPARLF1C	002436'	254000	002446'		JRST	PARLF1		;LEVEL 2  DON'T SAVE FOR RESCAN
BTLZNIDF.C	002437'	627440	000001		TLZN	I,DF.		;CLEAR DIG FLG, SKIP IF IT WAS SET
BJRSTPARLF0C	002440'	254000	002444'		JRST	PARLF0		;NO DIGS BEFORE GROUP
BMOVEADIGPTRLOWC	002441'	200040	001723'		MOVE	A,DIGPTR(LOW)	;DIGS BEFORE GROUP
BMOVEMAGRPRPTLOWC	002442'	202040	001724'		MOVEM	A,GRPRPT(LOW)	;SAVE PTR TO 1ST LEVEL GROUP FOR RESCAN
BJRSTPARLF2C	002443'	254000	002445'		JRST	PARLF2		;SKIP
BPARLF0MOVEMKGRPRPTLOWC	002444'	202540	001724'	PARLF0:	MOVEM	K,GRPRPT(LOW)	;SAV PTR TO ( IN GROUP REPEAT
BPARLF2MOVEMKLASTLPLOWC	002445'	202540	001331'	PARLF2:	MOVEM	K,LASTLP(LOW)	;SAVE POINTER TO (
BPARLF1MOVEIAC	002446'	201040	000000	PARLF1:	MOVEI	A,0
BAOJALINC	002447'	344600	002400'		AOJA	L,IN		;ADD ONE TO () COUNT
BC
BC				;CHARACTER IS )
BC
BPARRPUSHJPCOMMAC	002450'	260740	002641'	PARR:	PUSHJ	P,COMMA		;DO CONVERSION IF NECESSARY
BHRRIIC	002451'	541440	000000		HRRI	I,0		;PREVENT FURTHER CONVERSION
BSOJGLPARGC	002452'	367600	002474'		SOJG	L,PARG		;OFFSET (
BTLONIRPF.C	002453'	667440	000002		TLON	I,RPF.		;CHECK FOR AUTO. FORMAT REPEAT
BJUMPLLPARLC	002454'	321600	002457'		JUMPL	L,PARL
BSKIPLEPC	002455'	333017	777777		SKIPLE	-1(P)		;CHECK () COUNT
BJRSTPARGC	002456'	254000	002474'		JRST	PARG
BC
BPARLPUSHJPCOMMAC	002457'	260740	002641'	PARL:	PUSHJ	P,COMMA		;PERFORM CONVERSION
BPUSHJPENDLN.C	002460'	260740	003361'		PUSHJ	P,ENDLN.	;TERMINATE THIS LINE
BHRRZINIFLGLOWC	002461'	550000	000072'		HRRZ	0,INIFLG(LOW)
BCAILC	002462'	301000	000002		CAIL	0,2
BSUBPXWDC	002463'	274740	007100'		SUB	P,[XWD 2,2]	;COMPENSATE FOR () PUSH
BTLOIRTNF.C	002464'	661440	100000		TLO	I,RTNF.		;RETURN SWITCH ON
BMOVEKGRPRPTLOWC	002465'	200540	001724'		MOVE	K,GRPRPT(LOW)	;RESET SCAN AT LAST 1ST LEVEL GROUP
BTLZIC	002466'	621440	000001		TLZ	I,1		;CLEAR GRP PEPEAT FLG
BC
BC				;RETURN TO USER FOR DATA ADDRESS OR TERMINATION OF SCAN
BC
BIORTR.TLNEISLIOF.C	002467'	603440	010000	IORTR.:	TLNE	I,SLIOF.	;SLIST?
BJRSTNASC	002470'	254000	002775'		JRST	NAS		;YES
BNASBAKSKIPGEEDERRLOWC	002471'	335000	000105'	NASBAK:	SKIPGE	EDERR(LOW)	;++ ENCODE DECODE ERROR?
BJRSTEDERRMDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-18
FORSE.MAC	26-JUL-84 01:16		CHARACTER SCAN AND DISPATCH

BC	002472'	254000	005553'		JRST	EDERRM		;++ YES,TYPE OUT MESSAGE SKIP TO FIN.
BJRSTUXIT.C	002473'	254000	002042'		JRST	UXIT.
BC
BC				;RESET SCAN AT LAST LEFT ( AND DROP COUNT
BC
BPARGSOSLEPC	002474'	373017	777777	PARG:	SOSLE	-1(P)		;DROP () COUNT
BJRSTMSPC	002475'	254000	002500'		JRST	MSP
BSUBPXWDC	002476'	274740	007100'		SUB	P,[XWD 2,2]	;RESET P TO POINT TO LAST (
BJRSTRIN.C	002477'	254000	002375'		JRST	RIN.		; *233* GET NEXT FORMAT CHARACTER
BMSPMOVEKPC	002500'	200557	000000	MSP:	MOVE	K,(P)		;RESET SCAN AT LAST (
BAOJALRIN.C	002501'	344600	002375'		AOJA	L,RIN.		; *233* BUMP COUNT FOR RESCAN
BC
BC				;CHARACTER IS -
BC
BNEGSCTLOISFSF.C	002502'	661440	200000	NEGSC:	TLO	I,SFSF.		;SCALE FACTOR SIGN
BTLZIDF.C	002503'	621440	000001		TLZ	I,DF.		;DIG FLAG
BJRSTINC	002504'	254000	002400'		JRST	IN
BC				;CHARACTER IS /
BC
BSLASHTLNENENCFL.C	002505'	603700	000040	SLASH:	TLNE	N,ENCFL.	;/ IS ILLEGAL IN ENCODE-DECODE
BTTCALLASCIZC					TTCALL	3,[ASCIZ ?WARNING! / IS ILLEGAL IN ENCODE-DECODE, END OF FORMAT ASSUMED
BC	002506'	051140	007101'	?]
BPUSHJPCOMMAC	002507'	260740	002641'		PUSHJ	P,COMMA		;CONVERSION,IF ANY
BPUSHJPENDLN.C	002510'	260740	003361'		PUSHJ	P,ENDLN.	;TERMINATE LINE
BJRSTRIN.C	002511'	254000	002375'		JRST	RIN.
BC
BC				    ;CHARACTER IS SINGLE QUOTE
BC
BSQUOTESETOAC	002512'	474040	000000	SQUOTE:	SETO	A,		;NO LIMIT TO CHARACTER COUNT
BTLOISQF.C	002513'	661440	001000		TLO	I,SQF.		;SINGLE QUOTE FLAG
BC
BC				;CHARACTER IS H
BC
BHIOTLZIDF.C	002514'	621440	000001	HIO:	TLZ	I,DF.		;CLEAR DIG FLAG
BJUMPEARIN.C	002515'	322040	002375'		JUMPE	A,RIN.
BHRRZBFMTEN.LOWC	002516'	550100	001332'		HRRZ	B,FMTEN.(LOW)	;END OF FORMAT
BSUBIBKC	002517'	275113	000000		SUBI	B,(K)		;BEG OF FORMAT
BIMULIBC	002520'	221100	000005		IMULI	B,5
BJUMPGEIHINPTC	002521'	325440	002533'		JUMPGE	I,HINPT		;JUMP ON INPUT
BHLDBILDBKC	002522'	134000	000013	HLDB:	ILDB	0,K		;CHARACTER FROM FORMAT
BSOJEBPARLC	002523'	362100	002457'		SOJE	B,PARL		;TEST FOR END
BTLNNISQF.C	002524'	607440	001000		TLNN	I,SQF.		;SINGLE QUOTE?
BJRSTHDPBC	002525'	254000	002530'		JRST	HDPB		;NO
BCAINC	002526'	306000	000047		CAIN	0,"'"		;SINGLE QUOTE IN FORMAT?
BPUSHJPDBLQTEC	002527'	260740	002563'		PUSHJ	P,DBLQTE	;TEST FOR TWO SINGLE QUOTES
BHDPBPUSHJPDEPOT.C	002530'	260740	003121'	HDPB:	PUSHJ	P,DEPOT.	;DEPOSIT CHARACTER
BSOJNAHLDBC	002531'	366040	002522'		SOJN	A,HLDB		;DROP COUNT
BJRSTRIN.C	002532'	254000	002375'		JRST	RIN.
BHINPTTLNEISQF.C	002533'	603440	001000	HINPT:	TLNE	I,SQF.		; *227* SINGLE QUOTE METHOD?
BJRSTC	002534'	254000	002541'		JRST	.+5		; *227* YES, TEST FORMAT FOR ' FIRST
BPUSHJPCHINN.C	002535'	260740	003601'		PUSHJ	P,CHINN.	;GET A CHARACTER
BSKIPNOVFLS.LOWC	002536'	336000	000111'		SKIPN	OVFLS.(LOW)	;DON'T ADVANCE IF END OF LINE
BXCTIIB.C	002537'	256000	003637'		XCT	IIB.
BSOJEBPARLDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-19
FORSE.MAC	26-JUL-84 01:16		CHARACTER SCAN AND DISPATCH

BC	002540'	362100	002457'		SOJE	B,PARL		;TEST FOR END
BILDBCKC	002541'	134140	000013		ILDB	C,K		;CHARACTER FROM FORMAT
BTLNNISQF.C	002542'	607440	001000		TLNN	I,SQF.		;SINGLE QUOTE?
BJRSTHINDPBC	002543'	254000	002554'		JRST	HINDPB		;NO
BCAINCC	002544'	306140	000047		CAIN	C,"'"		;SINGLE QUOTE IN INPUT?
BPUSHJPDBLQTEC	002545'	260740	002563'		PUSHJ	P,DBLQTE	;YES,TEST FOR TWO SINGLE QUOTES
BPUSHJPCHINN.C	002546'	260740	003601'		PUSHJ	P,CHINN.	; *227* GET A CHARACTER
BSKIPNOVFLS.LOWC	002547'	336000	000111'		SKIPN	OVFLS.(LOW)	; *227* DON'T ADVANCE IF END OF LINE
BXCTIIB.C	002550'	256000	003637'		XCT	IIB.		; *227*
BSOJEBPARLC	002551'	362100	002457'		SOJE	B,PARL		; *227* TEST FOR END
BCAINC	002552'	306000	000047		CAIN	0,"'"		; *227* SINGLE QUOTE IN INPUT?
BMOVEIDQC	002553'	201000	000042		MOVEI	0,DQ		; *227* CHANGE TO "
BHINDPBCAIEC	002554'	302000	000015	HINDPB:	CAIE	0,15		;IS CHAR. A CARRIAGE RETURN?
BJRSTC	002555'	254000	002560'		JRST	.+3		;NO
BSKIPEOVFLS.LOWC	002556'	332000	000111'		SKIPE	OVFLS.(LOW)	;YES, END OF LINE SEEN?
BMOVEIC	002557'	201000	000040		MOVEI	0,40		;YES, SUBSTITUTE A BLANK
BDPBKC	002560'	137000	000013		DPB	0,K		;PUT CHARACTER IN FORMAT
BSOJNAHINPTC	002561'	366040	002533'		SOJN	A,HINPT		;DROP COUNT
BJRSTRIN.C	002562'	254000	002375'		JRST	RIN.
BC
BDBLQTEPUSHPKC	002563'	261740	000013	DBLQTE:	PUSH	P,K		;SAVE FORMAT POINTER
BILDBCKC	002564'	134140	000013		ILDB	C,K		;LOOK FOR SINGLE QUOTE
BCAIECC	002565'	302140	000047		CAIE	C,"'"
BJRSTETC	002566'	254000	002571'		JRST	ET		;END OF TEXT
BPOPPPC	002567'	262757	000000		POP	P,(P)		;RESET STACK
BPOPJPC	002570'	263740	000000		POPJ	P,
BETPOPPKC	002571'	262740	000013	ET:	POP	P,K		;RESTORE FORMAT POINTER
BPOPPC	002572'	262740	000000		POP	P,0
BTLZISQF.C	002573'	621440	001000		TLZ	I,SQF.		;CCO 30-12, CLEAR SINGLE QUOTE FLG
BJRSTRIN.C	002574'	254000	002375'		JRST	RIN.		;RETURN TO SCAN
BC				;CHARACTER IS X
BC
BXIO.TLZIDF.C	002575'	621440	000001	XIO.:	TLZ	I,DF.		;CLEAR DIG FLG
BJUMPGEIXINPTC	002576'	325440	002603'		JUMPGE	I,XINPT		;JUMP IF INPUT
BMOVEIC	002577'	201000	000040		MOVEI	0," "		;BLANK
BPUSHJPDEPOT.C	002600'	260740	003121'		PUSHJ	P,DEPOT.	;OUTPUT A BLANK
BSOJGAC	002601'	367040	002600'		SOJG	A,.-1
BJRSTRIN.C	002602'	254000	002375'		JRST	RIN.
BXINPTPUSHJPCHINN.C	002603'	260740	003601'	XINPT:	PUSHJ	P,CHINN.	;SKIP A CHARACTER
BSKIPNOVFLS.LOWC	002604'	336000	000111'		SKIPN	OVFLS.(LOW)	;DON'T ADVANCE IF END OF LINE
BXCTIIB.C	002605'	256000	003637'		XCT	IIB.		;ADVANCE INPUT POINTER
BSOJGAXINPTC	002606'	367040	002603'		SOJG	A,XINPT
BJRSTRIN.C	002607'	254000	002375'		JRST	RIN.
BC
BC
BC				;CHARACTER IS P
BC
BPIOTLZIDF.C	002610'	621440	000001	PIO:	TLZ	I,DF.		;CLEAR DIG FLAG
BTLZEISFSF.C	002611'	623440	200000		TLZE	I,SFSF.		;TEST FOR SCALE SIGN
BMOVNSAC	002612'	213000	000001		MOVNS	A		;SCALE NEGATIVE
BHRREAC	002613'	540240	000001		HRR	E,A		;SET SCALE FACTOR
BJRSTRIN.C	002614'	254000	002375'		JRST	RIN.
BC
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-20
FORSE.MAC	26-JUL-84 01:16		CHARACTER SCAN AND DISPATCH

BC				;CHARACTER IS T
BC
BTIOTLOAITFF.C	002615'	665440	020000	TIO:	TLOA	I,TFF.		;T FORMAT AND SKIP
BC
BC				;CHARACTER IS $
BC
BDOLSGNTLONDOLFL.C	002616'	661700	000004	DOLSGN:	TLO	N,DOLFL.	;$ CARRIAGE CONTROL CHAR.
BTLZIDF.C	002617'	621440	000001		TLZ	I,DF.		;CLEAR DIG FLG
BJRSTRIN.C	002620'	254000	002375'		JRST	RIN.		;RETURN TO SCAN
BC
BC				;CHARACTER IS A,D,E,F,G,I,L,O
BC
BC				;CHARACTER IS G
BC
BGCONVTLOAEGTYP.C	002621'	665240	200000	GCONV:	TLOA	E,GTYP.		;G FLAG
BC
BAEIOUPUSHJPRTNSETC	002622'	260740	002627'	AEIOU:	PUSHJ	P,RTNSET	;PICK UP CONV. ROUTINE ADDRESS
BAEIOU1MOVEMAFRPTC.LOWC	002623'	202040	001725'	AEIOU1:	MOVEM	A,FRPTC.(LOW)	;SAVE DATA COUNT
BSETZAC	002624'	400040	000000		SETZ	A,		;CLEAR DECIMAL DIGIT AC
BTLZIDF.C	002625'	621440	000001		TLZ	I,DF.		;CLEAR DIG FLAG
BJRSTINC	002626'	254000	002400'		JRST	IN		;RETURN TO FORMAT SCAN
BC
BRTNSETLDBCPOINTDISTABCC	002627'	135140	007116'	RTNSET:	LDB	C,[POINT 6,DISTAB(C),11];ROUTINE INDEX
BJUMPGEIC	002630'	325440	002632'		JUMPGE	I,.+2		;INPUT OR OUTPUT ROUTINE NEEDED?
BADDICC	002631'	271140	000001		ADDI	C,1		;OUTPUT
BHRRIIOADR.CC	002632'	540443	000000*		HRR	I,IOADR.(C)	;PICK UP ROUTINE ADDRESS
BPOPJPC	002633'	263740	000000		POPJ	P,
BC
BC				;CHARACTER IS ,
BC
BCOMAPUSHJPCOMMAC	002634'	260740	002641'	COMA:	PUSHJ	P,COMMA		;CONVERSION,IF ANY
BJRSTRIN.C	002635'	254000	002375'		JRST	RIN.
BC
BC				;CHARACTER IS E
BC
BECONVTLOAEETYP.C	002636'	665240	400000	ECONV:	TLOA	E,ETYP.		;SET E FLAG AND SKIP
BC
BC				;CHARACTER IS D
BC
BDCONVTLOEDTYP.C	002637'	661240	100000	DCONV:	TLO	E,DTYP.		;SET D FLAG
BJRSTAEIOUC	002640'	254000	002622'		JRST	AEIOU
BC				;ROUTINE TO SET FORMAT WORD & GO TO CONVERSION SUBPROGRAMS
BC
BCOMMATLZIDF.C	002641'	621440	000001	COMMA:	TLZ	I,DF.		;CLEAR DIG FLAG
BTLZEITFF.C	002642'	623440	020000		TLZE	I,TFF.		;T FORMAT?
BJRSTTFMT.C	002643'	254000	000000*		JRST	TFMT.		;YES
BTLNEEGTYP.C	002644'	603240	200000		TLNE	E,GTYP.		; G TYPE?
BJRSTCOMMA1C	002645'	254000	002653'		JRST	COMMA1		;YES
BTRNNIC	002646'	606440	777777		TRNN	I,-1		;CONVERSION NECESSARY?
BJRSTC	002647'	254000	002651'		JRST	.+2		;**V31/01**MONEY* 
BJRSTCOMMA1C	002650'	254000	002653'		JRST	COMMA1		;**V31/01**MONEY*
BSETZMDECFLGC	002651'	402000	000107'		SETZM	,DECFLG		;**V31/01**MONEY* CLEAR DEC PT FLG
BPOPJPC	002652'	263740	000000		POPJ	P,		;NO CONVERSION
BCOMMA1ANDIADFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-21
FORSE.MAC	26-JUL-84 01:16		CHARACTER SCAN AND DISPATCH

BC	002653'	405040	000177	COMMA1:	ANDI	A,177		;W AND D MOD 128
BMOVSSAC	002654'	207000	000001		MOVSS	A
BSKIPEDECFLGC	002655'	332000	000107'		SKIPE	,DECFLG		;**V31/01**MONEY* DEC PT READ?
BC				;**	TLNE	E,177		;IS THERE A FIELD WIDTH?
BASHAC	002656'	240040	000007		ASH	A,7		;SHIFT TO D FIELD
BIOREAC	002657'	434240	000001		IOR	E,A
BSETZMDECFLGC	002660'	402000	000107'		SETZM	,DECFLG		;**V31/01**MONEY* CLEAR DEC PT FLG
BTLZNIRTNF.C	002661'	627440	100000		TLZN	I,RTNF.		;RETURN SWITCH ON?
BJRSTIORTR.C	002662'	254000	002467'		JRST	IORTR.		;GET AN ADDRESS
BJRSTCNVTC	002663'	254000	002714'		JRST	CNVT		;DO CONVERSION
BSUBTTLC				SUBTTL	DATA. UUO
BC
BDATAJUMPLNDATA1C	002664'	321700	002667'	DATA:	JUMPL	N,DATA1		;ALREADY RESTORED?
BIFNREENTC				IFN REENT,<MOVSI 0,SAVFAC+E(LOW)	;RESTORE OP SYS AC'S
BC					HRRI	0,E		;BUT ONLY THE USEFUL ONES>
BIFEREENTMOVSESAVFACEC	002665'	204000	007053'	IFE REENT,<MOVS	0,[E,,SAVFAC+E]>
BBLTC	002666'	251000	000015		BLT	0,15		;ALL BUT 16 AND 17
BDATA1HRRZCAC	002667'	550140	000001	DATA1:	HRRZ	C,A		;UUO ADDRESS
BCAIGECC	002670'	305140	000020		CAIGE	C,20		;SEE IF DATUM IN AC
BADDICSAVEACLOWC	002671'	271140	000031'		ADDI	C,SAVEAC(LOW)	;YES,PICK UP FROM SAVE LOC.
BMOVEMCDADDR.LOWC	002672'	202140	001335'		MOVEM	C,DADDR.(LOW)	;SAVE DATA ADDRESS
BLDBCPTRUC	002673'	135140	007051'		LDB	C,PTRU		;AC FIELD CONTAINS TYPE CODE
BMOVEMCTYPE.LOWC	002674'	202140	001503'		MOVEM	C,TYPE.(LOW)	;SAVE TYPE
BCAIGECC	002675'	305140	000006		CAIGE	C,6		;IF DATA IS NEITHER COMPLEX NOR
BJRSTTFBC	002676'	254000	002707'		JRST	TFB		;DOUBLE PRECISION, GO TO TFB
BCAINCC	002677'	306140	000007		CAIN	C,7		;IF DATA IS COMPLEX,
BJRSTTFBM3C	002700'	254000	002704'		JRST	TFBM3		;OR
BHRRZIC	002701'	550000	000011		HRRZ	0,I		;IF DATA IS DOUBLE PRECISION
BCAIEC	002702'	302000	000014		CAIE	0,14		;AND THE MODE IS BINARY, GO
BJRSTTFB3C	002703'	254000	002712'		JRST	TFB3		;TO TFBM3.
BTFBM3TLOISLIOF.C	002704'	661440	010000	TFBM3:	TLO	I,SLIOF.	;SET SLIST FLAG
BMOVSIHC	002705'	205400	777776		MOVSI	H,-2		;ARRAY OF LENGTH 2
BHRRHAC	002706'	540400	000001		HRR	H,A		;ARRAY ADDRESS
BTFBHRRZIC	002707'	550000	000011	TFB:	HRRZ	0,I		;PICK UP MODE
BCAINC	002710'	306000	000014		CAIN	0,14		;BINARY MODE?
BJRSTBINDT.C	002711'	254000	006717'		JRST	BINDT.		;YES
BTFB3TLNEIRTNF.C	002712'	603440	100000	TFB3:	TLNE	I,RTNF.		;RETURN SWITCH ON?
BJRSTRIN.C	002713'	254000	002375'		JRST	RIN.		;YES,GO TO FORMAT SCAN
BCNVTSKIPGEFRPTC.LOWC	002714'	335000	001725'	CNVT:	SKIPGE	FRPTC.(LOW)	;CHECK REPEAT COUNT
BPOPJPC	002715'	263740	000000		POPJ	P,
BTLNNEGTYP.C	002716'	607240	200000		TLNN	E,GTYP.		;G FORMAT?
BJRSTNOTGTYC	002717'	254000	002724'		JRST	NOTGTY		;NO
BMOVECTYPE.LOWC	002720'	200140	001503'		MOVE	C,TYPE.(LOW)	;PICK UP DATUM TYPE
BCAINCC	002721'	306140	000006		CAIN	C,6		;CHECK FOR DOUBLE WORD
BTLOEDTYP.C	002722'	661240	100000		TLO	E,DTYP.		;SETS DOUBLE PRECISION
BPUSHJPRTNSETC	002723'	260740	002627'		PUSHJ	P,RTNSET	;PICK UP CONV. ROUTINE ADDRESS
BNOTGTYPUSHPEC	002724'	261740	000005	NOTGTY:	PUSH	P,E		;FORMAT SPECIFICATION
BMOVECDADDR.LOWC	002725'	200140	001335'		MOVE	C,DADDR.(LOW)	;ADDRESS OF DATUM
BJUMPLIOUTCNVC	002726'	321440	002741'		JUMPL	I,OUTCNV	;JUMP IF OUTPUT
BPUSHJPIC	002727'	260751	000000		PUSHJ	P,(I)		;INPUT CONVERSION
BJRSTCHECKC	002730'	254000	002745'		JRST	CHECK		;ILLEGAL CHAR IN INPUT
BMOVEMCC	002731'	202003	000000		MOVEM	0,(C)		;STORE HIGH ORDER WORD
BTLNEEDTYP.C	002732'	603240	100000		TLNE	E,DTYP.		;IS THERE A LOW ORDER PART?
BMOVEMACDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-22
FORSE.MAC	26-JUL-84 01:16		DATA. UUO

BC	002733'	202043	000001		MOVEM	A,1(C)		;YES ,STORE IT
BSOSOPOPPC	002734'	262740	000000	SOSO:	POP	P,0		;ACCOUNT FOR FORMAT WORD
BSOSLEFRPTC.LOWC	002735'	373000	001725'		SOSLE	FRPTC.(LOW)
BJRSTIORTR.C	002736'	254000	002467'		JRST	IORTR.		;GET NEXT ADDRESS
BTLZEGTYP.C	002737'	621240	200000		TLZ	E,GTYP.		; CLEAR G FORMAT FLAG
BPOPJPC	002740'	263740	000000		POPJ	P,		;REPEAT COUNT IS ZERO
BC
BOUTCNVMOVECC	002741'	200003	000000	OUTCNV:	MOVE	0,(C)		;PICK UP HIGH ORDER PART
BMOVEACC	002742'	200043	000001		MOVE	A,1(C)		;PICK UP LOW ORDER PART
BPUSHJPIC	002743'	260751	000000		PUSHJ	P,(I)		;OUTPUT CONVERSION
BJRSTSOSOC	002744'	254000	002734'		JRST	SOSO
BC
BC
BCHECKSKIPNERR.LOWC	002745'	336000	000121'	CHECK:	SKIPN	ERR.(LOW)	;DOES THE USER DESIRE PROGRAM CONTROL?
BJRSTILLCH.C	002746'	254000	000000*		JRST	ILLCH.		;NO, PRINT ERROR MESSAGE AND FAIL
BXCTIIB.C	002747'	256000	003637'		XCT	IIB.		;ADVANCE TO NEXT CHARACTER
BPUSHJPNXTCRC	002750'	260740	003675'		PUSHJ	P,NXTCR		;YES,FINISH UP THIS LINE
BJRSTFI.C	002751'	254000	003506'		JRST	FI.		;GO TO POSITION SPECIFIED
BC
BSUBTTLC				SUBTTL	SLIST. UUO    SHORT LIST I/O
BC
BC				;THE AC OF THE SLIST UUO CONTAINS THE TYPE CODE--0 FOR INTEGER,
BC				;6 FOR DOUBLE PRECISION, AND 7 FOR COMPLEX.  FOR DOUBLE
BC				;PRECISION TWO WORDS ARE PASSED AT A TIME. THE ADDRESS OF
BC				;THE UUO CONTAINS THE ARRAY BASE ADDRESS. THE WORD FOLLOWING
BC				;THE SLIST. UUO CONTAINS THE LENGTH OF THE ARRAY.
BC				;ADDRESS OF THE ARRAY IN THE RIGHT HALF.
BC
BC
BC
BSLISTJUMPLNSLIST1C	002752'	321700	002755'	SLIST:	JUMPL	N,SLIST1	;ALREADY RESTORED?
BIFNREENTC				IFN REENT,<MOVSI 0,SAVFAC+E(LOW)	;RESTORE OP SYS AC'S
BC					HRRI	0,E		;BUT ONLY THE USEFUL ONES>
BIFEREENTMOVSESAVFACEC	002753'	204000	007053'	IFE REENT,<MOVS 0,[E,,SAVFAC+E]>
BBLTC	002754'	251000	000015		BLT	0,15		;ALL BUT 16 AND 17
BSLIST1TLOISLIOF.C	002755'	661440	010000	SLIST1:	TLO	I,SLIOF.	;SLIST FLAG
BLDBCPTRUC	002756'	135140	007051'		LDB	C,PTRU		;AC FIELD OF UUO
BMOVEMCTYPE.LOWC	002757'	202140	001503'		MOVEM	C,TYPE.(LOW)	;SAVE TYPE CODE
BHRLZHUUOH.LOWC	002760'	514420	002076'		HRLZ	H,@UUOH.(LOW)	;ARRAY LENGTH
BAOSUUOH.LOWC	002761'	350000	002076'		AOS	UUOH.(LOW)	;UPDATE RETURN ADDRESS
BHRRZIC	002762'	550000	000011		HRRZ	0,I
BCAINC	002763'	306000	000014		CAIN	0,14		;SKIP IF NOT BINARY MODE
BJRSTSLISTBC	002764'	254000	003002'		JRST	SLISTB		;CAN DO BLT'S FOR BINARY MODE ARRAYS
BMOVNSHC	002765'	213000	000010		MOVNS	H		;NEGATE LENGTH
BCAINCC	002766'	306140	000007		CAIN	C,7		;IS ARRAY COMPLEX?
BASHHC	002767'	240400	000001		ASH	H,1		;YES,MULTIPLY BY 2
BCAINCC	002770'	306140	000006		CAIN	C,6		;IS ARRAY DOUBLE PRECISION?
BTLOIDPSF.C	002771'	661440	000020		TLO	I,DPSF.		;YES,SET FLAG
BHRRHAC	002772'	540400	000001		HRR	H,A		;BASE ADDRESS
BHRS1HRRZMHDADDR.LOWC	002773'	552400	001335'	HRS1:	HRRZM	H,DADDR.(LOW)	;SAVE SLIST ADDRESS
BJRSTTFBC	002774'	254000	002707'		JRST	TFB		;DO CONVERSION OR SCAN
BC
BC				;CONTROL TRANSFERRED HERE FOR EACH ADDRESS
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-23
FORSE.MAC	26-JUL-84 01:16		SLIST. UUO    SHORT LIST I/O

BC				;ALSO USED FOR SINGLE COMPLEX ITEMS.
BC
BNASTLNEIDPSF.C	002775'	603440	000020	NAS:	TLNE	I,DPSF.		;IS ARRAY DOUBLE PRECISION?
BADDIHC	002776'	271400	000001		ADDI	H,1		;ACCOUNT FOR 2 WORDS
BAOBJNHHRS1C	002777'	253400	002773'		AOBJN	H,HRS1		;SET FOR NEXT DATUM
BTLZISLIOF.DPSF.C	003000'	621440	010020		TLZ	I,SLIOF.!DPSF.	;RESET SLIST FLAGS
BJRSTNASBAKC	003001'	254000	002471'		JRST	NASBAK		;RETURN TO USER
BC
BC				;HERE FOR BINARY MODE ARRAYS
BC
BSLISTBHRRZMADADDR.LOWC	003002'	552040	001335'	SLISTB:	HRRZM	A,DADDR.(LOW)	;ADDRESS OF ARRAY
BHLRZSHC	003003'	557000	000010		HLRZS	H		;LENGTH OF ARRAY
BCAIECC	003004'	302140	000006		CAIE	C,6		;DOUBLE PRECISION?
BCAINCC	003005'	306140	000007		CAIN	C,7		;OR COMPLEX?
BASHHC	003006'	240400	000001		ASH	H,1		;YES, DOUBLE NUMBER OF WORDS
BADDMHASVAR.LOWC	003007'	272400	001764'		ADDM	H,ASVAR.(LOW)	;ADJUST FILE POSITION
BSLISB0SKIPLEMC	003010'	333007	000002	SLISB0:	SKIPLE	2(M)		;SKIP IF I/O NEEDED
BJRSTSLISB2C	003011'	254000	003016'		JRST	SLISB2		;NO I/O REQUIRED
BJUMPGEISLISB1C	003012'	325440	003015'		JUMPGE	I,SLISB1	;JUMP IF INPUT
BPUSHJPOUTPTC	003013'	260740	006733'		PUSHJ	P,OUTPT		;OUTPUT BUFFER
BJRSTSLISB2C	003014'	254000	003016'		JRST	SLISB2
BSLISB1PUSHJPINPT.C	003015'	260740	007025'	SLISB1:	PUSHJ	P,INPT.		;FILL BUFFER
BSLISB2MOVECHC	003016'	200140	000010	SLISB2:	MOVE	C,H		;C=WORDS STILL NEEDED
BCAMLECMC	003017'	313147	000002		CAMLE	C,2(M)		;SKIP IF FITS IN BUFFER
BMOVECMC	003020'	200147	000002		MOVE	C,2(M)		;NO, CUT DOWN TO BUFFER SIZE
BSUBHCC	003021'	274400	000003		SUB	H,C		;SUBTRACT WORDS TO BE TRANSFERRED
BSUBMCMC	003022'	276147	000002		SUBM	C,2(M)		;SUBTRACT WORDS TRANSFERRED FROM WORDS LEFT IN BUFFER
BMOVNSMC	003023'	213007	000002		MOVNS	2(M)		;EXCEPT ITS NEGATIVE THAT WAY
BHRLZADADDR.LOWC	003024'	514040	001335'		HRLZ	A,DADDR.(LOW)	;ADDRESS IN ARRAY OF NEXT DATUM
BHRRAMC	003025'	540047	000001		HRR	A,1(M)		;ADDR OF BUFFER - 1
BADDIAC	003026'	271040	000001		ADDI	A,1		;BLT POINTER
BJUMPGEISLISB4C	003027'	325440	003033'		JUMPGE	I,SLISB4	;JUMP IF INPUT
BADDMCDADDR.LOWC	003030'	272140	001335'		ADDM	C,DADDR.(LOW)	;ADDR PAST END OF THIS BLT FROM ARRAY
BADDBCMC	003031'	273147	000001		ADDB	C,1(M)		;AND LAST ADDRESS IN BUFFER FOR BLT
BAOJACSLISB5C	003032'	344140	003036'		AOJA	C,SLISB5	;+1 FOR OUTPUT - ALL SET FOR BLT
BSLISB4ADDMCMC	003033'	272147	000001	SLISB4:	ADDM	C,1(M)		;ADDR IN BUFFER AFTER BLT FOR INPUT
BADDBCDADDR.LOWC	003034'	273140	001335'		ADDB	C,DADDR.(LOW)	;ADDR PAST END OF BLT IN ARRAY FOR INPUT
BMOVSSAC	003035'	207000	000001		MOVSS	A		;SWAP BLT POINTER FOR INPUT
BSLISB5BLTACC	003036'	251043	777777	SLISB5:	BLT	A,-1(C)		;TRANSFER DATA TO/FROM BUFFER
BJUMPNHSLISB0C	003037'	326400	003010'		JUMPN	H,SLISB0	;LOOP IF MORE DATA IN ARRAY
BTLZISLIOF.DPSF.C	003040'	621440	010020		TLZ	I,SLIOF.!DPSF.	;ALL DONE, CLEAR SLIST FLAGS
BJUMPGEINASBAKC	003041'	325440	002471'		JUMPGE	I,NASBAK	;EXIT IF INPUT
BSKIPLRANAC.LOWC	003042'	331000	001760'		SKIPL	RANAC.(LOW)	;IS IT RANDOM ACCESS OUTPUT
BJRSTNASBAKC	003043'	254000	002471'		JRST	NASBAK		;NO. EXIT
BLDBCPOINTMC	003044'	135140	007077'		LDB	C,[POINT 4,M,12]	;YES. GET CHANNEL NUMBER
BHRROSRANDV.CC	003045'	563003	000353'		HRROS	RANDV.(C)	;MARK AS NEEDS TO BE OUTPUTTED
BJRSTNASBAKC	003046'	254000	002471'		JRST	NASBAK		;AND EXIT
BSUBTTLC				SUBTTL	TABLE OF POINTERS FOR CHARACTER DISPATCH
BC
BPTRTABREPEATC	003047'			PTRTAB:	REPEAT 7,<	POINT 5,IRTAB(C),34-<.-PTRTAB>*5>
BPOINTIRTABCPTRTABC	003047'	010503	003056'		POINT 5,IRTAB(C),34-<.-PTRTAB>*5
BPOINTIRTABCPTRTABC	003050'	060503	003056'		POINT 5,IRTAB(C),34-<.-PTRTAB>*5
BPOINTIRTABCPTRTABC	003051'	130503	003056'		POINT 5,IRTAB(C),34-<.-PTRTAB>*5
BPOINTIRTABCPTRTABDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-24
FORSE.MAC	26-JUL-84 01:16		TABLE OF POINTERS FOR CHARACTER DISPATCH

BC	003052'	200503	003056'		POINT 5,IRTAB(C),34-<.-PTRTAB>*5
BPOINTIRTABCPTRTABC	003053'	250503	003056'		POINT 5,IRTAB(C),34-<.-PTRTAB>*5
BPOINTIRTABCPTRTABC	003054'	320503	003056'		POINT 5,IRTAB(C),34-<.-PTRTAB>*5
BPOINTIRTABCPTRTABC	003055'	370503	003056'		POINT 5,IRTAB(C),34-<.-PTRTAB>*5
BC
BC
BC				;TABLE OF DISPATCHING INDICES
BC
BIRTABBYTEC	003056'	000260	000020	IRTAB:	BYTE (5) 0,0,26,0,0,0,10
BBYTEC	003057'	145500	051150		BYTE (5) 6,13,10,0,12,11,24
BBYTEC	003060'	163471	634112		BYTE (5) 7,7,7,7,7,1,5
BBYTEC	003061'	000071	634716		BYTE (5) 0,0,7,7,7,7,7
BBYTEC	003062'	007000	000000		BYTE (5) 0,16,0,0,0,0,0
BBYTEC	003063'	401143	666300		BYTE (5) 20,2,14,17,15,23,0
BBYTEC	003064'	070405	710000		BYTE (5) 3,21,0,27,22,0,0	;**V31/01**MONEY*
BBYTEC	003065'	000005	200000		BYTE (5) 0,0,0,25,0,0,0
BBYTEC	003066'	000000	000010		BYTE (5) 0,0,0,0,0,0,4
BBYTEC	003067'	000000	000000		BYTE (5) 0,0,0,0,0,0,0
BSUBTTLC				SUBTTL	DISPATCH TABLE USED FOR CHARACTER DISPATCH
BC				;AND INDICES FOR CONVERSION ROUTINE NAMES.
BC				;THE LEFT HALF OF THE FIRST 8 ENTRIES CONTAINS AN INDEX
BC				;TO ENTRIES IN THE TABLE OF CONV. ROUTINE ADDRESSES,IOADR.,
BC				;FOR G FORMAT.
BC				;THE LEFT HALF OF THE ENTRIES FOR E,A,F,I,O,L,D CONTAINS
BC				;AN INDEX TO THE ENTRIES IN IOADR. CORRESPONDING TO E,A,F,I,O,L,D.
BC
BDISTABXWDERROR1C	003070'	000400	003120'	DISTAB:	XWD	400,ERROR1	; ILLEGAL
BXWDSLASHC	003071'	000000	002505'		XWD	000,SLASH	;/
BXWDHIOC	003072'	000200	002514'		XWD	200,HIO		;H
BXWDPIOC	003073'	001000	002610'		XWD	1000,PIO	;P
BXWDXIO.C	003074'	000600	002575'		XWD	600,XIO.	;X
BXWDDECPTC	003075'	000000	002425'		XWD	000,DECPT	;.
BXWDNEGSCC	003076'	001200	002502'		XWD	1200,NEGSC	;-
BXWDDIGC	003077'	000200	002415'		XWD	200,DIG		;0-9
BXWDINC	003100'	000000	002400'		XWD	000,IN		;BLANK OR +
BXWDPARLFC	003101'	000000	002432'		XWD	0,PARLF		;(
BXWDPARRC	003102'	000000	002450'		XWD	0,PARR		;)
BXWDCOMAC	003103'	000000	002634'		XWD	0,COMA		;,
BXWDGCONVC	003104'	000000	002621'		XWD	000,GCONV	;G
BXWDECONVC	003105'	000200	002636'		XWD	200,ECONV	;E FLOATING
BXWDAEIOUC	003106'	000000	002622'		XWD	000,AEIOU	;A ALPHANUMERIC
BXWDAEIOUC	003107'	000200	002622'		XWD	200,AEIOU	;F FLOATING
BXWDAEIOUC	003110'	000400	002622'		XWD	400,AEIOU	;I FIXED
BXWDAEIOUC	003111'	000600	002622'		XWD	600,AEIOU	;O OCTAL
BXWDAEIOUC	003112'	001000	002622'		XWD	1000,AEIOU	;L LOGICAL
BXWDDCONVC	003113'	001200	002637'		XWD	1200,DCONV	;D    DOUBLE PRECISION
BXWDSQUOTEC	003114'	000000	002512'		XWD	000,SQUOTE	;'   TEXT
BXWDTIOC	003115'	000000	002615'		XWD	000,TIO		;T  COLUMN SETTING
BXWDDOLSGNC	003116'	000000	002616'		XWD	000,DOLSGN	;$ CARRIAGE CONTROL
BXWDAEIOUC	003117'	001400	002622'		XWD	1400,AEIOU	;**V31/01**MONEY*
BC
BERROR1PUSHJPERROR.C	003120'	260740	000000*	ERROR1:	PUSHJ	P,ERROR.	;ILLEGAL CHARACTER IN FORMAT
BSUBTTLC				SUBTTL	OUTPUT ROUTINES
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-25
FORSE.MAC	26-JUL-84 01:16		OUTPUT ROUTINES

BC
BC				;DEPOT. IS CALLED BY ALL OUTPUT ROUTINES FOR DEPOSITING
BC				;CHARACTERS IN THE OUTPUT BUFFER AND DOING OUTPUTS. THE
BC				;CHARACTER IS SENT IN AC 0 AND AC M IS USED.DEPOT. IS 
BC				;CALLED BY   PUSHJ P,DEPOT.
BC
BDEPOT.TLNENENCFL.C	003121'	603700	000040	DEPOT.:	TLNE	N,ENCFL.	;++ ENCODE?
BJRSTENCOUTC	003122'	254000	003336'		JRST	ENCOUT		;++ DON'T MESS AROUND WITH CRLF STUFF
BC				;       THE FOLLOWING LINES WERE ADDED BYB CLC 02-05-74 TO FIX BUG
BC				;       24694 RANDOUT,SYMBOLIC FILE.
BCAIECRC	003123'	302000	000015	        CAIE    0,CR            ; IS IT A CR CLC:02-05-74
BJRSTDEPOT1C	003124'	254000	003126'	        JRST    DEPOT1          ; NO IT ISN'T CLC:02-05-74
BTLNNNDOLFL.C	003125'	607700	000004	        TLNN    N,DOLFL.        ;SHOULD IT BE SUPRESSED CLC:02-05-74
BDEPOT1AOSASVAR.LOWC	003126'	350000	001764'	DEPOT1: AOS     ASVAR.(LOW)     ; NOT TO BE DEPRESSED SO INCREMENT CTR.
BAOSGEOL.LOWC	003127'	357000	001334'		AOSG	EOL.(LOW)	;IS THIS THE FIRST CHARACTER?
BJRSTFRSTCHC	003130'	254000	003301'		JRST	FRSTCH		;YES, MAKE SOME CHECKS
BC								;NOT FIRST CHARACTER SO FALL INTO CO
BC
BC				;OUTPUT ROUTINE CALLED BY DEPOT. FOR DEPOSITING CHARACTERS
BC				;IN PROPER BUFFER,CHECKING LINES FOR OVERFLOW, DOING OUTPUTS
BC				;AND ERROR CHECKING.
BC
BCOSKIPGHDRADDLOWC	003131'	337000	000074'	CO:	SKIPG	HDRADD(LOW)	;LINE BUFFER IN USE?
BJRSTDLBC	003132'	254000	003227'		JRST	DLB		;NO
BTLNNNDOLFL.C	003133'	607700	000004		TLNN	N,DOLFL.	;SHOULD CR BE SURPRESSED
BJRSTCO1C	003134'	254000	003142'		JRST	CO1		;NO
BCAIECRC	003135'	302000	000015		CAIE	0,CR		;YES. IS IT A CR
BJRSTCO1C	003136'	254000	003142'		JRST	CO1		;NO
BTLZNDOLFL.C	003137'	621700	000004		TLZ	N,DOLFL.	;YES. RESET SURPRESSION FLAG
BPUSHPC	003140'	261740	000000		PUSH	P,0		;SAVE OUTPUT CHARACTER
BJRSTSTLF2C	003141'	254000	003156'		JRST	STLF2		;AND GO DUMP BUFFER
BCO1SKIPEOVFLS.LOWC	003142'	332000	000111'	CO1:	SKIPE	OVFLS.(LOW)	;LINE OVERFLOW?
BJRSTLBCRCKC	003143'	254000	003147'		JRST	LBCRCK		;YES,LOOK FOR CR
BIDPBMC	003144'	136007	000001		IDPB	0,1(M)		;NO,DEPOSIT CHARACTER
BSOSGMC	003145'	377007	000002		SOSG	2(M)		;BUFFER FULL?
BJRSTLBXCDC	003146'	254000	003215'		JRST	LBXCD		;YES,STASH CR,LF
BLBCRCKCAIECRC	003147'	302000	000015	LBCRCK:	CAIE	0,CR		;CARRIAGE RETURN?
BPOPJPC	003150'	263740	000000		POPJ	P,		;NO,KEEP LOOKING
BSTLFPUSHPC	003151'	261740	000000	STLF:	PUSH	P,0		;SAVE OUTPUT CHARACTER
BMOVEILFC	003152'	201000	000012		MOVEI	0,LF		;PICK UP A LINEFEED
BIDPBMC	003153'	136007	000001		IDPB	0,1(M)		;DEPOSIT IT
BAOSASVAR.LOWC	003154'	350000	001764'		AOS	ASVAR.(LOW)	;ACCOUNT FOR LINEFEED
BSOSMC	003155'	370007	000002		SOS	2(M)
BSTLF2PUSHPAC	003156'	261740	000001	STLF2:	PUSH	P,A		;GET AN AC. TO PLAY WITH
BPUSHPBC	003157'	261740	000002		PUSH	P,B
BPUSHPCC	003160'	261740	000003		PUSH	P,C
BSETZMOVFLS.LOWC	003161'	402000	000111'		SETZM	OVFLS.(LOW)	;CLEAR LINE OVERFLOW SWITCH
BHRRAHDRADDLOWC	003162'	540040	000074'		HRR	A,HDRADD(LOW)	;ADDRESS OF REAL BUFFER HEADER
BMOVECMC	003163'	200147	000002		MOVE	C,2(M)		;COUNT OF CHARS. LEFT IN LINE BUFFER
BSUBICLINCHC	003164'	275140	001177		SUBI	C,LINCH		;LENGTH OF LINE BUFFER
BMOVEBLBPTRLOWC	003165'	200100	000002'		MOVE	B,LBPTR(LOW)	;GET INTIAL BUFFER POINTER
BSTLF1ILDBBC	003166'	134000	000002	STLF1:	ILDB	0,B		;GET NEXT CHAR FROM LINE BUFF
BIDPBAC	003167'	136001	000001		IDPB	0,1(A)		;STORE IN REAL BUFFER
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-26
FORSE.MAC	26-JUL-84 01:16		OUTPUT ROUTINES

BC				;***********BUG FIX*****1/16/75*************************************
BSKIPLRANAC.LOWC	003170'	331000	001760'		SKIPL	RANAC.(LOW)	;IS THIS FILE RANDOM ACCESS?
BJRSTSTLF4C	003171'	254000	003176'		JRST	STLF4		;NO - NO PROBLEM
BPUSHPCC	003172'	261740	000003		PUSH	P,C		;GET AN AC
BLDBCPOINTMC	003173'	135140	007077'		LDB	C,[POINT 4,M,12]	;GET CHANNEL #
BHRROSRANDV.CC	003174'	563003	000353'		HRROS	RANDV.(C)	;SET NEEDS-TO-BE-OUTPUT FLAG INDICATING
BC								;A NON-EMPTY BUFFER
BPOPPCC	003175'	262740	000003		POP	P,C		;RESTORE AC
BSTLF4SOSGAC	003176'	377001	000002	STLF4:	SOSG	2(A)		;BUFFER FULL
BPUSHJPOUTOKC	003177'	260740	003271'		PUSHJ	P,OUTOK		;YES. DUMP BUFFER
BAOJLCSTLF1C	003200'	341140	003166'		AOJL	C,STLF1		;LOOP ON CHARS IN LINE BUFFER
BC				;********************END OF PATCH*********************************
BSTLF3SETZMLINBUFLOWC	003201'	402000	001517'	STLF3:	SETZM	LINBUF(LOW)	;CLEAR LINE BUFFER
BIFEREENTMOVEXWDLINBUFLINBUFC	003202'	200000	007117'	IFE REENT,<MOVE	0,[XWD LINBUF,LINBUF+1]>
BIFNREENTC				IFN REENT,<MOVSI 0,LINBUF(LOW)
BC					HRRI	0,LINBUF+1(LOW)>
BBLTMC	003203'	251027	000001		BLT	0,@1(M)		;CLEAR UP TO LAST WORD USED
BMOVEILINCHC	003204'	201000	001177		MOVEI	0,LINCH		;RESET ITEM COUNT
BMOVEMMC	003205'	202007	000002		MOVEM	0,2(M)	
BMOVELBPTRLOWC	003206'	200000	000002'		MOVE	0,LBPTR(LOW)	;RESET POINTER
BMOVEMMC	003207'	202007	000001		MOVEM	0,1(M)		;TO BEGINNING OF LINE BUFFER
BPOPPCC	003210'	262740	000003		POP	P,C
BPOPPBC	003211'	262740	000002		POP	P,B
BPOPPAC	003212'	262740	000001		POP	P,A		;RESTORE A
BPOPPC	003213'	262740	000000		POP	P,0		;RESTORE CHARACTER
BPOPJPC	003214'	263740	000000		POPJ	P,		;RETURN
BLBXCDCAINCRC	003215'	306000	000015	LBXCD:	CAIN	0,CR		;WAS LAST CHAR. A CR?
BJRSTSTLFC	003216'	254000	003151'		JRST	STLF		;YES,STASH LF
BPUSHPC	003217'	261740	000000		PUSH	P,0		;SAVE CHAR.
BHRLIC	003220'	505000	170700		HRLI	0,170700	;NO,SET POINTER FOR CR
BHLLMMC	003221'	502007	000001		HLLM	0,1(M)
BMOVEICRC	003222'	201000	000015		MOVEI	0,CR		;PICK UP CR
BIDPBMC	003223'	136007	000001		IDPB	0,1(M)		;STASH IT
BSETOMOVFLS.LOWC	003224'	476000	000111'		SETOM	OVFLS.(LOW)	;SET LINE OVERFLOW FLAG
BPOPPC	003225'	262740	000000		POP	P,0		;RESTORE CHAR.
BPOPJPC	003226'	263740	000000		POPJ	P,
BC
BDLBIDPBMC	003227'	136007	000001	DLB:	IDPB	0,1(M)		;DEPOSIT CHARACTER
BSOSLEMC	003230'	373007	000002		SOSLE	2(M)		;DROP ITEM COUNT
BCAINCRC	003231'	306000	000015		CAIN	0,CR
BJRSTC	003232'	254000	003234'		JRST	.+2
BPOPJPC	003233'	263740	000000		POPJ	P,
BPUSHPC	003234'	261740	000000		PUSH	P,0		;SAVE CHAR.
BTLNENDOLFL.C	003235'	603700	000004		TLNE	N,DOLFL.	;CHECK FOR $
BMOVEIC	003236'	201000	000000		MOVEI	0,0		;YES,CLEAR OUT CR
BDPBMC	003237'	137007	000001		DPB	0,1(M)		;DEPOSIT CHARACTER
BSKIPGMC	003240'	337007	000002		SKIPG	2(M)		; *232* IS BUFFER FULL?
BJRSTDLB1C	003241'	254000	003245'		JRST	DLB1		; *232* YES, ALWAYS DO OUTPUT
BTLNNNSPLFL.C	003242'	607700	000100		TLNN	N,SPLFL.	;BUT NOT IF SPOOLING AND BUFFER NOT FULL
BTLNEIDDF.C	003243'	603440	000040		TLNE	I,DDF.		; *232* OR DSK
BJRSTDLB3C	003244'	254000	003267'		JRST	DLB3		; *232* SKIP OUTPUT FOR NOW
BDLB1SKIPETRAPF.LOWC	003245'	332000	000124'	DLB1:	SKIPE	TRAPF.(LOW)	;ARE TAPS SET
BTLNNNTERMF.C	003246'	607700	010000		TLNN	N,TERMF.		;AND IS OUTPUT TO TERMINAL
BJRSTDLB2DFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-27
FORSE.MAC	26-JUL-84 01:16		OUTPUT ROUTINES

BC	003247'	254000	003266'		JRST	DLB2		;NO
BMOVEIDLB4C	003250'	201000	003256'		MOVEI	0,DLB4		;WHERE TO GO IF TRAP DURING I/O
BMOVEMESCCLRLOWC	003251'	202000	000123'		MOVEM	0,ESCCLR(LOW)
BPUSHJPENAB.C	003252'	260740	003566'		PUSHJ	P,ENAB.	;ENABLE ESCAPES
BPUSHJPOUTOKC	003253'	260740	003271'		PUSHJ	P,OUTOK		;DO OUTPUT
BPUSHJPDISAB.C	003254'	260740	003563'		PUSHJ	P,DISAB.	;DISABLE TRAPS
BJRSTDLB3C	003255'	254000	003267'		JRST	DLB3
BDLB4HRRMC	003256'	540007	000000	DLB4:	HRR	0,0(M)		;ADDRESS OF BUFFER START
BHRLIPOINTC	003257'	505000	000700		HRLI	0,(POINT 7,,35)	;BYTE POINTER
BADDIC	003260'	271000	000001		ADDI	0,1		;TO START OF BUFFER
BMOVEMMC	003261'	202007	000001		MOVEM	0,1(M)		;STORE IN BUFFER
BMOVEIC	003262'	201000	000120		MOVEI	0,^D80		;SIZE OF TERMINAL BUFFER
BMOVEMMC	003263'	202007	000002		MOVEM	0,2(M)
BSETZMOVFLS.LOWC	003264'	402000	000111'		SETZM	OVFLS.(LOW)
BJRSTEDFINC	003265'	254000	003770'		JRST	EDFIN		;EXIT FROM FORSE
BDLB2PUSHJPOUTOKC	003266'	260740	003271'	DLB2:	PUSHJ	P,OUTOK		;DO OUTPUT AND CHECK STATUS
BDLB3POPPC	003267'	262740	000000	DLB3:	POP	P,0		;RESTORE CHAR.
BPOPJPC	003270'	263740	000000		POPJ	P,		;RETURN
BC
BOUTOKPUSHJPOUTT.C	003271'	260740	006262'	OUTOK:	PUSHJ	P,OUTT.		;DO OUTPUT
BPUSHPFC	003272'	261740	000006		PUSH	P,F		;SAVE F-USED FOR STATUS
BPUSHJPSTAT.C	003273'	260740	006215'		PUSHJ	P,STAT.		;GET STATUS
BTRNEFIOWERRIODERRIOPERRIOBKTLIOTENDC	003274'	602300	742000		TRNE	F,IOWERR!IODERR!IOPERR!IOBKTL!IOTEND
BPUSHJPIOERR.C	003275'	260740	003745'		PUSHJ	P,IOERR.	;I/O ERRORS
BSETZMOVFLS.LOWC	003276'	402000	000111'		SETZM	OVFLS.(LOW)	;CLEAR LINE OVERFLOW SWITCH
BPOPPFC	003277'	262740	000006		POP	P,F		;RESTORE F
BPOPJPC	003300'	263740	000000		POPJ	P,
BC				;HERE FOR FIRST CHARACTER ON A LINE
BC
BFRSTCHTLNENCDSFL.C	003301'	603700	000002	FRSTCH:	TLNE	N,CDSFL.	;CARDS...FORCE LF ON OUTPUT
BJRSTPUSHPC					JRST	[PUSH	P,0	;SAVE CHAR
BMOVEILFC						MOVEI	0,LF	;GET LINE FEED
BPUSHJPCOC						PUSHJ	P,CO	;OUTPUT IT
BPOPPC						POP	P,0	;GET THE CHAR
BJRSTCOC	003302'	254000	007120'			JRST	CO]	;OUTPUT THAT CHAR
BTLNNNSPLFL.C	003303'	607700	000100		TLNN	N,SPLFL.	;SPOOLING ALWAYS GOES TO DSK
BTLNNNTTYFL.C	003304'	607700	000001		TLNN	N,TTYFL.	;TTY OR LPT?
BJRSTCOC	003305'	254000	003131'		JRST	CO		;NO
BPUSHPC	003306'	261740	000000		PUSH	P,0		;SAVE 0
BPUSHPAC	003307'	261740	000001		PUSH	P,A		;SAVE AC
BMOVEAC	003310'	200040	000000		MOVE	A,0		;CONTROL CHARACTER
BMOVEILFC	003311'	201000	000012		MOVEI	0,LF		;LINE FEED
BCAINAC	003312'	306040	000060		CAIN	A,"0"		;0?
BJRSTZEC	003313'	254000	003327'		JRST	ZE		;YES
BCAINAC	003314'	306040	000040		CAIN	A," "		;BLANK?
BJRSTPOPAC	003315'	254000	003332'		JRST	POPA		;YES
BCAINAC	003316'	306040	000055		CAIN	A,"-"		;-  SKIP TWO LINES
BJRSTMIC	003317'	254000	003326'		JRST	MI		;MINUS SIGN
BHRRIAAC	003320'	541041	777726		HRRI	A,-52(A)	;LOOK FOR CODE
BJUMPLAPOPAC	003321'	321040	003332'		JUMPL	A,POPA		;SKIP A LINE IF NOT IN RANGE
BCAILEAC	003322'	303040	000011		CAILE	A,11		;NOT IN RANGE
BJRSTPOPAC	003323'	254000	003332'		JRST	POPA		;THEN ISSUE LF
BHRRZTABLEAC	003324'	550001	003347'		HRRZ	0,TABLE(A)	;SELECT CONTROL CHARACTER
BJRSTPOPADFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-28
FORSE.MAC	26-JUL-84 01:16		OUTPUT ROUTINES

BC	003325'	254000	003332'		JRST	POPA		;DEPOSIT CONTROL CHARACTER
BMIPUSHJPCOC	003326'	260740	003131'	MI:	PUSHJ	P,CO		;DEPOSIT CHARACTER
BZEPUSHJPCOC	003327'	260740	003131'	ZE:	PUSHJ	P,CO		;DEPOSIT CHARACTER
BPUSHJPOUTOKC	003330'	260740	003271'		PUSHJ	P,OUTOK		;OUTPUT EXTRA LF NOW
BC								;HELPS T FORMAT COUNT CORRECTLY
BMOVEILFC	003331'	201000	000012		MOVEI	0,LF		;RESTORE LF IN AC0
BC
BPOPAPOPPAC	003332'	262740	000001	POPA:	POP	P,A		;RESTORE A
BPUSHJPCOC	003333'	260740	003131'		PUSHJ	P,CO		;DEPOSIT CHARACTER
BNOLOK1POPPC	003334'	262740	000000	NOLOK1:	POP	P,0
BCPOPJPOPJPC	003335'	263740	000000	CPOPJ:	POPJ	P,
BC
BC
BC				;++ THIS REPLACES THE OUTPUT STUFF FOR REGULAR OUTPUT. DOES NO CRLF
BC				;++ INSERTS, JUST DEPOSITS CHAR.
BC
BENCOUTSKIPGEOVFLS.LOWC	003336'	335000	000111'	ENCOUT:	SKIPGE	OVFLS.(LOW)	;++LINE END. FMT OR CHAR CNT.
BJRSTENCOU1C	003337'	254000	003344'		JRST	ENCOU1		;++OVFLS. SET.
BIDPBMC	003340'	136007	000001		IDPB	0,1(M)		;++DEPOSIT BYTE
BSOSGMC	003341'	377007	000002		SOSG	2(M)		;++ DROP CHAR COUNT
BENCLNDSETOMOVFLS.LOWC	003342'	476000	000111'	ENCLND:	SETOM	OVFLS.(LOW)	;++END OF RECORD OR BUFFER.
BPOPJPC	003343'	263740	000000		POPJ	P,		;++RETURN FOR MORE
BC
BENCOU1SKIPGMC	003344'	337007	000002	ENCOU1:	SKIPG	2(M)		;WAS OVFLS. FMT OR COUNT?
BSETOMEDERRLOWC	003345'	476000	000105'		SETOM	EDERR(LOW)	;++COUNT TO ZERO. FATAL ERROR .
BPOPJPC	003346'	263740	000000		POPJ	P,		;++IF FMT END LINE IGNORE. RETURN.
BC
BTABLEOCTC	003347'	000000	000023	TABLE:	OCT 23			;*,CR WITH NO FF AFTER 60 LINES
BOCTC	003350'	000000	000000		OCT 0			;+, NULL
BOCTC	003351'	000000	000021		OCT 21			;,,THIRTIETH
BOCTC	003352'	000000	000000		OCT 0			;-,SKIP 2 LINES
BOCTC	003353'	000000	000022		OCT 22			;.,TWENTIETH
BOCTC	003354'	000000	000024		OCT 24			;/,SIXTH
BOCTC	003355'	000000	000000		OCT 0			;0,SKIP 1 LINE FF AFTER 60 LINES
BOCTC	003356'	000000	000014		OCT 14			;1,TOP OF FORM
BOCTC	003357'	000000	000020		OCT 20			;2, HALF
BOCTC	003360'	000000	000013		OCT 13			;3, THIRD OR V.T.
BC				;END OF FORMAT ROUTINES
BSUBTTLC				SUBTTL	END OF LINE
BC
BENDLN.TLZNITFBF.C	003361'	627440	000004	ENDLN.:	TLZN	I,TFBF.		;T FORMAT THIS LINE
BJRSTNOTTLC	003362'	254000	003377'		JRST	NOTTL		;NO
BMOVSMC	003363'	204007	000001		MOVS	0,1(M)		;GET CURRENT POINTER
BTRCC	003364'	640000	777777		TRC	0,-1		;BYTE POINTERS COUNT BACKWARDS
BPUSHPC	003365'	261740	000000		PUSH	P,0		;SOMEWHERE TO SAVE IT
BMOVSTPNTR.LOWC	003366'	204000	001504'		MOVS	0,TPNTR.(LOW)	;BACKUP POINTER
BTRCC	003367'	640000	777777		TRC	0,-1		;CONVERT IT ALSO
BCAMGPC	003370'	317017	000000		CAMG	0,(P)		;HAS THERE BEEN A BACKUP?
BJRSTENDLN1C	003371'	254000	003376'		JRST	ENDLN1		;NO, BUT POP OFF STORE POINTER
BMOVETPNTR.LOWC	003372'	200000	001504'		MOVE	0,TPNTR.(LOW)	;RESTORE SAVED POINTER AND ITEM COUNT
BMOVEMMC	003373'	202007	000001		MOVEM	0,1(M)
BMOVETCNT2.LOWC	003374'	200000	001506'		MOVE	0,TCNT2.(LOW)
BMOVEMMC	003375'	202007	000002		MOVEM	0,2(M)
BENDLN1POPPDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-29
FORSE.MAC	26-JUL-84 01:16		END OF LINE

BC	003376'	262740	000000	ENDLN1:	POP	P,0		;GET RID OF MODIFIED POINTER
BNOTTLJUMPGEIBUFSTC	003377'	325440	003427'	NOTTL:	JUMPGE	I,BUFST		;JUMP IF INPUT
BTLNENENCFL.C	003400'	603700	000040		TLNE	N,ENCFL.	;++ ENCODE?
BJRSTENCLNDC	003401'	254000	003342'		JRST	ENCLND		;++ SET LIN END FLG - ENCODE!
BMOVEIC	003402'	201000	000040		MOVEI	0," "		; *350* LOAD UP BLANK
BJUMPLELC	003403'	323600	003405'		JUMPLE	L,.+2		;YES,IS IT END OF FMT?
BCAINBSLC	003404'	306100	000017		CAIN	B,SL		;THIS CHAR. A /?
BSKIPLEOL.LOWC	003405'	331000	001334'		SKIPL	EOL.(LOW)	; *231* YES, CHARACTER COUNT = 0?
BJRSTCRTN1C	003406'	254000	003410'		JRST	CRTN1		;NO,DELIMIT WITH CR
BPUSHJPDEPOT.C	003407'	260740	003121'		PUSHJ	P,DEPOT.	;DEPOSIT A BLANK
BCRTN1SKIPLRANAC.LOWC	003410'	331000	001760'	CRTN1:	SKIPL	RANAC.(LOW)	; *230* RANDOM ACCESS?
BJRSTCRTNC	003411'	254000	003423'		JRST	CRTN		; *230* NO
BPUSHPAC	003412'	261740	000001		PUSH	P,A		; *230* BETTER SAVE IT
BMOVEADVNUM.LOWC	003413'	200040	000113'		MOVE	A,DVNUM.(LOW)	; *230* GET DEVICE
BIFNREENTC				IFN REENT,<ADDI	A,(LOW)>	; *230*
BMOVEAFILE2.AC	003414'	200041	000653'		MOVE	A,FILE2.(A)	; *350* CHARS. PER RECORD
BSUBAEOL.LOWC	003415'	274040	001334'		SUB	A,EOL.(LOW)	; *350* MINUS WHAT WE HAVE
BSUBIAC	003416'	275040	000002		SUBI	A,2		;LEAVE ROOM FOR CR & LF
BJRSTC	003417'	254000	003421'		JRST	.+2		; *350* NOT FIRST TIME
BPUSHJPDEPOT.C	003420'	260740	003121'		PUSHJ	P,DEPOT.	; *230* OUTPUT THAT MANY SPACES
BSOJGAC	003421'	367040	003420'		SOJG	A,.-1		; *230* TO FILL RECORD
BPOPPAC	003422'	262740	000001		POP	P,A		; *230* RESTORE
BCRTNMOVEICRC	003423'	201000	000015	CRTN:	MOVEI	0,CR		;CARRIAGE RETURN
BPUSHJPDEPOT.C	003424'	260740	003121'		PUSHJ	P,DEPOT.	;DEPOSIT C.R.
BSETOMEOL.LOWC	003425'	476000	001334'		SETOM	EOL.(LOW)	;SET END OF LINE FLAG
BPOPJPC	003426'	263740	000000		POPJ	P,
BBUFSTTLNENENCFL.C	003427'	603700	000040	BUFST:	TLNE	N,ENCFL.	;++DECODE?
BJRSTLINENDC	003430'	254000	003442'		JRST	LINEND		;++ YES TERMINATE LINE
BCAINBSLC	003431'	306100	000017		CAIN	B,SL		;LAST CHAR. A /?
BSKIPLEMC	003432'	333007	000002		SKIPLE	2(M)		;YES,BUFFER EMPTY?
BJRSTPPNC	003433'	254000	003436'		JRST	PPN		;NO,ADVANCE TO NEXT RECORD
BSKIPEOVFLS.LOWC	003434'	332000	000111'		SKIPE	OVFLS.(LOW)	;CCO 30-14CHECK LINE OVERFLOW
BJRSTPPNC	003435'	254000	003437'		JRST	PPN+1		;CCO 30-14
BPPNPUSHJPNXTCRC	003436'	260740	003675'	PPN:	PUSHJ	P,NXTCR		;ADVANCE TO NEXT LINE
BSETZMOVFLS.LOWC	003437'	402000	000111'		SETZM	OVFLS.(LOW)	;CLEAR LINE OVERFLOW
BSETOMEOL.LOWC	003440'	476000	001334'		SETOM	EOL.(LOW)	;SET END OF LINE FLAG
BPOPJPC	003441'	263740	000000		POPJ	P,		;RETURN
BC
BC				;++ FINISH UP ENCODE DECODE LINE END
BC
BLINENDSETOMEOL.LOWC	003442'	476000	001334'	LINEND:	SETOM	EOL.(LOW)	;++ END OF LINE FLG
BLINEN1LDBPOINTMC	003443'	135000	007125'	LINEN1:	LDB	0,[POINT 6,1(M),5]	;++ GET PTR
BCAINLSTBYTC	003444'	306000	000001		CAIN	0,LSTBYT		;++ IS THIS THE LAST BYTE?
BPOPJPC	003445'	263740	000000		POPJ	P,		;++ YES, RETURN
BXCTIIB.C	003446'	256000	003637'		XCT	IIB.		;++ BUMP POINTER
BJRSTLINEN1C	003447'	254000	003443'		JRST	LINEN1		;++ TEST THIS BYTE
BSUBTTLC				SUBTTL	FIN. UUO TERMINATE FORTRAN I-O STATEMENT
BC
BFINJUMPLNFIN1C	003450'	321700	003453'	FIN:	JUMPL	N,FIN1		;ALREADY RESTORED
BIFNREENTC				IFN REENT,<MOVSI 0,SAVFAC+E(LOW)	;RESTORE OP SYS AC'S
BC					HRRI	0,E		;BUT ONLY THE USEFUL ONES>
BIFEREENTMOVSESAVFACEC	003451'	204000	007053'	IFE REENT,<MOVS	0,[E,,SAVFAC+E]>
BBLTC	003452'	251000	000015		BLT	0,15		;ALL BUT 16 AND 17
BFIN1TLNEIOPF.DFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-30
FORSE.MAC	26-JUL-84 01:16		FIN. UUO TERMINATE FORTRAN I-O STATEMENT

BC	003453'	603440	004000	FIN1:	TLNE	I,OPF.		;DON'T OUTPUT IF OPEN STATEMENT
BJRSTFIB.C	003454'	254000	003464'		JRST	FIB.
BHRRZIC	003455'	550000	000011		HRRZ	0,I		;PICK UP MODE
BCAINC	003456'	306000	000014		CAIN	0,14		;BINARY MODE?
BJRSTFIB.C	003457'	254000	003464'		JRST	FIB.		;YES
BAOSEEOL.LOWC	003460'	352000	001334'		AOSE	EOL.(LOW)	;END OF LINE SEEN?
BPUSHJPENDLN.C	003461'	260740	003361'		PUSHJ	P,ENDLN.	;NO,TERMINATE LINE
BTLNENENCFL.C	003462'	603700	000040		TLNE	N,ENCFL.	;++ENCODE/DECODE?
BJRSTENCENDC	003463'	254000	003664'		JRST	ENCEND		;++FINISH UP ARRAY IF ENCODE
BFIB.SETZMEND.LOWC	003464'	402000	000120'	FIB.:	SETZM	END.(LOW)	;CLEAR END OF FILE FLAG
BFIENDSETZMERR.LOWC	003465'	402000	000121'	FIEND:	SETZM	ERR.(LOW)	;CLEAR INPUT ERROR FLAG
BSKIPLRANAC.LOWC	003466'	331000	001760'		SKIPL	RANAC.(LOW)	;RANDOM ACCESS?
BJRSTFI.C	003467'	254000	003506'		JRST	FI.		;NO
BMOVEDFILNUMLOWC	003470'	200200	000131'		MOVE	D,FILNUM(LOW)	;GET F4 DEVICE NO.
BIFNREENTC				IFN REENT,<ADDI	D,(LOW)>
BMOVECFILE1.DC	003471'	200144	000613'		MOVE	C,FILE1.(D)	;GET ADR OF ASSOC VARIABLE
BMOVEASVAR.LOWC	003472'	200000	001764'		MOVE	0,ASVAR.(LOW)	;GET INTERNAL ASSOC VAR VALUE
BSKIPNBFILE2.DC	003473'	336104	000653'		SKIPN	B,FILE2.(D)	;IS IT FIXED LENGTH RECORD
BJRSTFI2C	003474'	254000	003500'		JRST	FI2		;NO
BIDIVBC	003475'	230000	000002		IDIV	0,B		;GET RECORD NUMBER
BJUMPEAFI2C	003476'	322040	003500'		JUMPE	A,FI2		;ANY REMAINDER
BAOJC	003477'	340000	000000		AOJ	0,		;YES. ROUND UP
BFI2CAMLEFILSZ.DC	003500'	313004	000513'	FI2:	CAMLE	0,FILSZ.(D)	;HAS FILE SIZE BEEN INCREASED
BMOVEMFILSZ.DC	003501'	202004	000513'		MOVEM	0,FILSZ.(D)	;YES. SET TO NEW SIZE
BAOJC	003502'	340000	000000		AOJ	0,		;CONVERT TO ONE-INDEXED
BMOVEMCC	003503'	202003	000000		MOVEM	0,(C)		;PUT VALUE IN REAL ASSOC VAR
BSKIPGEEND.LOWC	003504'	335000	000120'		SKIPGE	END.(LOW)	;WAS END OF FILE DETECTED?
BPUSHJPCLOSI.C	003505'	260740	006221'		PUSHJ	P,CLOSI.	;SET UP FOR ANOTHER INPUT IF EOF.
BFI.SETZMRANAC.LOWC	003506'	402000	001760'	FI.:	SETZM	RANAC.(LOW)	;CLEAR RANDOM ACCESS FLG
BMOVEFOBPDPLOWC	003507'	200000	000003'		MOVE	0,FOBPDP(LOW)	;INITIALIZE PUSHDOWN POINTER
BMOVEMSAVFACPLOWC	003510'	202000	000070'		MOVEM	0,SAVFAC+P(LOW)	;RESTORE PUSHDOWN PTR
BTLZNFINFL.C	003511'	621700	777777		TLZ	N,FINFL.	;CLEAR FLAGS
BSETZMINIFLGLOWC	003512'	402000	000072'		SETZM	INIFLG(LOW)	;CLEAR FLAGS FOR NXT I/O
BIFEREENTMOVEXWDINIFLGINIFLGC	003513'	200000	007126'	IFE REENT,<MOVE	0,[XWD INIFLG,INIFLG+1]>
BIFNREENTC				IFN REENT,<HRLI 0,INIFLG(LOW)
BC					HRRI	0,INIFLG+1(LOW)>
BBLTINPDEVLOWC	003514'	251000	000110'		BLT	0,INPDEV(LOW)	;...
BMOVSISAVEACLOWC	003515'	205740	000031'		MOVSI	17,SAVEAC(LOW)	;SET UP BLT TO RESTORE USERS ACS
BBLTC	003516'	251740	000015		BLT	17,15
BIFEREENTEXCHNSAVEACNC	003517'	250700	000047'	IFE REENT,<EXCH	N,SAVEAC+N	;RESTORE USER AC16>
BMOVESAVEACLOWC	003520'	200740	000050'		MOVE	17,SAVEAC+17(LOW)
BMOVESAVEACLOWC	003521'	200000	000031'		MOVE	0,SAVEAC+0(LOW)	;RESTORE AC0
BSKIPNTRAPF.LOWC	003522'	336000	000124'		SKIPN	TRAPF.(LOW)	;ARE TRAPS SET
BJRSTERRTSTC	003523'	254000	003534'		JRST	ERRTST		;NO. CHECK FOR ERROR EXIT
BHRRZSTRAPF.LOWC	003524'	553000	000124'		HRRZS	TRAPF.(LOW)	;MAKE POSITIVE
BMOVEANRMESCLOWC	003525'	200040	000126'		MOVE	A,NRMESC(LOW)	;NORMAL ESCAPE PROCESSOR
BMOVEMAINTAB.ESCCHNC	003526'	202040	000003*		MOVEM	A,INTAB.+<ESCCHN-1>*2+1
BMOVEANRMTRULOWC	003527'	200040	000127'		MOVE	A,NRMTRU(LOW)	;NORMAL TRU PROCESSOR
BMOVEMAINTAB.TRUCHNC	003530'	202040	000001*		MOVEM	A,INTAB.+<TRUCHN-1>*2+1
BPUSHJPENAB.C	003531'	260740	003566'		PUSHJ	P,ENAB.	;ENABLE TRAPS
BSKIPETRPLOCLOWC	003532'	332000	000125'		SKIPE	TRPLOC(LOW)	;HAS A TRAP OCCURRED
BJRSTTRPLOCLOWC	003533'	254020	000125'		JRST	@TRPLOC(LOW)	;YES. GO TO IT
BERRTSTSKIPNAERR.LOWC	003534'	336040	000121'	ERRTST:	SKIPN	A,ERR.(LOW)	;USER PROGRAM CONTROL IF INPUT ERROR
BJRSTENDTSTDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-31
FORSE.MAC	26-JUL-84 01:16		FIN. UUO TERMINATE FORTRAN I-O STATEMENT

BC	003535'	254000	003542'		JRST	ENDTST		;NO ERROR OR CONTROL NOT DESIRED
BSETZMERR.LOWC	003536'	402000	000121'		SETZM	ERR.(LOW)	;CLEAR ERROR FLAG
BSETZMEND.LOWC	003537'	402000	000120'		SETZM	END.(LOW)	;CLEAR POSSIBLE END FLAG
BHLLAUUOH.LOWC	003540'	500040	002076'		HLL	A,UUOH.(LOW)	;GET FLAGS TO RESTORE
BIFNREENTC				IFN REENT,<XCT	UUOL.(LOW)	;RESET OFFSET>
BJRSTFAC	003541'	254120	000001		JRSTF	@A		;GO TO POSITION SPECIFIED
BENDTSTSKIPNAEND.LOWC	003542'	336040	000120'	ENDTST:	SKIPN	A,END.(LOW)	;USER PROGRAM CONTROL IF END-OF-FILE
BIFEREENTJRSTFUUOH.C	003543'	254120	002076'	IFE REENT,<JRSTF @UUOH.		;NO END OF FILE OR CONTROL NOT DESIRED>
BIFNREENTC				IFN REENT,<JRST UUOL.(LOW)>
BSETZMEND.LOWC	003544'	402000	000120'		SETZM	END.(LOW)	;CLEAR EOF FLAG
BHLLAUUOH.LOWC	003545'	500040	002076'		HLL	A,UUOH.(LOW)	;GET FLAGS TO RESTORE
BIFNREENTC				IFN REENT,<XCT	UUOL.(LOW)>
BJRSTFAC	003546'	254120	000001		JRSTF	@A		;GO TO POSITION SPECIFIED
BC
BC				;FORSE ESCAPE AND TRU PROCESSORS
BC
BFORESCCLRBFOC	003547'	051500	000000	FORESC:	CLRBFO			;CLEAR TTY OUTPUT BUFFER
BCLRBFIC	003550'	051440	000000		CLRBFI			;CLEAR TTY INPUT BUFFER
BPUSHPAC	003551'	261740	000001		PUSH	P,A
BMOVEANRMESCLOWC	003552'	200040	000126'		MOVE	A,NRMESC(LOW)	;NORMAL ESCAPE PROCESSOR
BMOVEMATRPLOCLOWC	003553'	202040	000125'		MOVEM	A,TRPLOC(LOW)	;SAVE FOR EXIT
BPOPPAC	003554'	262740	000001		POP	P,A
BJRSTESCCLRC	003555'	254020	000123'		JRST	@ESCCLR
BC
BFORTRUPUSHPAC	003556'	261740	000001	FORTRU:	PUSH	P,A		;YES
BMOVEANRMTRULOWC	003557'	200040	000127'		MOVE	A,NRMTRU(LOW)	;NORMAL TRU PROCESSOR
BMOVEMATRPLOCLOWC	003560'	202040	000125'		MOVEM	A,TRPLOC(LOW)	;SAVE FOR EXIT
BPOPPAC	003561'	262740	000001		POP	P,A
BJRSTESCCLRC	003562'	254020	000123'		JRST	@ESCCLR
BC
BDISAB.PUSHPAC	003563'	261740	000001	DISAB.: PUSH	P,A
BMOVEIAC	003564'	201040	000000	        MOVEI   A,0
BJRSTDISENBC	003565'	254000	003570'		JRST	DISENB
BENAB.PUSHPAC	003566'	261740	000001	ENAB.:	PUSH	P,A
BMOVEAC	003567'	200040	007127'		MOVE	A,[1B0]
BDISENBSKIPNDSESC.LOWC	003570'	336000	000122'	DISENB: SKIPN   DSESC.(LOW)     ;ARE ESCAPES DISABLED BY PROGRAM
BIORAESCCHNC	003571'	434040	007130'	        IOR     A,[1B<ESCCHN>]  ;NO.
BIORATRUCHNC	003572'	434040	007131'	        IOR     A,[1B<TRUCHN>]
BINTENBAC	003573'	047040	777744		INTENB	A,
BHALTC	003574'	254200	000000		HALT
BPOPPAC	003575'	262740	000001		POP	P,A
BPOPJPC	003576'	263740	000000		POPJ	P,
BSUBTTLC				SUBTTL	CHINN.
BC				;CHINN. IS CALLED BY ALL INPUT ROUTINES TO GET A CHARACTER.
BC				;THE CHARACTER IS RETURNED IN AC 0. AC M IS USED.
BC
BCHINNNXCTIIB.C	003577'	256000	003637'	CHINNN:	XCT	IIB.		;IGNORE CHAR.
BSOSMC	003600'	370007	000002		SOS	2(M)		;FIX COUNT
BC								;PROCESS NEXT CHARACTER
BCHINN.SKIPEOVFLS.LOWC	003601'	332000	000111'	CHINN.:	SKIPE	OVFLS.(LOW)	;SWITCH ON IF ALL CHARS. USED
BJRSTRETCRC	003602'	254000	003743'		JRST	RETCR		;IN WHICH CASE, RETURN A C.R.
BSKIPGMC	003603'	337007	000002		SKIPG	2(M)		;IS BUFFER EMPTY?
BPUSHJPDOINPC	003604'	260740	003623'		PUSHJ	P,DOINP		;YES,DO INPUT
BIOKLDBMDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-32
FORSE.MAC	26-JUL-84 01:16		CHINN.

BC	003605'	135007	000001	IOK:	LDB	0,1(M)		;PICK UP A CHARACTER
BJUMPECHINNNC	003606'	322000	003577'		JUMPE	0,CHINNN	;IGNORE NULLS
BAOSEOL.LOWC	003607'	350000	001334'		AOS	EOL.(LOW)	;INCREMENT COLUMN COUNT
BCAIGCRC	003610'	307000	000015		CAIG	0,CR		;IS IT AN END OF LINE CHAR.?
BCAIGELFC	003611'	305000	000012		CAIGE	0,LF		;TEST FOR LF,VT,FF OR CR
BJRSTC	003612'	254000	003614'		JRST	.+2		;NO
BJRSTNXTLN.C	003613'	254000	003712'		JRST	NXTLN.		;YES,SKIP TO NEXT LINE
BCAIEC	003614'	302000	000032		CAIE	0,"Z"-100	;^Z ON TTY IS EOF MARK
BJRSTC	003615'	254000	003620'		JRST	.+3		;NOT ^Z
BTLNENTTYFL.C	003616'	603700	000001		TLNE	N,TTYFL.	;BUT IS IT ON TTY
BJRSTEOFTS.C	003617'	254000	003760'		JRST	EOFTS.
BSOSMC	003620'	370007	000002		SOS	2(M)		;DROP CHARACTER COUNT
BAOSASVAR.LOWC	003621'	350000	001764'		AOS	ASVAR.(LOW)	;INCREMENT CHAR COUNT IN FILE
BPOPJPC	003622'	263740	000000		POPJ	P,		;RETURN
BC
BDOINPTLNENENCFL.C	003623'	603700	000040	DOINP:	TLNE	N,ENCFL.	;++ DECODE?
BJRSTDECERRC	003624'	254000	003656'		JRST	DECERR		;++ YES DON'T DO INPUT
BSKIPETRAPF.LOWC	003625'	332000	000124'		SKIPE	TRAPF.(LOW)	;ARE TRAPS SET
BTLNNNTERMF.C	003626'	607700	010000		TLNN	N,TERMF.	;AND IS INPUT FROM TERMENAL
BJRSTDOINP1C	003627'	254000	003636'		JRST	DOINP1		;NO
BMOVEIESCFINC	003630'	201000	003777'		MOVEI	0,ESCFIN		;WHERE TO GO IF TRAP DURING I/O
BMOVEMESCCLRLOWC	003631'	202000	000123'		MOVEM	0,ESCCLR(LOW)	;SAVE IF TRAP
BPUSHJPENAB.C	003632'	260740	003566'		PUSHJ	P,ENAB.	;ENABLE ESCAPES
BPUSHJPINP.C	003633'	260740	006247'		PUSHJ	P,INP.		;DO INPUT
BPUSHJPDISAB.C	003634'	260740	003563'		PUSHJ	P,DISAB.	;DISABLE TRAPS
BJRSTIIB.C	003635'	254000	003637'		JRST	IIB.
BDOINP1PUSHJPINP.C	003636'	260740	006247'	DOINP1:	PUSHJ	P,INP.		;GET NEXT BUFFERFUL
BIIB.IBPMC	003637'	133007	000001	IIB.:	IBP	1(M)		;ADVANCE POINTER
BSKIPGRCNT2LOWC	003640'	337000	001512'		SKIPG	RCNT2(LOW)	;HAS CURRENTLINE POINTERS BEEN SAVED
BPUSHJPSAVPTRC	003641'	260740	005273'		PUSHJ	P,SAVPTR	;NO. SAVE THEM
BPUSHPFC	003642'	261740	000006		PUSH	P,F		;SAVE F - USED IN I/O ROUTINES
BPUSHJPSTAT.C	003643'	260740	006215'		PUSHJ	P,STAT.		;GET ERRORS NOT ASSOCIATED WITH A BUFFER
BTRNEFIODENDC	003644'	602300	020000		TRNE	F,IODEND
BJRSTEOFTS.C	003645'	254000	003760'		JRST	EOFTS.		;END OF FILE
BTRNEFIOTENDIOWERRC	003646'	602300	402000		TRNE	F,IOTEND!IOWERR
BERRORIOERR.C	003647'	260740	003745'		ERROR	IOERR.		;EOT OR IMPROPER MODE
BHRRZFMC	003650'	550307	000000		HRRZ	F,(M)		;PICK UP 1ST WORD BUFFER
BMOVEFFC	003651'	200306	777777		MOVE	F,-1(F)		;TO GET STATUS
BTRNEFIODERRIOPERRIOBKTLC	003652'	602300	340000		TRNE	F,IODERR!IOPERR!IOBKTL
BERRORIOERR.C	003653'	260740	003745'		ERROR	IOERR.
BPOPFPOPPFC	003654'	262740	000006	POPF:	POP	P,F		;RESTORE F
BPOPJPC	003655'	263740	000000		POPJ	P,		;RETURN WITH CHARACTER
BC
BDECERRMOVEICRC	003656'	201000	000015	DECERR:	MOVEI	0,CR		;++TELLS CONVERSION ROUTINE END OF LINE
BSKIPEEDERRLOWC	003657'	332000	000105'		SKIPE	EDERR(LOW)	;++ HAVE WE BEEN HERE BEFORE?
BSETOMEDERRLOWC	003660'	476000	000105'		SETOM	EDERR(LOW)	;++YES, SET 2ND TIME ERROR FLAG
BHLLOSEDERRLOWC	003661'	523000	000105'		HLLOS	EDERR(LOW)	;++ NO SET 1ST TIME FLG(NON 0 R.H.)
BPOPPPC	003662'	262757	000000		POP	P,(P)		;++GO RIGHT BACK TO CONVERSION RTN
BPOPJPC	003663'	263740	000000		POPJ	P,		;++RETURN
BC
BC
BENCENDSKIPGEIC	003664'	335000	000011	ENCEND:	SKIPGE	I		;++ENCODE?
BSKIPNAMC	003665'	336047	000002		SKIPN	A,2(M)		;++BUFFER EMPTY?
BJRSTENCEN1DFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-33
FORSE.MAC	26-JUL-84 01:16		CHINN.

BC	003666'	254000	003673'		JRST	ENCEN1		;++DECODE OR BUFFER EMPTY.
BSETZMOVFLS.LOWC	003667'	402000	000111'		SETZM	OVFLS.(LOW)	;++CLEAR OVERFLOW FLG
BMOVEIC	003670'	201000	000040		MOVEI	0," "		;++BLANK
BPUSHJPENCOUTC	003671'	260740	003336'		PUSHJ	P,ENCOUT	;++FILL UP ARRAY.
BSOJGAC	003672'	367040	003671'		SOJG	A,.-1		;++
BENCEN1SETZMOVFLS.LOWC	003673'	402000	000111'	ENCEN1:	SETZM	OVFLS.(LOW)	; *267* CLEAR OVERFLOW FLAG
BJRSTFIB.C	003674'	254000	003464'		JRST	FIB.		;++RETURN WHEN THROUGH.
BC
BC				;SEARCH TO END OF CURRENT LINE
BC
BNXTCRSKIPEOVFLS.LOWC	003675'	332000	000111'	NXTCR:	SKIPE	OVFLS.(LOW)	;END OF LINE ALREADY SEEN?
BPOPJPC	003676'	263740	000000		POPJ	P,		;YES
BSKIPGMC	003677'	337007	000002		SKIPG	2(M)		;IS BUFFER EMPTY
BPUSHJPDOINPC	003700'	260740	003623'		PUSHJ	P,DOINP		;YES. FILL IT
BJRSTNXTCR1C	003701'	254000	003706'		JRST	NXTCR1		; *354* CHECK THIS CHARACTER
BC
BNXTCR.XCTIIB.C	003702'	256000	003637'	NXTCR.:	XCT	IIB.
BAOSASVAR.LOWC	003703'	350000	001764'		AOS	ASVAR.(LOW)
BSOSGMC	003704'	377007	000002		SOSG	2(M)		;DROP ITEM COUNT
BPUSHJPDOINPC	003705'	260740	003623'		PUSHJ	P,DOINP		;DO INPUT
BNXTCR1LDBMC	003706'	135007	000001	NXTCR1:	LDB	0,1(M)		;GET NEXT CHARACTER
BCAIGCRC	003707'	307000	000015		CAIG	0,CR		;VERTICAL PAPER MOTION?
BCAIGELFC	003710'	305000	000012		CAIGE	0,LF
BJRSTNXTCR.C	003711'	254000	003702'		JRST	NXTCR.		;NO,KEEP LOOKING
BC				;	JRST	NXTLN.		;YES...GO TO NEXT LINE
BC
BSUBTTLC				SUBTTL	ADVANCE TO NEXT LINE IN BUFFER (IF THERE IS ONE)
BC
BNXTLN.SETOMOVFLS.LOWC	003712'	476000	000111'	NXTLN.:	SETOM	OVFLS.(LOW)	;SET END-OF-LINE SWITCH
BAOSASVAR.LOWC	003713'	350000	001764'		AOS	ASVAR.(LOW)	;YUP, INCREMENT VALUE OF ASSOC VAR
BXCTIIB.C	003714'	256000	003637'		XCT	IIB.		;IGNORE CR
BSOSGMC	003715'	377007	000002		SOSG	2(M)		;DROP ITEM COUNT
BPUSHJPDOINPC	003716'	260740	003623'		PUSHJ	P,DOINP		;FILL BUFFER IF NEEDED
BAOSASVAR.LOWC	003717'	350000	001764'		AOS	ASVAR.(LOW)	;INCREMENT ASSOC VAR
BXCTIIB.C	003720'	256000	003637'		XCT	IIB.		;IGNORE LF
BNXTLN1SOSGMC	003721'	377007	000002	NXTLN1:	SOSG	2(M)		;DROP ITEM COUNT
BJRSTNXTLN2C	003722'	254000	003732'		JRST	NXTLN2
BLDBMC	003723'	135007	000001		LDB	0,1(M)
BCAIGFFC	003724'	307000	000014		CAIG	0,FF		;IGNORE LEADING FORM FEEDS
BCAIGEVTC	003725'	305000	000013		CAIGE	0,VT		;AND VERTICAL TABS
BJUMPNNXTLN2C	003726'	326000	003732'		JUMPN	0,NXTLN2
BAOSASVAR.LOWC	003727'	350000	001764'		AOS	ASVAR.(LOW)
BXCTIIB.C	003730'	256000	003637'		XCT	IIB.
BJRSTNXTLN1C	003731'	254000	003721'		JRST	NXTLN1
BNXTLN2TLNENRRDFL.C	003732'	603700	000010	NXTLN2:	TLNE	N,RRDFL.	;HAS THERE BEEN A REREAD?
BJRSTRETCRC	003733'	254000	003743'		JRST	RETCR		;YES,LEAVE POINTERS AS THEY ARE
BMOVERPTR2LOWC	003734'	200000	001510'		MOVE	0,RPTR2(LOW)	;MAKE OLD CURRENT PREV LINE
BMOVEMRPTR1LOWC	003735'	202000	001507'		MOVEM	0,RPTR1(LOW)
BMOVERCNT2LOWC	003736'	200000	001512'		MOVE	0,RCNT2(LOW)	;SAME FOR ITEM COUNT
BMOVEMRCNT1LOWC	003737'	202000	001511'		MOVEM	0,RCNT1(LOW)
BMOVERINC2LOWC	003740'	200000	001514'		MOVE	0,RINC2(LOW)	;SAME FOR BLOCK NUMBER
BMOVEMRINC1LOWC	003741'	202000	001513'		MOVEM	0,RINC1(LOW)
BPUSHJPSAVPTRC	003742'	260740	005273'		PUSHJ	P,SAVPTR	;SAVE NEW CURRENT LINE
BRETCRMOVEICRDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-34
FORSE.MAC	26-JUL-84 01:16		ADVANCE TO NEXT LINE IN BUFFER (IF THERE IS ONE)

BC	003743'	201000	000015	RETCR:	MOVEI	0,CR		;RETURN A C.R.
BPOPJPC	003744'	263740	000000		POPJ	P,		;RETURN
BC
BC				;I/O ERROR ROUTINE
BC
BIOERR.TRNEFIODERRC	003745'	602300	200000	IOERR.:	TRNE	F,IODERR
BJRSTREDER.C	003746'	254000	000000*		JRST	REDER.		;DATA ERROR
BTRNEFIOPERRC	003747'	602300	100000		TRNE	F,IOPERR
BJRSTPARER.C	003750'	254000	000000*		JRST	PARER.		;PARITY ERROR
BTRNEFIOWERRC	003751'	602300	400000		TRNE	F,IOWERR
BJRSTWLKER.C	003752'	254000	000000*		JRST	WLKER.		;WRITE PROTECTION ERROR
BTRNEFIOBKTLC	003753'	602300	040000		TRNE	F,IOBKTL	;ILL BLK. NUMBER OR QUOTA EXCEEDED
BJRSTBTLER.C	003754'	254000	000000*		JRST	BTLER.		;BLOCK TOO LARGE ERROR
BTRNEFIOTENDC	003755'	602300	002000		TRNE	F,IOTEND
BJRSTENDTP.C	003756'	254000	000000*		JRST	ENDTP.		;END OF TAPE
BPOPJPC	003757'	263740	000000		POPJ	P,		;JUST INCASE ERROR TYPE NOT FOUND
BC
BSUBTTLC				SUBTTL	END OF FILE TESTING
BC
BEOFTS.TLNNIDDF.C	003760'	607440	000040	EOFTS.:	TLNN	I,DDF.		;DON'T CLOSE FOR DSK/DTA
BPUSHJPCLOSI.C	003761'	260740	006221'		PUSHJ	P,CLOSI.	;TURN OFF THE EOF BIT
BSUBMHASVAR.LOWC	003762'	276400	001764'	        SUBM    H,ASVAR.(LOW)   ; RDO. FIX TSR #53315. SEPT '76.
BLDBAPOINTMC	003763'	135040	007077'		LDB	A,[POINT 4,M,12];GET CHAN #
BIFNREENTC				IFN REENT,<ADDI A,(LOW)>	;SET UP INDEX
BSKIPLEOFFL.AC	003764'	331001	000213'		SKIPL	EOFFL.(A)	;HAS THE EOFTST PROGRAM BEEN CALLED
BJRSTSKIPNEND.LOWC					JRST	[SKIPN	END.(LOW);NO,DOES USER WANT PROGRAM CONTROL?
BJRSTLOGEN.C						JRST	LOGEN.	;NO,PRINT ERROR MESSAGE AND FAIL
BJRSTFIENDC	003765'	254000	007132'			JRST	FIEND]	;YES,GO TO POSITION SPECIFIED
BMOVEIAC	003766'	201040	000004		MOVEI	A,4		;SET UP EOF SWITCH 
BIORMAGC	003767'	436055	000000		IORM	A,(G)		;                  IN DEVICE NAME
BEDFINSOSUUOH.LOWC	003770'	370000	002076'	EDFIN:	SOS	UUOH.(LOW)	;SET UP FOR CHECKING FOR FIN.
BMOVSIBFIN.C	003771'	205100	021000		MOVSI	B,(FIN.)	;PUT FIN.'S OP CODE IN  AC B
BMOVUUOMOVEAUUOH.LOWC	003772'	200060	002076'	MOVUUO:	MOVE	A,@UUOH.(LOW)	;GET FORTRAN UUO FROM PROGRAM
BAOSUUOH.LOWC	003773'	350000	002076'		AOS	UUOH.(LOW)	;INCREMENT PASSED THE FIN. OP CODE
BCAMEABC	003774'	312040	000002		CAME	A,B		;IS  THE UUO A FIN. 00,0
BJRSTMOVUUOC	003775'	254000	003772'		JRST	MOVUUO		;NO,GET NEXT UUO
BJRSTFIENDC	003776'	254000	003465'		JRST	FIEND		;EXECUTE FIEND AND GO TO NXT UUO AFTER FIN.
BESCFINSETZMEND.LOWC	003777'	402000	000120'	ESCFIN:	SETZM	END.(LOW)	;CLEAR END FLAG
BJRSTEDFINC	004000'	254000	003770'		JRST	EDFIN
BC
BC
BSUBTTLC				SUBTTL	IN. OR OUT. UUOS
BC
BC				;*** PATCH TO CHECK FOR CONSISTENT USE OF I/O CHANNELS *** [TJB 3-4-82]
BSETTYPAOSPC	004001'	350017	000000	SETTYP:	AOS	(P)		;SET TYPFL. FOR A UNIT (ALWAYS SKIP RETURNS)
BTLNENRELFL.C	004002'	603700	002000		TLNE	N,RELFL.	;IF WE ARE CLOSING THE FILE,   [TJB v. 73]
BPOPJPC	004003'	263740	000000		 POPJ	P,		;DON'T BOTHER SETTING ANYTHING [TJB v. 73]
BMOVECC	004004'	200140	000000		MOVE	C,0
BSETOC	004005'	474000	000000		SETO	0,		;ASSUME SEQUENTIAL
BSKIPERANAC.LOWC	004006'	332000	001760'		SKIPE	RANAC.(LOW)	;WAS RANDOM ACCESS REQUESTED?
BMOVNSC	004007'	213000	000000		 MOVNS	0		;YES: TYPFL. WILL BE 1
BHRRMTYPFL.CCU	004010'	542003	000000*		HRRM	0,TYPFL.(C)
BMOVECDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-35
FORSE.MAC	26-JUL-84 01:16		IN. OR OUT. UUOS

BC	004011'	200000	000003		MOVE	0,C		;RESTORE AC0
BPOPJPC	004012'	263740	000000		POPJ	P,
BC
BSETRWAOSPC	004013'	350017	000000	SETRW:	AOS	(P)		;SET RWFL. FOR A UNIT (ALWAYS SKIP RETURNS)
BTLNENRELFL.C	004014'	603700	002000		TLNE	N,RELFL.	;IF WE ARE CLOSING THE FILE,   [TJB v. 73]
BPOPJPC	004015'	263740	000000		 POPJ	P,		;DON'T BOTHER SETTING ANYTHING [TJB v. 73]
BTLNEIOPF.C	004016'	603440	004000		TLNE	I,OPF.
BSKIPNRANAC.LOWC	004017'	336000	001760'		SKIPN	RANAC.(LOW)	;IFF IN OPEN STMT FOR RANDOM FILE
BPOPJPC	004020'	263740	000000		 POPJ	P,
BMOVECC	004021'	200140	000000		MOVE	C,0		;SET UP THE CHANNEL INDEX
BMOVERANAC.LOWC	004022'	200000	001760'		MOVE	0,RANAC.(LOW)	;SET BY OPENF TO THE TYPE TO BE OPENED
BSETOMRANAC.LOWC	004023'	476000	001760'		SETOM	RANAC.(LOW)	;MAKE SURE EVERYONE ELSE LIKES IT
BSETOC	004024'	474040	000000		SETO	1,		;ASSUME WANTS TO DO RANDIN
BCAINC	004025'	306000	000003		CAIN	0,3		;IS IT RANDOUT?
BMOVNSC	004026'	213000	000001		 MOVNS	1		;YES: MARK FOR OUTPUT
BCAIEC	004027'	302000	000004		CAIE	0,4		;IS IT RANDIO?
BHRLMTYPFL.CCU	004030'	506043	004010*		 HRLM	1,TYPFL.(C)	;NO: WE CARE ABOUT THE RESULT
BMOVECC	004031'	200000	000003		MOVE	0,C		;RESTORE AC0	
BPOPJPC	004032'	263740	000000		POPJ	P,
BC
BTYPERRMOVEMTYPCHNC	004033'	202000	004063'	TYPERR:	MOVEM	0,TYPCHN	;WARN OF INCONSISTENT USE AND CONTINUE
BMOVEMTYPCHNC	004034'	202040	004064'		MOVEM	1,TYPCHN+1
BMOVEITYPMS1C	004035'	201000	004065'		MOVEI	0,TYPMS1	;ASSUME WAS A SEQUENTIAL CHANNEL
BSKIPNRANAC.LOWC	004036'	336000	001760'		SKIPN	RANAC.(LOW)	;WAS RANDOM ACCESS REQUESTED?
BMOVEITYPMS2C	004037'	201000	004100'		 MOVEI	0,TYPMS2	;YES: THEN SEQUENTIAL WAS ATTEMPTED
BTYPMSGOUTSTRC	004040'	051160	000000	TYPMSG:	OUTSTR	@0		;SEND IT TO THE TTY
BMOVETYPCHNC	004041'	200000	004063'		MOVE	0,TYPCHN	;TELL THEM THE UNIT NUMBER
BIDIVIC	004042'	231000	000012		IDIVI	0,^D10		;IN I2 FORMAT
BSKIPNC	004043'	336000	000000		SKIPN	0
BMOVEIC	004044'	201000	777760		 MOVEI	0," "-"0"
BADDIC	004045'	271000	000060		ADDI	0,"0"
BOUTCHRC	004046'	051040	000000		OUTCHR	0
BADDIC	004047'	271040	000060		ADDI	1,"0"
BOUTCHRC	004050'	051040	000001		OUTCHR	1
BOUTSTRASCIZC					OUTSTR	[ASCIZ/
BC	004051'	051140	007135'	/]				;AND A CARRAIGE RETURN
BMOVETYPCHNC	004052'	200000	004063'		MOVE	0,TYPCHN	;RESTORE AC0
BMOVETYPCHNC	004053'	200040	004064'		MOVE	1,TYPCHN+1	;RESTORE AC1
BPOPJPC	004054'	263740	000000		POPJ	P,
BC
BRWERRMOVEMTYPCHNC	004055'	202000	004063'	RWERR:	MOVEM	0,TYPCHN	;WARN OF INCONSISTENT USE AND CONTINUE
BMOVEMTYPCHNC	004056'	202040	004064'		MOVEM	1,TYPCHN+1
BMOVEITYPMS3C	004057'	201000	004113'		MOVEI	0,TYPMS3	;ASSUME IT WAS AN INPUT CHANNEL
BTLNEIIOF.C	004060'	603440	400000		TLNE	I,IOF.		;IS IT AN INPUT CHANNEL?
BMOVEITYPMS4C	004061'	201000	004127'		 MOVEI	0,TYPMS4	;NO
BJRSTTYPMSGC	004062'	254000	004040'		JRST	TYPMSG
BC
BTYPCHNBLOCKC	004063'			TYPCHN:	BLOCK	2		;TO SAVE 0,1 DURING THE MESSAGE
BTYPMS1ASCIZC	004065'			TYPMS1:	ASCIZ/
BC	004065'	064252	740644	WARNING! RANDOM ACCESS TO SEQUENTIAL CHANNEL: UNIT=/
	004066'	472231	643502
	004067'	202450	147210
	004070'	476324	040606
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-36
FORSE.MAC	26-JUL-84 01:16		IN. OR OUT. UUOS

	004071'	416132	351500
	004072'	522364	051612
	004073'	506530	547250
	004074'	446031	420206
	004075'	442031	647212
	004076'	461644	052634
	004077'	446507	500000
BTYPMS2ASCIZC	004100'			TYPMS2:	ASCIZ/
BC	004100'	064252	740644	WARNING! SEQUENTIAL ACCESS TO RANDOM CHANNEL: UNIT=/
	004101'	472231	643502
	004102'	202470	550652
	004103'	426352	444602
	004104'	461010	141606
	004105'	426472	320250
	004106'	475012	240634
	004107'	422371	520206
	004110'	442031	647212
	004111'	461644	052634
	004112'	446507	500000
BTYPMS3ASCIZC	004113'			TYPMS3:	ASCIZ/
BC	004113'	064252	740644	WARNING! OUTPUT ATTEMPTED ON INPUT-ONLY CHANNEL: UNIT=/
	004114'	472231	643502
	004115'	202372	552240
	004116'	526504	040650
	004117'	522131	550250
	004120'	426104	047634
	004121'	202231	650252
	004122'	521331	747230
	004123'	545010	344202
	004124'	472350	546164
	004125'	202531	644650
	004126'	364000	000000
BTYPMS4ASCIZC	004127'			TYPMS4:	ASCIZ/
BC	004127'	064252	740644	WARNING! INPUT ATTEMPTED ON OUTPUT-ONLY CHANNEL: UNIT=/
	004130'	472231	643502
	004131'	202231	650252
	004132'	521010	152250
	004133'	426332	052212
	004134'	421011	747100
	004135'	476532	450252
	004136'	521331	747230
	004137'	545010	344202
	004140'	472350	546164
	004141'	202531	644650
	004142'	364000	000000
BC				;*** END OF I/O CONSISTENCY PATCH ***
BC
BOUTPMOVSIIIOF.C	004143'	205440	400000	OUTP:	MOVSI	I,IOF.		;OUTPUT,ASCII
BJRSTSFMTFLC	004144'	254000	004147'		JRST	SFMTFL		;SET THE FORMAT FLAG
BC
BINPSETZIC	004145'	400440	000000	INP:	SETZ	I,		;INPUT,ASCII
BSETOMINPDEVLOWC	004146'	476000	000110'		SETOM	INPDEV(LOW)	;SET ASCII INPUT DEVICE FLAG
BSFMTFLTLOIFIOF.C	004147'	661440	000100	SFMTFL:	TLO	I,FIOF.		;SET FORMAT FLAG
BSKIPLRANAC.LOWDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-37
FORSE.MAC	26-JUL-84 01:16		IN. OR OUT. UUOS

BC	004150'	331000	001760'		SKIPL	RANAC.(LOW)	;RANDOM ACCESS?
BJRSTNFIC	004151'	254000	004154'		JRST	NFI		;NO
BMOVEBRECNO.LOWC	004152'	200100	001757'		MOVE	B,RECNO.(LOW)	;GET NEXT RECORD FROM FORTRAN PROGRAM
BMOVEMBASVAR.LOWC	004153'	202100	001764'		MOVEM	B,ASVAR.(LOW)	;PUT IN ASSOCIATED VARIABLE (INTERNAL)
BNFIAOSINIFLGLOWC	004154'	350000	000072'	NFI:	AOS	INIFLG(LOW)
BRELIHRREAC	004155'	570000	000001	RELI:	HRRE	0,A		;DEVICE NO.
BJUMPGEPOSDEVC	004156'	325000	004170'		JUMPGE	0,POSDEV	;DEFAULT DEVICES?
BCAMLEC	004157'	313000	007136'		CAMLE	0,[-6]		;DEFAULT DEVICE?
BJRSTDFLDEVC	004160'	254000	004166'		JRST	DFLDEV		;YES
BCAMEC	004161'	312000	007136'		CAME	0,[-6]		;REREAD?
BJRSTPDERRC	004162'	254000	004203'		JRST	PDERR		;ILLEGAL DEVICE NUMBER
BPUSHJPREREADC	004163'	260740	005472'		PUSHJ	P,REREAD	;YES, GET DEVICE
BMOVEDVNUM.LOWC	004164'	200000	000113'		MOVE	0,DVNUM.(LOW)	;NUMBER INTO 0
BJRSTPOSDEVC	004165'	254000	004170'		JRST	POSDEV		;OK NOW
BDFLDEVC	004166'			DFLDEV:
BIFN%352C				IFN %352,<MOVE	C,0		;SAVE ACTUAL DEVICE NUMBER>
BPUSHJPMAKPOSC	004166'	260740	006643'		PUSHJ	P,MAKPOS	;YES, GET THE DEVICE
BIFE%352TLONDFLFL.C	004167'	661700	000400	IFE %352,<TLO	N,DFLFL.	;SET DEFAULT DEVICE FLAG
BPOSDEVC	004170'			POSDEV:>
BIFN%352C				IFN %352,<TLOA	N,DFLFL.	;SET DEFAULT DEVICE FLAG
BC				POSDEV:	MOVE	C,0		;SAVE DEVICE NUMBER FOR POINTER>
BC
BC				;*** PATCH TO CHECK FOR CONSISTENT USE OF UNITS *** [TJB 3-4-82]
BMOVECC	004170'	200140	000000		MOVE	C,0
BHRRECTYPFL.CCU	004171'	570143	004030*		HRRE	C,TYPFL.(C)	;GET TYPE OF I/O ALREADY DONE
BXCTSKIPERANAC.LOWC					XCT	[SKIPE	RANAC.(LOW)		;TYPFL.=-1 => SEQUENTIAL
BPUSHJPSETTYPC						 PUSHJ	P,SETTYP		;TYPFL.=0  => NONE YET, SO SET
BSKIPNRANAC.LOWCC	004172'	256003	007140'			 SKIPN	RANAC.(LOW)] +1(C)	;TYPFL.=1  => RANDOM
BPUSHJPTYPERRC	004173'	260740	004033'		 PUSHJ	P,TYPERR	;ALL MISMATCHES COME HERE AND RETURN
BMOVECC	004174'	200140	000000		MOVE	C,0		;GET BACK CHANNEL NUMBER
BHLRECTYPFL.CCU	004175'	574143	004171*		HLRE	C,TYPFL.(C)	;GET I/O FLAG
BXCTTLNEIIOF.C					XCT	[TLNE	I,IOF.			;-1 => INPUT
BPUSHJPSETRWC						 PUSHJ	P,SETRW			;0  => DON'T CARE
BTLNNIIOF.CC	004176'	256003	007143'			 TLNN	I,IOF.] +1(C)		;1  => OUTPUT
BPUSHJPRWERRC	004177'	260740	004055'		 PUSHJ	P,RWERR		;MISMATCHES COME HERE AND RETURN
BMOVECC	004200'	200140	000000		MOVE	C,0
BC				;*** END CONSISTENCY PATCH ***
BC
BJUMPEPDERRC	004201'	322000	004203'		JUMPE	0,PDERR		;DEVICE 0 IS ILLEGAL
BCAILEC	004202'	303000	000077		CAILE	0,77		;CHECK RANGE OF DEVICE NO.
BPDERRERRORDEVER.C	004203'	260740	000000*	PDERR:	ERROR	DEVER.		;ILLEGAL DEVICE NO.
BMOVEMDVNUM.LOWC	004204'	202000	000113'		MOVEM	0,DVNUM.(LOW)	;SAVE F4 DEV NUM
BIFE%352MOVECDEVNO.LOWC	004205'	200140	000071'	IFE %352,<MOVE	C,DEVNO.(LOW)	;HIGHEST DEVICE NUMBER IN USE
BJUMPECNFI2C	004206'	322140	004255'		JUMPE	C,NFI2		;JUMP IF NO DEVICES IN USE
BMOVEIDDYNCH.LOWC	004207'	201200	000333'		MOVEI	D,DYNCH.(LOW)	;BEGINNING OF CHARACTERISTICS TABLE
BADDDCC	004210'	270200	000003		ADD	D,C		;ADDRESS OF LAST DEVICE IN USE
BNFI1HRRZEC	004211'	550240	000000	NFI1:	HRRZ	E,0		;RH E=DEVICE NUMBER FROM USER'S JOB
BXOREDC	004212'	430244	000000		XOR	E,(D)		;CHECK WITH DEVICE NUMBER IN TABLE
BSUBIDC	004213'	275200	000001		SUBI	D,1		;ADDR OF NEXT IN CHAR TABLE
BTRNNESPLBITDMPBITC	004214'	606240	637777		TRNN	E,-1-<SPLBIT!DMPBIT>	;CHECK DEVICE NUMBER BITS
BJRSTMATFNDC	004215'	254000	004233'		JRST	MATFND		;COMPLETE MATCH
BTRNEEASSCONDFLBITSPLBITDMPBITC	004216'	602240	037777		TRNE	E,-1-<ASSCON!DFLBIT!SPLBIT!DMPBIT>
BJRSTMATNFDC	004217'	254000	004232'		JRST	MATNFD		;NO, LOOP FOR ALL OF TABLE
BTLNENDFLFL.DFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-38
FORSE.MAC	26-JUL-84 01:16		IN. OR OUT. UUOS

BC	004220'	603700	000400		TLNE	N,DFLFL.	;IS IT A DEFAULT DEVICE?
BTRNNEASSCONC	004221'	606240	400000		TRNN	E,ASSCON	;AND TEST DEVICE LOGICALLY ASSIGNED
BJRSTC	004222'	254000	004224'		JRST	.+2		;NOT BOTH TRUE
BJRSTMATNFDC	004223'	254000	004232'		JRST	MATNFD		;BOTH TRUE SO NOT SAME DEVICE
BTRNNEDFLBITC	004224'	606240	200000		TRNN	E,DFLBIT	;IS DEVICE IN TABLE A DEFAULT?
BJRSTMATFNDC	004225'	254000	004233'		JRST	MATFND		;NO, SO DOESN'T MATTER IF NEW ONE IS ASSIGNED
BPUSHJPLDEVCHC	004226'	260740	004412'		PUSHJ	P,LDEVCH	; *307* DO DEVCHR FOR LOGICAL DEVICE
BMOVEDVNUM.LOWC	004227'	200000	000113'		MOVE	0,DVNUM.(LOW)	; *307* RESTORE DEVICE NUMBER TO 0
BJUMPNEMATNFDC	004230'	326240	004232'		JUMPN	E,MATNFD	; *307* IT WAS, YOU LOSE, TRY NEXT ENTRY
BSKIPAEDC	004231'	334244	000001		SKIPA	E,1(D)		; *307* ALL IS WELL, SO RESTORE DEVCHR BITS
BMATNFDSOJGCNFI1C	004232'	367140	004211'	MATNFD:	SOJG	C,NFI1		;LOOP FOR ALL IN TABLE>
BIFN%352C				IFN %352,<ADDI	C,5		;MAKE ROOM FOR NEGATIVES.
BC					IDIVI	C,9
BC					ASH	D,2
BC					SUBI	D,^D32
BC					MOVM	D,D		;MAKE IT POSITIVE
BC					LSH	D,^D30		;ALLIGN IT.
BC					TLO	D,400		;4-BIT BYTES
BC					HRR	D,C
BC					ADDI	D,DYCHR.(LOW)
BC					MOVEM	D,DYPNT.(LOW)	;SAVE POINTER
BC					LDB	C,D		;GET CHANNEL NUMBER FOR THIS DEVICE.
BC				MATSET:	MOVEI	D,DYNCH.(LOW)	;BEGINNING OF CHARACTERISTICS TABLE
BC					ADD	D,C		;ADDRESS OF DEVICE
BC					MOVE	E,(D)		;GET CHARACTERISTICS.>
BMATFNDJUMPECNFI2C	004233'	322140	004255'	MATFND:	JUMPE	C,NFI2		;JUMP IF NOT IN TABLE, NEW DEVICE
BTLNENRELFL.C	004234'	603700	002000		TLNE	N,RELFL.	;DOING RELEAS?
BJRSTRELESC	004235'	254000	004472'		JRST	RELES		;YES
BTLNENSMTTY.C	004236'	603700	004000		TLNE	N,SMTTY.	;IS SIMULATE TTY BEING DONE
BJRSTHRLZITTYBITC					JRST	[HRLZI	0,TTYBIT	;YES. SET TTYBIT
BIORMDC						IORM	0,1(D)
BJRSTFI.C	004237'	254000	007145'			JRST	FI.]
BTLNEIOPF.C	004240'	603440	004000		TLNE	I,OPF.		;OPEN STATEMENT?
BERRORAROPN.C	004241'	260740	000000*		ERROR	AROPN.		;ERROR. UNIT IN USE
BTLNNIPOSS.POSF.SIZF.C	004242'	607440	160000		TLNN	I,POSS.!POSF.!SIZF. ;IS THIS A POSITION OR SIZE
BJRSTFNDTTYC	004243'	254000	004250'		JRST	FNDTTY		;NO
BPUSHPBC	004244'	261740	000002		PUSH	P,B
BMOVEBDVNUM.LOWC	004245'	200100	000113'		MOVE	B,DVNUM.(LOW)	;YES. GET F4 UNIT CHARACTERISTICS
BIFNREENTC				IFN REENT,<ADDI	B,(LOW)>
BIORIUNITC.BC	004246'	434442	000553'		IOR	I,UNITC.(B)	;MERGE IN CHARACTERISTICS
BPOPPBC	004247'	262740	000002		POP	P,B
BFNDTTYPUSHJPFIDLDVC	004250'	260740	005006'	FNDTTY:	PUSHJ	P,FIDLDV	;LOOK AT DEVCHR BITS
BADDDCC	004251'	270200	000003		ADD	D,C		;RETURNED D=ADDR OF DYNDV., SET D=ADDR OF ENTRY
BMOVEDC	004252'	200004	000000		MOVE	0,(D)		;AND 0=CONTENTS FOR THIS DEVICE
BTRZC	004253'	620000	000077		TRZ	0,77		;CLEAR SIXTH CHAR OF DEVICE NAME
BJRSTDEVFNDC	004254'	254000	005111'		JRST	DEVFND		;FOUND THE DEVICE
BC				;HERE WHEN DEVICE NOT YET INITED
BC
BNFI2TLNENRELFL.SMTTY.C	004255'	603700	006000	NFI2:	TLNE	N,RELFL.!SMTTY.	;DOING RELEAS OR SIMULATE TTY UUO
BJRSTFI.C	004256'	254000	003506'		JRST	FI.		;YES, JUST RETURN (NO-OP)
BTLNENDFLFL.C	004257'	603700	000400		TLNE	N,DFLFL.	;DEFAULT DEVICE?
BJRSTNEGNUMC	004260'	254000	004277'		JRST	NEGNUM		;YES, BYPASS CHECK FOR LOGICAL ASSIGNMENT
BMOVEBDVNUM.LOWC	004261'	200100	000113'		MOVE	B,DVNUM.(LOW)	;GET FORTRAN UNIT NUMBER
BIFNREENTDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-39
FORSE.MAC	26-JUL-84 01:16		IN. OR OUT. UUOS

BC				IFN REENT,<ADDI	B,(LOW)>
BSKIPNTTYUN.BC	004262'	336002	001053'		SKIPN	TTYUN.(B)	;IS THIS UNIT THE TTY
BJRSTNFI3C	004263'	254000	004266'		JRST	NFI3		;NO
BSKIPECTTYCH.LOWC	004264'	332140	001772'		SKIPE	C,TTYCH.(LOW)	;YES. USE TTY CHANNEL
BJRSTFNDTTYC	004265'	254000	004250'		JRST	FNDTTY
BNFI3PUSHJPLDEVCHC	004266'	260740	004412'	NFI3:	PUSHJ	P,LDEVCH	; *307* TRY DEVCHR FOR LOGICAL DEVICE
BMOVEBC	004267'	200100	000000		MOVE	B,0
BMOVEMDEVNAMLOWC	004270'	202000	001502'		MOVEM	0,DEVNAM(LOW)
BTLNNEUSRTTYC	004271'	607240	020000		TLNN	E,USRTTY	;CONTROLLING TTY?
BJRSTC	004272'	254000	004275'		JRST	.+3		;NO
BSKIPECTTYCH.LOWC	004273'	332140	001772'		SKIPE	C,TTYCH.(LOW)	;YES, GET TTY CHAN. IF SET UP
BJRSTFNDTTYC	004274'	254000	004250'		JRST	FNDTTY		;IT IS SET UP , SO USE IT
BTRNEEASSCONC	004275'	602240	400000		TRNE	E,ASSCON	;HAS THE DEVICE BEEN ASIGNED BY CONSOL?
BTLOANASSFL.C	004276'	665700	001000		TLOA	N,ASSFL.	;YES, SET FLAG SO DYNCH. CAN BE SET
BNEGNUMPUSHJPGETDV.C	004277'	260740	005042'	NEGNUM:	PUSHJ	P,GETDV.	;NO, GET NAME FROM DEVTB
BTLNEIRRF.C	004300'	603440	000010		TLNE	I,RRF.		;COMPARE FOR REREAD
BERRORILRED.C	004301'	260740	000000*		ERROR	ILRED.		;ILLEGAL REREAD
BTLNNEUSRTTYC	004302'	607240	020000		TLNN	E,USRTTY	; *327* CONTROLLING TTY?
BJRSTC	004303'	254000	004306'		JRST	.+3		; *307* NO
BSKIPECTTYCH.LOWC	004304'	332140	001772'		SKIPE	C,TTYCH.(LOW)	; *327* YES, GET TTY CHAN. IF SET UP
BJRSTFNDTTYC	004305'	254000	004250'		JRST	FNDTTY		; *327* IT IS SET UP , SO USE IT
BPUSHJPFNDSLTC	004306'	260740	007036'		PUSHJ	P,FNDSLT	;FIND A SOFTWARE CHANNEL
BHRLZMCC	004307'	514340	000003		HRLZ	M,C		;SAVE DEVICE NO.
BASHMC	004310'	240340	000005		ASH	M,5		;DEVICE NO. IN AC FIELD
BMOVEMBDC	004311'	202104	000000		MOVEM	B,(D)		;PUT DEVICE NAME IN TABLE
BHRRGDC	004312'	540640	000004		HRR	G,D		;SAVE ADDR. FOR THIS NAME
BPUSHJPBUFCA.C	004313'	260740	005322'		PUSHJ	P,BUFCA.	;GET A BUFFER HEADER
BMOVEMGDNAMELOWC	004314'	202640	001477'		MOVEM	G,DNAME(LOW)	;SAVE DEV NAME ADDR
BSKIPGERANAC.LOWC	004315'	335000	001760'		SKIPGE	RANAC.(LOW)	;IF RANDOM ACCESS
BADDC	004316'	270000	007150'		ADD	0,[3,,0]	;SET UP BUFFER HEADERS TO BE ADDRESS CHECKED
BMOVEMINIT.LOWC	004317'	202000	001731'		MOVEM	0,INIT.+2(LOW)	;BUFFER HEADER ADDRESS
BSETZMINIT.LOWC	004320'	402000	001727'		SETZM	INIT.(LOW)	;V.007  ZERO THE ADDRESS PART
BMOVEDEVNAMLOWC	004321'	200000	001502'		MOVE	0,DEVNAM(LOW)
BMOVEMINIT.LOWC	004322'	202000	001730'		MOVEM	0,INIT.+1(LOW)	;DEVICE NAME
BSKIPLRANAC.LOWC	004323'	331000	001760'		SKIPL	RANAC.(LOW)	;RANDOM ACCESS
BJRSTC	004324'	254000	004331'		JRST	.+5		;NO
BMOVEIC	004325'	201000	000016		MOVEI	0,16		;DUMP MODE
BMOVEMINIT.LOWC	004326'	202000	001727'		MOVEM	0,INIT.(LOW)	;YES, SET DUMP MODE
BTLNNEDSKBITC	004327'	607240	200000		TLNN	E,DSKBIT	;MUST BE DSK
BERRORRANER.C	004330'	260740	000000*		ERROR	RANER.		;IT WASN'T SO FATAL ERROR
BIFNREENTC				IFN REENT,<OPEN.==0
BC					MOVSI	OPEN.,(OPEN )	;SET UP UUO>
BDPBCPOINTOPEN.C	004331'	137140	007151'		DPB	C,[POINT 4,OPEN.,12]	;CHANNEL NO.
BTLNNELPTBITTTYBITC	004332'	607240	040010		TLNN	E,LPTBIT!TTYBIT	;BUT MAY NOT BE IN "N" YET. SO TEST "E"
BTLNENTTYFL.C	004333'	603700	000001		TLNE	N,TTYFL.	;TTY OR LPT?
BHRRIIC	004334'	541440	000001		HRRI	I,1		;YES,ASCII LINE
BTLNEEMTABITC	004335'	603240	000020		TLNE	E,MTABIT	;V.007  DEVICE MTA?
BPUSHJPMGINITC	004336'	260740	006612'		PUSHJ	P,MGINIT	;V.007  YES, GO SET UP MODE BITS
BPUSHPIC	004337'	261740	000011		PUSH	P,I		;SAVE I
BHRRZSIC	004340'	553000	000011		HRRZS	I		;MODE BITS ONLY
BSKIPLRANAC.LOWC	004341'	331000	001760'		SKIPL	RANAC.(LOW)	;SETUP ALREADY IF RANDOM ACCESS
BIORMIINIT.LOWC	004342'	436440	001727'		IORM	I,INIT.(LOW)	;SET MODE ETC
BPOPPIC	004343'	262740	000011		POP	P,I		;RESTORE I
BIFNREENTDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-40
FORSE.MAC	26-JUL-84 01:16		IN. OR OUT. UUOS

BC				IFN REENT,<HRRI	OPEN.,INIT.(LOW)
BC					XCT	OPEN.		;DO OPEN UUO>
BIFEREENTC				IFE REENT,<
BOPEN.OPENINIT.C	004344'	050000	001727'	OPEN.:	OPEN	,INIT.		;INIT THE DEVICE>
BERRORINIER.C	004345'	260740	000000*		  ERROR	INIER.		;NOT AVAILABLE OR UNDEFINED
BTRZC	004346'	620000	000077		TRZ	0,77		;CLEAR SIXTH CHAR OF DEVICE NAME
BMOVEMBDEVIC.LOWC	004347'	202100	001476'		MOVEM	B,DEVIC.(LOW)	;CURRENT DEVICE NAME
BPUSHJPCLROU.C	004350'	260740	006204'		PUSHJ	P,CLROU.	;CLEAR OUTPUT-LAST BIT
BSKIPGERANAC.LOWC	004351'	335000	001760'		SKIPGE	RANAC.(LOW)	;RANDOM ACCESS?
BPUSHJPSNGLBFC	004352'	260740	005335'		PUSHJ	P,SNGLBF	;YES, GET BUFFER SPACE
BMOVEIBDYNCH.LOWC	004353'	201100	000333'		MOVEI	B,DYNCH.(LOW)	;ADDR OF DEVICE CHARACTERISTICS TABLE
BADDBCC	004354'	270100	000003		ADD	B,C		;INDEX FOR THIS DEVICE
BHRREDVNUM.LOWC	004355'	540240	000113'		HRR	E,DVNUM.(LOW)	;LH=DEVCHR, RH=FTN DEVICE
BPUSHPCC	004356'	261740	000003		PUSH	P,C		;SAVE CHAN.
BDEVTYPCC	004357'	047140	000053		DEVTYP	C,		;NEW DEVCHR TYPE UUO
BJRSTNOTSPLC	004360'	254000	004363'		  JRST	NOTSPL		;NEED 5.03 TO SPOOL
BTLNEC.TYSPLC	004361'	603140	000020		TLNE	C,.TYSPL	;TEST FOR SPOOLING
BTROESPLBITC	004362'	660240	100000		TRO	E,SPLBIT	;YES, SET SPOOL FLAG
BNOTSPLPOPPCC	004363'	262740	000003	NOTSPL:	POP	P,C		;RESTORE CHAN.
BTLNENASSFL.C	004364'	603700	001000		TLNE	N,ASSFL.	;TEST FOR FLAGS AND SET IN DYNCH.
BTROEASSCONC	004365'	660240	400000		TRO	E,ASSCON	;LOGICALLY ASSIGNED
BTLNENDFLFL.C	004366'	603700	000400		TLNE	N,DFLFL.	;WAS IT A FORTRAN DEFAULT DEVICE
BTROEDFLBITC	004367'	660240	200000		TRO	E,DFLBIT	;YES
BSKIPERANAC.LOWC	004370'	332000	001760'		SKIPE	RANAC.(LOW)	;RANDOM ACCESS?
BTROEDMPBITC	004371'	660240	040000		TRO	E,DMPBIT	;YES, WILL USE DUMP MODE
BMOVEMEBC	004372'	202242	000000		MOVEM	E,(B)		;THOUGH REALLY ONLY NEED 7 BITS
BPUSHJPFIDLDVC	004373'	260740	005006'		PUSHJ	P,FIDLDV	;LOOK AT DEVCHR BITS
BSKIPERANAC.LOWC	004374'	332000	001760'		SKIPE	RANAC.(LOW)	;IS IT A RANDOM FILE
BJRSTMOVEBC					JRST	[MOVE	B,[1,,203]
BJRSTNOTSP1C	004375'	254000	007153'			JRST	NOTSP1]
BMOVEIBINIT.LOWC	004376'	201100	001727'		MOVEI	B,INIT.(LOW)	;ADDRESS OF OPEN DATA
BDEVSIZBC	004377'	047100	000101		DEVSIZ	B,		;GET BUFFER SIZE
BPUSHJPDSKSIZC	004400'	260740	004435'		PUSHJ	P,DSKSIZ	;FAILED. SEE IF DSK
BNOTSP1C	004401'			NOTSP1:
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)		;SO INDEXING WILL WORK>
BMOVEMBBUFSZ.CC	004401'	202103	000253'		MOVEM	B,BUFSZ.(C)	;STORE INFO
BIFNREENTC				IFN REENT,<SUBI	C,(LOW)>
BMOVEBDVNUM.LOWC	004402'	200100	000113'		MOVE	B,DVNUM.(LOW)	;GET DEV NUMBER
BC				                        ;TYM  THE FOLLOWING TWO LINES HAVE
BC				                        ;TYM  REMOVED TO CORRECT REREADING OF WRONG FILE
BC				                        ;TYM  AFTER OPEN OF A FILE, AND TO GET THE
BC				                        ;TYM  REREAD POINTERS WITHIN REASONABLE
BC				                        ;TYM  BOUNDS FOR AN INCORRECTLY EXECUTED REREAD
BC				;	JUMPL	I,.+2		;SKIP ON OUTPUT
BC				;	MOVEM	B,RERDN.(LOW)	;SAVE DEV. # FOR REREAD.
BMOVEMBFILNUMLOWC	004403'	202100	000131'		MOVEM	B,FILNUM(LOW)	;SAVE FOR FILE NAME
BIFNREENTC				IFN REENT,<ADDI	B,(LOW)>
BMOVEIC	004404'	200000	000011		MOVE	0,I		;GET FILE CHARACTERISTICS
BTLZIOF.FIOF.C	004405'	621000	377677		TLZ	0,-1-<IOF.!FIOF.> ;SAVE ONLY MODE AND ACCESS
BMOVEMUNITC.BC	004406'	202002	000553'		MOVEM	0,UNITC.(B)	;SAVE FOR LATER FILE ACCESS
BSKIPEBDATTB.BC	004407'	332102	001131'		SKIPE	B,DATTB.(B)	;IF BUFFER WAS CALLED,
BPUSHJPSETBFSC	004410'	260740	004677'		PUSHJ	P,SETBFS	;GO SET UP RINGS.
BJRSTDVFC	004411'	254000	005137'		JRST	DVF
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-41
FORSE.MAC	26-JUL-84 01:16		IN. OR OUT. UUOS

BC
BC				;HERE TO TRY DEVCHR FOR LOGICAL ASSIGNMENT
BC				;EXPECTS FORTRAN DEVICE NUMBER IN AC0, RETURNS DEVCHR BITS IN AC E
BC
BLDEVCHTLNNIOPF.C	004412'	607440	004000	LDEVCH:	TLNN	I,OPF.		;OPEN STATEMENT?
BJRSTLDEVC1C	004413'	254000	004421'		JRST	LDEVC1		;NO
BMOVEOPNDEVLOWC	004414'	200000	000114'		MOVE	0,OPNDEV(LOW)	;USE OPEN DEVICE
BMOVEEC	004415'	200240	000000		MOVE	E,0		;RETURN THIS DEVICE NUMBER
BDEVCHREC	004416'	047240	000004		DEVCHR	E,
BTROEASSCONC	004417'	660240	400000		TRO	E,ASSCON	;THIS DEVICE ASSIGNED BY OPEN STATEMENT
BPOPJPC	004420'	263740	000000		POPJ	P,
BLDEVC1PUSHPAC	004421'	261740	000001	LDEVC1:	PUSH	P,A		;SAVE AC
BIDIVIC	004422'	231000	000012		IDIVI	0,12		;CONVRT TO 6-BIT
BLSHC	004423'	242000	000006		LSH	0,6
BORC	004424'	434000	000001		OR	0,1		;CAN HAVE UP TO 77 OCT DEVICES THIS WAY
BIORIC	004425'	435000	002020		IORI	0,2020
BTRNNC	004426'	606000	000700		TRNN	0,700		;TWO DIGITS?
BLSHC	004427'	242000	000006		LSH	0,6		;ONE DIGIT
BLSHC	004430'	242000	000030		LSH	0,30		;LEFT JUSTIFY
BMOVEEC	004431'	200240	000000		MOVE	E,0
BPOPPAC	004432'	262740	000001		POP	P,A		;RESTORE AC
BDEVCHREC	004433'	047240	000004		DEVCHR	E,
BPOPJPC	004434'	263740	000000		POPJ	P,
BC
BC				;HERE TO TEST FOR DSK AND SIMULATE DEVSIZ UUO 
BC				;IF DEVICE IS NOT DSK RETURN -1
BC				;IF DSK IN DUMP MODE RETURN 0
BC				;IF DSK IN BUFFERED MODE REURN 2,,203
BC
BDSKSIZSETZBC	004435'	400100	000000	DSKSIZ:	SETZ	B,		;CLEAR B FOR RETURN
BTLNNEDSKBITC	004436'	607240	200000		TLNN	E,DSKBIT	;IS IT A DSK?
BSOJABCPOPJC	004437'	364100	003335'		SOJA	B,CPOPJ		;NO, RETURN -1
BTRNNEDMPBITC	004440'	606240	040000		TRNN	E,DMPBIT	;DSK, BUT IN DUMP MODE?
BMOVEBC	004441'	200100	007155'		MOVE	B,[2,,203]	;NO, STANDARD  DOUBLE BUFFERING
BPOPJPC	004442'	263740	000000		POPJ	P,
BC
BC				;AS ABOVE BUT USES AC0, NO NEED TO TEST FOR DUMP MODE THOUGH
BC
BDSKSZ0SETOC	004443'	474000	000000	DSKSZ0:	SETO	0,		;ASSUME NOT A DSK (RETURN -1)
BTLNEEDSKBITC	004444'	603240	200000		TLNE	E,DSKBIT	;IS IT A DSK?
BMOVEC	004445'	200000	007155'		MOVE	0,[2,,203]	;YES, STANDARD BUFFER SIZE RETURN
BPOPJPC	004446'	263740	000000		POPJ	P,
BSUBTTLC				SUBTTL	FORTRAN CALLI UUO
BC
BC				;FCALLI 0, WHICH EXPECTS DEVICE NUMBER IN AC0
BC				;FCALLI 1, WHICH RELEASES ALL CHANNELS IN USE
BC				;FCALLI 2,N WHICH CAUSES CARRIAGE CONTROL TO BE USED ON UNIT N
BC				;FCALLI 3, WHICH STOPS MEMORY BEING RELEASED WHEN BUFFERS ARE RELEASED
BC
BFCALLILDBBPTRUC	004447'	135100	007051'	FCALLI:	LDB	B,PTRU		;GET ACC FIELD
BCAILEBC	004450'	303100	000003		CAILE	B,3		;FUNCTION <=3?
BPUSHJPILUUO.C	004451'	260740	002244*		PUSHJ	P,ILUUO.	;NO
BJRSTBC	004452'	254002	004453'		JRST	.+1(B)		;GO TO CORRECT FUNCTION
BJRSTFCALL0DFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-42
FORSE.MAC	26-JUL-84 01:16		FORTRAN CALLI UUO

BC	004453'	254000	004462'		JRST	FCALL0
BJRSTFCALL1C	004454'	254000	004467'		JRST	FCALL1
BJRSTFCALL2C	004455'	254000	004460'		JRST	FCALL2
BC				;	JRST	FCALL3
BC
BFCALL3SETOMNRMEM.LOWC	004456'	476000	001515'	FCALL3:	SETOM	NRMEM.(LOW)	;SET NO RELESE MEMORY SWITCH
BJRSTFI.C	004457'	254000	003506'		JRST	FI.		;RETURN TO PROGRAM
BC
BFCALL2TLONSMTTY.C	004460'	661700	004000	FCALL2:	TLO	N,SMTTY.	;SET SIMULATE TTY BIT
BJRSTRELIC	004461'	254000	004155'		JRST	RELI		;GO GET CHANNEL NUMBER
BC
BFCALL0HRRZMACLSBITLOWC	004462'	552040	001516'	FCALL0:	HRRZM	A,CLSBIT(LOW)	;SAVE CLOSE BITS
BMOVEASAVEACLOWC	004463'	200040	000031'		MOVE	A,SAVEAC+0(LOW)	;GET DEVICE #
BC				;*** PART OF I/O CONSISTENCY PATCH *** [TJB 3-4-82]
BSETZMTYPFL.ACU	004464'	402001	004175*		SETZM	TYPFL.(A)	;CLEAR IT WHEN YOU CLOSE IT  [TJB v. 73]
BC				;**** END PATCH ***
BTLONRELFL.C	004465'	661700	002000		TLO	N,RELFL.	;SET RELEAS ONLY FLAG
BJRSTRELIC	004466'	254000	004155'		JRST	RELI		;GET CHAN # ETC
BC
BFCALL1MOVECDEVNO.LOWC	004467'	200140	000071'	FCALL1:	MOVE	C,DEVNO.(LOW)	;START AT HIGHEST CHANNEL IN USE
BSETZMERR.LOWC	004470'	402000	000121'		SETZM	ERR.(LOW)	;CLEAR ERR AND END IN CASE STILL ON
BSETZMEND.LOWC	004471'	402000	000120'		SETZM	END.(LOW)	;AS WE MIGHT GET ERROR ON CLOSE
BC				;	JRST	RELES		;RELEASE IT
BC
BC				;RELEASE UUO -  FCALLI 0
BC
BRELESHRLZMCC	004472'	514340	000003	RELES:	HRLZ	M,C		;CHAN. #
BASHMC	004473'	240340	000005		ASH	M,5		;IN AC FIELD
BPUSHJPBUFCA.C	004474'	260740	005322'		PUSHJ	P,BUFCA.	;GET HEADER
BHLRMGC	004475'	544340	000015		HLR	M,G		;PUT INPUT BUFFER ADDRESS IN M FOR SURE
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BMOVEBDYNDV.CC	004476'	200103	000313'		MOVE	B,DYNDV.(C)	;GET DEVICE NAME
BTRZBC	004477'	620100	000077		TRZ	B,77		;CLEAR I/O FLAGS
BCAMNBRERDV.LOWC	004500'	316100	001500'		CAMN	B,RERDV.(LOW)	;SAME AS LAST READ-DEV?
BSETZMRERDV.LOWC	004501'	402000	001500'		SETZM	RERDV.(LOW)	;YES, CLEAR IT.
BCAMNBINPDV.LOWC	004502'	316100	000112'		CAMN	B,INPDV.(LOW)	;SAME AS LAST ASCII-INPUT DEV?
BSETZMINPDV.LOWC	004503'	402000	000112'		SETZM	INPDV.(LOW)	;YES, CLEAR IT.
BMOVEIATABPT.LOWC	004504'	201040	001130'		MOVEI	A,TABPT.(LOW)	;POINTER TO MTABF.
BCLRMTACAIGEAMTABF.LOWC	004505'	305040	001121'	CLRMTA:	CAIGE	A,MTABF.(LOW)	;DONE WITH MTABF.?
BJRSTDONMTAC	004506'	254000	004514'		JRST	DONMTA		;YES
BMOVEDAC	004507'	200201	000000		MOVE	D,(A)		;GET NAME FROM MTABF.
BTRZDC	004510'	620200	000077		TRZ	D,77		;CLEAR I/O FLAGS
BCAMEDBC	004511'	312200	000002		CAME	D,B		;THE ONE WE WANT?
BSOJAACLRMTAC	004512'	364040	004505'		SOJA	A,CLRMTA	;NO, GET NEXT
BSETZMAC	004513'	402001	000000		SETZM	(A)		;YES, CLEAR IT
BDONMTAMOVEBDYNCH.CC	004514'	200103	000333'	DONMTA:	MOVE	B,DYNCH.(C)	;GET DEVCHR WORD
BTRNNBDMPBITC	004515'	606100	040000		TRNN	B,DMPBIT	;RANDOM ACCESS DEVICE?
BJRSTCHKCLSC	004516'	254000	004530'		JRST	CHKCLS		;NO
BSETOMRANAC.LOWC	004517'	476000	001760'		SETOM	RANAC.(LOW)	;SET RANDOM ACCESS FLAG
BSKIPLRANDV.CC	004520'	331003	000353'		SKIPL	RANDV.(C)	;MUST WE OUTPUT LAST BLOCK.
BJRSTCHKCLSC	004521'	254000	004530'		JRST	CHKCLS		;NO
BSETZMBLOCK.LOWC	004522'	402000	001761'		SETZM	BLOCK.(LOW)	;INHIBIT INPUT OF NEXT BLOCK
BMOVSIIIOF.C	004523'	205440	400000		MOVSI	I,IOF.		;ASSUME OUTPUT FILE
BMOVEBMDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-43
FORSE.MAC	26-JUL-84 01:16		FORTRAN CALLI UUO

BC	004524'	200107	000001		MOVE	B,1(M)		;GET STRING POINTER
BTLNNBC	004525'	607100	004000		TLNN	B,4000		;IS IT SYMBOLIC OR BINARY
BTLOIFIOF.C	004526'	661440	000100		TLO	I,FIOF.		;SYMBOLIC
BPUSHJPROUTP.C	004527'	260740	006340'		PUSHJ	P,ROUTP.	;OUTPUT LAST BLOCK
BCHKCLSTLNENRELFL.C	004530'	603700	002000	CHKCLS:	TLNE	N,RELFL.	;IS IT A SINGLE UNIT RELEASE
BSKIPNBCLSBITLOWC	004531'	336100	001516'		SKIPN	B,CLSBIT(LOW)	;AND IS THERE ANY CLOSE BITS
BJRSTOPNABTC	004532'	254000	004536'		JRST	OPNABT		;BOTH NOT TRUE
BHLLBMC	004533'	500100	000007		HLL	B,M		;GET CHANNEL NUMBER
BTLOBNCLOSEC	004534'	661100	070000		TLO	B,NCLOSE
BXCTBC	004535'	256000	000002		XCT	B
BOPNABTHLLZMC	004536'	510000	000007	OPNABT:	HLLZ	0,M		;GET CHAN #
BTLORELEASC	004537'	661000	071000		TLO	0,(RELEAS)	;SET UP RELEAS UUO
BXCTC	004540'	256000	000000		XCT	0		;DO RELEAS UUO
BPUSHJPLNKBUFC	004541'	260740	004565'		PUSHJ	P,LNKBUF	;LINK THE BUFFERS INTO CHAIN
BSETZMDYNDV.CC	004542'	402003	000313'		SETZM	DYNDV.(C)	;CLEAR DYNDV. ENTRY
BSETZMDYNCH.CC	004543'	402003	000333'		SETZM	DYNCH.(C)	;CLEAR DEVCHR BITS
BSETZMBUFSZ.CC	004544'	402003	000253'		SETZM	BUFSZ.(C)	;CLEAR BUFFER DATA
BSETZMPAKFL.CC	004545'	402003	000233'	        SETZM   PAKFL.(C)       ; /RDO 1-21-77
BC				;*** PART OF I/O CONSISTENCY PATCH *** [TJB 3-4-82]
BSETZMTYPFL.CCU	004546'	402003	004464*		SETZM	TYPFL.(C)	;CLEAR I/O TYPE
BC				;*** END PATCH ***
BSETZMINCNT.CC	004547'	402003	000273'		SETZM	INCNT.(C)
BSETZMEOFFL.CC	004550'	402003	000213'		SETZM	EOFFL.(C)
BSETZMONLY1.CC	004551'	402003	000173'		SETZM	ONLY1.(C)	;CLEAR EOF ANS ONLY1 FLAGS FOR CHANNEL
BIFNREENTC				IFN REENT,<SUBI	C,(LOW)>
BCAMNCTTYCH.LOWC	004552'	316140	001772'		CAMN	C,TTYCH.(LOW)		;ARE WE RELEASING THE TTY?
BSETZMTTYCH.LOWC	004553'	402000	001772'		SETZM	TTYCH.(LOW)		;YES, FORGET ALL ABOUT TTY
BIFN%352C				IFN %352,<MOVE	D,[POINT 4,DYCHR.(LOW)]	;CLEAR DEVICE VS. CHANNEL TABLE.
BC					MOVEI	B,DYEND.(LOW)
BC					ILDB	M,D
BC					CAMN	M,C		;IS THIS ON SAME CHANNEL?
BC					DPB	0,D		;YES, CLEAR ENTRY.
BC					CAILE	B,(D)		;ARE WE DONE?
BC					JRST	.-4		;NO.>
BASHCC	004554'	240140	000001		ASH	C,1		;2 ENTRIES/CHANNEL
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BSETZMTNAME.CC	004555'	402003	000133'		SETZM	TNAME.(C)	;CLEAR FILE NAME INPUT/OUTPUT
BSETZMTNAME.CC	004556'	402003	000134'		SETZM	TNAME.+1(C)	;
BTLNENRELFL.C	004557'	603700	002000		TLNE	N,RELFL.	;FCALLI 0?
BJRSTMOVEDDVNUM.LOWC					JRST	[MOVE D,DVNUM.(LOW)	;GET F4 UNIT NUMBER
BIFNREENTC						IFN REENT,<ADDI D,(LOW)>
BSETZMFILE2.DC						SETZM FILE2.(D)	;CLEAR UNIT DEPENDENT FLAGS
BSETZMFILE4.DC						SETZM FILE4.(D)
BSETZMFILE5.DC						SETZM FILE5.(D)
BSETZMUNITC.DC						SETZM UNITC.(D)
BSETZMTTYUN.DC						SETZM TTYUN.(D)
BJRSTFI.C	004560'	254000	007156'			JRST FI.]
BSOSLCDEVNO.LOWC	004561'	371140	000071'		SOSL	C,DEVNO.(LOW)	;FCALLI 1
BJRSTRELESC	004562'	254000	004472'		JRST	RELES		;MORE TO GO
BSETZMDEVNO.LOWC	004563'	402000	000071'		SETZM	DEVNO.(LOW)	; *355* RESTORE TO ZERO INCASE  START OR REENTER
BJRSTFI.C	004564'	254000	003506'		JRST	FI.		;ALL DONE
BC				;RELEASED BUFFER SPACE IS LINKED TOGETHER HERE
BC				;LINK. CONTAING THE MASTER POINTERS
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-44
FORSE.MAC	26-JUL-84 01:16		FORTRAN CALLI UUO

BC				;XWD FIRST LINK ,, LAST LINK
BC				;LINK. POINTS TO THE FIRST WORD OF THE BUFFER AREA RECOVERED
BC				;IN THAT AREA THE FIRST WORD IS A LINK TO THE PREVIOUS AND NEXT AREAS
BC				;POINTER IS XWD PREVIOUS AREA ,, NEXT AREA
BC				;SECOND WORD IS DEVSIZ RETURN
BC				;XWD NUMBER OF BUFFERS IN RING ,, BUFFER SIZE
BC				;A POINTER OF ZERO IS THE END OF THE CHAIN
BC
BLNKBUFSKIPGABUFSZ.CC	004565'	337043	000253'	LNKBUF:	SKIPG	A,BUFSZ.(C)	;GET BUFFER INFO.
BPOPJPC	004566'	263740	000000		POPJ	P,		;NOT AVAILABLE, OR DONE
BPUSHPEC	004567'	261740	000005		PUSH	P,E		;BETTER SAVE E
BSKIPEDMC	004570'	332207	000000		SKIPE	D,(M)		;INPUT BUFFER USED?
BPUSHJPLINKUPC	004571'	260740	004600'		PUSHJ	P,LINKUP	;YES, RECLAIM IT
BSETZMMC	004572'	402007	000000		SETZM	(M)		;CLEAR INPUT BUFFER POINTER
BSKIPEDMC	004573'	332207	000003		SKIPE	D,3(M)		;OUTPUT BUFFER USED?
BPUSHJPLINKUPC	004574'	260740	004600'		PUSHJ	P,LINKUP	;YES
BSETZMMC	004575'	402007	000003		SETZM 	3(M)		;CLEAR OUTPUT BUFFER POINTER
BPOPPEC	004576'	262740	000005		POP	P,E		;RESTORE IT
BPOPJPC	004577'	263740	000000		POPJ	P,		;RETURN
BC
BLINKUPHRRZDDC	004600'	550200	000004	LINKUP: HRRZ    D,D             ;INSURE ONLY ADDRESS SET
BHRRZEDC	004601'	550244	000000		HRRZ	E,(D)		;GET NEXT BUFFER IN RING
BJUMPEECPOPJC	004602'	322240	003335'		JUMPE	E,CPOPJ		;IS THERE ACTUALLY A RING
BLNKUP1CAINEDC	004603'	306244	000000	LNKUP1:	CAIN	E,(D)		;BEEN ROUND RING?
BSOJADLINK1C	004604'	364200	004611'		SOJA	D,LINK1		;YES
BCAIGEDC	004605'	307244	000000		CAIG	E,(D)		;NEARER ZERO?
BHRRZDEC	004606'	550200	000005		HRRZ	D,E		;YES
BHRRZEEC	004607'	550245	000000		HRRZ	E,(E)		;NEXT BUFFER IN RING
BJRSTLNKUP1C	004610'	254000	004603'		JRST	LNKUP1		;TRY AGAIN
BC
BLINK1MOVEMADC	004611'	202044	000001	LINK1:	MOVEM	A,1(D)		;SET BUFFER SIZE OF RETURNED BUFFERS
BMOVEBLINK.LOWC	004612'	200100	000132'		MOVE	B,LINK.(LOW)	;GET FREE LIST POINTER
BPUSHJPRELMEMC	004613'	260740	004661'		PUSHJ	P,RELMEM	;TRY TO RETURN MEMORY OF RETURNED BUFFER
BJRSTLINK5C	004614'	254000	004632'		JRST	LINK5		;NOT RELEASED. PUT ON FREE LIST
BJUMPEBCPOPJC	004615'	322100	003335'		JUMPE	B,CPOPJ		;NOTHING ON FREE LIST. RETURN
BHRRZDBC	004616'	550200	000002		HRRZ	D,B		;SEARCH FREE LIST FOR ANYTHING TO RELEASE
BC
BLINK2HLRZADC	004617'	554044	000000	LINK2:	HLRZ	A,(D)		;NEXT BUFFER FROM END OF FREE LIST
BPUSHJPRELMEMC	004620'	260740	004661'		PUSHJ	P,RELMEM	;CAN MEMORY BE RELEASED
BJRSTLINK3C	004621'	254000	004625'		JRST	LINK3		;NO. FIX FREE LIST AND EXIT
BJUMPEALINK4C	004622'	322040	004630'		JUMPE	A,LINK4		;ANYMORE BUFFERS ON FREE LIST
BMOVEDAC	004623'	200200	000001		MOVE	D,A		;YES. TRY TO RELEASE IT
BJRSTLINK2C	004624'	254000	004617'		JRST	LINK2
BC
BLINK3HRRMDLINK.LOWC	004625'	542200	000132'	LINK3:	HRRM	D,LINK.(LOW)	;SET NEW END OF FREE LIST
BHLLZSDC	004626'	513004	000000		HLLZS	(D)		;CLEAR NEXT POINTER OF LAST BUFFER ON FREE LIST
BPOPJPC	004627'	263740	000000		POPJ	P,		;RETURN
BC
BLINK4SETZMLINK.LOWC	004630'	402000	000132'	LINK4:	SETZM	LINK.(LOW)	;CLEAR FREE LIST
BPOPJPC	004631'	263740	000000		POPJ	P,		;AND RETURN
BC
BLINK5JUMPNBLINK6C	004632'	326100	004637'	LINK5:	JUMPN	B,LINK6		;ARE THERE ANY ENTRIES ON FREE LIST
BSETZMDC	004633'	402004	000000		SETZM	(D)		;NO PREV OR NEXT POINTERS
BHRRMDLINK.LOWDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-45
FORSE.MAC	26-JUL-84 01:16		FORTRAN CALLI UUO

BC	004634'	542200	000132'		HRRM	D,LINK.(LOW)	;SET LAST POINTER OF FREE LIST
BHRLMDLINK.LOWC	004635'	506200	000132'		HRLM	D,LINK.(LOW)	;SET FIRST POINTER OF FREE LIST
BPOPJPC	004636'	263740	000000		POPJ	P,		;AND RETURN
BC
BLINK6HLRZABC	004637'	554040	000002	LINK6:	HLRZ	A,B		;SEARCH FREE LIST FOR POSITION OF RETURNED BUFFER
BC
BLINK7CAMGEDAC	004640'	315200	000001	LINK7:	CAMGE	D,A		;DOES NEW BUFFER GO BEFORE THIS SPACE
BJRSTLINK8C	004641'	254000	004650'		JRST	LINK8		;YES. GO INSERT
BHRRZAAC	004642'	550041	000000		HRRZ	A,(A)		;GET ADDRESS OF NEXT BUFFER
BJUMPNALINK7C	004643'	326040	004640'		JUMPN	A,LINK7		;ANYMORE ENTRIES ON FREE LIST
BHRLZMBDC	004644'	516104	000000		HRLZM	B,(D)		;NO. MAKE RETURNED BUFFER LAST ON FREE LIST
BHRRMDBC	004645'	542202	000000		HRRM	D,(B)		;MAKE OLD LAST POINT TO NEW LASE
BHRRMDLINK.LOWC	004646'	542200	000132'		HRRM	D,LINK.(LOW)	;NEW LAST ON FREE LIST
BPOPJPC	004647'	263740	000000		POPJ	P,		;RETURN
BC
BLINK8HLLAC	004650'	500001	000000	LINK8:	HLL	0,(A)		;CONSTRUCT POINTER FOR NEW BUFFER
BHRRAC	004651'	540000	000001		HRR	0,A		;PREV IS PREV OF OLD. NEXT IS OLD POINTER
BMOVEMDC	004652'	202004	000000		MOVEM	0,(D)		;STORE IN RETURNED BUFFER
BHRLMDAC	004653'	506201	000000		HRLM	D,(A)		;MAKE OLD PREV POINT TO NEW
BTLNNC	004654'	607000	777777		TLNN	0,-1		;IS INSERT BEFORE FIRST
BJRSTHRLMDLINK.LOWC					JRST	[HRLM	D,LINK.(LOW)	;YES. MAKE NEW, NEW FIRST
BPOPJPC	004655'	254000	007165'			POPJ	P,]
BHLRZAC	004656'	554040	000000		HLRZ	A,0		;MAKE OLD PREV POINT TO NEW
BHRRMDAC	004657'	542201	000000		HRRM	D,(A)
BPOPJPC	004660'	263740	000000		POPJ	P,		;RETURN
BC
BRELMEMPUSHPAC	004661'	261740	000001	RELMEM:	PUSH	P,A		;SAVE TO DO SIZE COMPUTATION
BHRRZDC	004662'	550004	000001		HRRZ	0,1(D)		;GET SIZE OF ONE BUFFER
BHLRZADC	004663'	554044	000001		HLRZ	A,1(D)		;GET NUMBER OF BUFFERS
BIMULAC	004664'	220000	000001		IMUL	0,A		;GET NUMBER OF WORDS
BADDDC	004665'	270000	000004		ADD	0,D		;GET ADDRESS OF WORD AFTER BUFFERS
BSKIPLNRMEM.LOWC	004666'	331000	001515'		SKIPL	NRMEM.(LOW)	;SHOULD MEMORY BE RELEASED
BCAMGE.JBFFC	004667'	315000	000000*		CAMGE	0,.JBFF		;OR IS IT END OF MEMORY
BJRSTRLMN1C	004670'	254000	004675'		JRST	RLMN1		;NO
BHRRMD.JBFFC	004671'	542200	004667*		HRRM	D,.JBFF		;YES. SET NEW END OF MEMORY
BHRRZDC	004672'	550000	000004		HRRZ	0,D		;MOVE NEW LAST ADDRESS FOR CORE CALL
BPUSHJPXPANDC	004673'	260740	005365'		PUSHJ	P,XPAND		;DECREASE MEMORY
BAOSPC	004674'	350017	777777		AOS	-1(P)		;SET SKIP RETURN
BRLMN1POPPAC	004675'	262740	000001	RLMN1:	POP	P,A
BPOPJPC	004676'	263740	000000		POPJ	P,
BC
BC
BSUBTTLC				SUBTTL INBUF AND OR OUTBUF FOR DEVICE JUST INITED
BC				;EXPECTS:	(B)=RING DATA FROM DATTB. 
BC				;		(C)=CHAN. NUM
BC
BSETBFSPUSHPBC	004677'	261740	000002	SETBFS:	PUSH	P,B		;SAVE DATA
BHLRZSBC	004700'	557000	000002		HLRZS	B		;GET BUFFER SIZE
BC								;SKIP IF NOT DETERMINED,DO NUMBER/NOT SIZE
BJUMPNBSETUP1C	004701'	326100	004716'		JUMPN	B,SETUP1	;GO SET UP ODD SIZED BUFFERS,EXPAND IF NECESSARY
BLDBBPOINTPC	004702'	135100	007167'		LDB	B,[POINT 4,(P),31]	;GET "IN"DATA
BJUMPEBCHKOT1C	004703'	322100	004707'		JUMPE	B,CHKOT1	;SEE IF RING SPEC.
BDPBCPOINTBC	004704'	137140	007170'		DPB	C,[POINT 4,B,12]
BTLOBNINBUFDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-46
FORSE.MAC	26-JUL-84 01:16		INBUF AND OR OUTBUF FOR DEVICE JUST INITED

BC	004705'	661100	064000		TLO	B,NINBUF	;SETUP INBUF UUO.
BXCTBC	004706'	256000	000002		XCT	B		;EXECUTE INBUF ON CHAN.(LOW) (C)
BC
BCHKOT1LDBBPOINTPC	004707'	135100	007171'	CHKOT1:	LDB	B,[POINT 4,(P),35]	;GET "OUT" DATA
BJUMPEBBFDONEC	004710'	322100	004714'		JUMPE	B,BFDONE	;SEE IF RING SPEC.
BDPBCPOINTBC	004711'	137140	007170'		DPB	C,[POINT 4,B,12]
BTLOBNOUBUFC	004712'	661100	065000		TLO	B,NOUBUF	;SET UP OUTBUF UUO
BXCTBC	004713'	256000	000002		XCT	B		;EXECUTE OUTBUF
BC
BBFDONEPOPPPC	004714'	262757	000000	BFDONE:	POP	P,(P)		;PUT STACK BACK IN SYNK.
BJRSTCLRBFZC	004715'	254000	004770'		JRST	CLRBFZ		;CLEAR BUFSZ.(LOW)
BC
BC				;THE FOLLOWING CODE SETS UP NON-STANDARD SIZE BUFFERS FOR THE DEVICE INITED
BC				;ON CHAN. # FOUND IN AC(C).  CORE IS EXPANDED IF NEEDED.  IF THE
BC				;USER HAS SPECIFIED NUMBER AND SIZE SUCH THAT THE BUFFERS WILL NOT FIT IN
BC				;CORE, THE NUMBER OF BUFFERS IS FIRST CUT TO TWO , THEN ONE.
BC
BSETUP1TLNEIIOF.C	004716'	603440	400000	SETUP1:	TLNE	I,IOF.		;IF OUTPUT
BSUBIMC	004717'	275340	000003		SUBI	M,3		;MAKE M POINT TO INPUT BUFFER HEADER
BADDIBC	004720'	271100	000002		ADDI	B,2		;TOTAL AREA/BUFFER
BPUSHPBC	004721'	261740	000002		PUSH	P,B		;STORE TOTAL SIZE
BEXCHCPC	004722'	250157	777777		EXCH	C,-1(P)		;SAVE CHAN # FOR FUTURE USE
BPUSHPCC	004723'	261740	000003		PUSH	P,C		;DATA ON TOP OF STACK AGAIN
BLDBCPOINTPC	004724'	135140	007167'		LDB	C,[POINT 4,(P),31]	;GET # BUFFERS INPUT
BJUMPECC	004725'	322140	004727'		JUMPE	C,.+2		;WAS IT INPUT?
BPUSHJPSETUPBC	004726'	260740	004740'		PUSHJ	P,SETUPB	;YES, SET UP BUFFER RING
BADDIMC	004727'	271340	000003		ADDI	M,3		;POINT TO OUTPUT BUFFER HEADER
BLDBCPOINTPC	004730'	135140	007171'		LDB	C,[POINT 4,(P),35]	;GET # BUFFERS OUTPUT
BJUMPECC	004731'	322140	004733'		JUMPE 	C,.+2		;NOT OUTPUT
BPUSHJPSETUPBC	004732'	260740	004740'		PUSHJ	P,SETUPB	;YES, SET UP BUFFERS
BSUBPC	004733'	274740	007100'		SUB	P,[2,,2]	;STACK BACK IN SYNK.
BTLNNIIOF.C	004734'	607440	400000		TLNN	I,IOF.		;OUTPUT?
BSUBIMC	004735'	275340	000003		SUBI	M,3		;NO, WAS INPUT
BPOPPCC	004736'	262740	000003		POP	P,C		;RESTORE CHAN
BPOPJPC	004737'	263740	000000		POPJ	P,
BC
BSETUPBMOVEB.JBFFC	004740'	200100	004671*	SETUPB:	MOVE	B,.JBFF		;GET JOBFF
BPUSHPCC	004741'	261740	000003		PUSH	P,C		;SAVE NUM BUFFERS
BTRYAGNIMULCPC	004742'	220157	777775	TRYAGN:	IMUL	C,-3(P)		;CALCULATE SPACE NEEDED
BADDCBC	004743'	270140	000002		ADD	C,B		;GET HIGEST LOCATION NEEDED
BCAMLC.JBRELC	004744'	311140	000000*		CAML	C,.JBREL	;WILL IT FIT?
BJRSTGETCORC	004745'	254000	004772'		JRST	GETCOR		;NO, GO GET MORE CORE
BGOTCORMOVEMC.JBFFC	004746'	202140	004740*	GOTCOR:	MOVEM	C,.JBFF		;YES,NOW IT FITS.SET UP NEW JOBFF
BMOVEICBC	004747'	201142	000002		MOVEI	C,2(B)		;PICK UP FIRST DATA WORD ADDRESS
BHRRMCMC	004750'	542147	000001		HRRM	C,1(M)		;STORE IT IN RING HEADER
BMOVEICBC	004751'	201142	000001		MOVEI	C,1(B)		;1ST BUFFER 2ND WD
BTLOCC	004752'	661140	400000		TLO	C,(1B0)		;SET USE BIT
BMOVEMCMC	004753'	202147	000000		MOVEM	C,(M)		;PUT IN 1ST WD RING HEADER
BHLLCPC	004754'	500157	777776		HLL	C,-2(P)		;SET UP 2ND WD BUFFER
BMOVECC	004755'	200000	000003		MOVE	0,C		;SAVE POINTER
BNXTBUFSOSGPC	004756'	377017	000000	NXTBUF:	SOSG	(P)		;IS THIS LAST BUF TO BE SETUP?
BJRSTLASTBFC	004757'	254000	004764'		JRST	LASTBF		;YES,GO SET IT UP
BADDPC	004760'	270017	777775		ADD	0,-3(P)		;NO,CALCULATE 2ND WD NEXT BUFFER
BMOVEMCDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-47
FORSE.MAC	26-JUL-84 01:16		INBUF AND OR OUTBUF FOR DEVICE JUST INITED

BC	004761'	202003	000000		MOVEM	0,(C)		;STORE IT IN 2ND WD THIS BUFFER
BMOVECC	004762'	200140	000000		MOVE	C,0		;
BJRSTNXTBUFC	004763'	254000	004756'		JRST	NXTBUF		;FIXUP NEW BUFFER
BC
BLASTBFHRRIBC	004764'	541002	000001	LASTBF:	HRRI	0,1(B)		;SETUP POINTER TO 2ND WD 1ST BUFFER
BMOVEMCC	004765'	202003	000000		MOVEM	0,(C)		;STORE IT IN 2ND WD LAST BUUFER
BPOPPCC	004766'	262740	000003		POP	P,C		;RESTORE CHAN. #
BMOVECPC	004767'	200157	777775		MOVE	C,-3(P)		;RESTORE CHAN. #
BCLRBFZC	004770'			CLRBFZ:
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)		;DOUBLE INDEXING>
BSETZMBUFSZ.CC	004770'	402003	000253'		SETZM	BUFSZ.(C)	;CLEAR BUFFER RING DATA
BIFNREENTC				IFN REENT,<SUBI	C,(LOW)		;BACK AS IT WAS>
BPOPJPC	004771'	263740	000000		POPJ	P,		;RETURN
BC
BC				;C CONTAINS NEW JOBFF NEEDED
BC
BGETCORMOVECC	004772'	200000	000003	GETCOR:	MOVE	0,C		;SAV AC
BCALLIC	004773'	047000	000011		CALLI	0,11		;EXPAND CORE
BJRSTLESCORC	004774'	254000	004776'		JRST	LESCOR		;FAILED
BJRSTGOTCORC	004775'	254000	004746'		JRST	GOTCOR		;PASSED
BC
BLESCORJUMPLENOCOREC	004776'	323000	005005'	LESCOR:	JUMPLE	0,NOCORE	;FAIL IF NO CORE AVAILABLE
BMOVECPC	004777'	200157	000000		MOVE	C,(P)		;GET # BUFFERS DESIRED
BSOJLECNOCOREC	005000'	363140	005005'		SOJLE	C,NOCORE	;TRIED ONE AND FAILED - TOTAL FAILURE
BCAIECC	005001'	302140	000001		CAIE	C,1		;IF =1,LEAVE IT ALONE
BMOVEICC	005002'	201140	000002		MOVEI	C,2		;IF>=2,MAKE IT 2
BMOVEMCPC	005003'	202157	000000		MOVEM	C,(P)		;SAVE NUM BUFFERS
BJRSTTRYAGNC	005004'	254000	004742'		JRST	TRYAGN		;TRYAGAIN
BC
BNOCOREERRORBUFER.C	005005'	260740	000000*	NOCORE:	ERROR	BUFER.		;FATAL ERROR MESSAGE
BC
BSUBTTLC				SUBTTL	SUBROUTINE TO LOOK AT DEVCHR BITS
BC				;IN E AND SET APPROPRIATE FLAGS
BC				;ARGS	E=LH DEVCHR BITS
BC				;VALUES	D=ADDRESS OF DYNDV. TABLE
BC				;	SEVERAL FLAGS SET
BC
BFIDLDVTLNEEDIRBITC	005006'	603240	000004	FIDLDV:	TLNE	E,DIRBIT	;DECTAPE OR DISK?
BTLOIDDF.C	005007'	661440	000040		TLO	I,DDF.		;YES
BTLNEELPTBITTTYBITC	005010'	603240	040010		TLNE	E,LPTBIT!TTYBIT	;LPT OR TTY?
BTLONTTYFL.C	005011'	661700	000001		TLO	N,TTYFL.	;YES,SET LPT OR TTY FLAG
BTLNEETTYBITC	005012'	603240	000010		TLNE	E,TTYBIT		;TTY
BTLONTERMF.C	005013'	661700	010000		TLO	N,TERMF.
BTLNEECRDBITC	005014'	603240	100000		TLNE	E,CRDBIT	;CARDS I/O?
BTLONCDSFL.C	005015'	661700	000002		TLO	N,CDSFL.	;SET CARD READER/PUNCH FLAG
BTRNEESPLBITC	005016'	602240	100000		TRNE	E,SPLBIT	;IS DEVICE SPOOLING TO DSK?
BTLONSPLFL.C	005017'	661700	000100		TLO	N,SPLFL.	;YES
BTLNNEUSRTTYC	005020'	607240	020000		TLNN	E,USRTTY	;IS THIS THE USERS TELETYPE ?
BJRSTFIDL1C	005021'	254000	005026'		JRST	FIDL1		;NO
BMOVSIBSIXBITC	005022'	205100	646471		MOVSI	B,(SIXBIT ?TTY?);YES, MOVE TTY INTO DYNDV. TABLE
BMOVEMCTTYCH.LOWC	005023'	202140	001772'		MOVEM	C,TTYCH.(LOW)	;SAVE TTY CHAN. NUMBER
BMOVEDDVNUM.LOWC	005024'	200200	000113'		MOVE	D,DVNUM.(LOW)	;GET FORTRAN UNIT NUMBER
BIFNREENTC				IFN REENT,<ADDI	D,(LOW)>
BSETOMTTYUN.DDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-48
FORSE.MAC	26-JUL-84 01:16		SUBROUTINE TO LOOK AT DEVCHR BITS

BC	005025'	476004	001053'		SETOM	TTYUN.(D)	;SET UNIT IS TTY FLAG
BFIDL1MOVEIDDYNDV.LOWC	005026'	201200	000313'	FIDL1:	MOVEI	D,DYNDV.(LOW)	;ADDR. OF DYNAMIC DEVICE TABLE
BSKIPERANAC.LOWC	005027'	332000	001760'		SKIPE	RANAC.(LOW)	;MAKE TEST TO SEE IF MODE HAS CHANGED
BJRSTTRNNEDMPBITC					JRST	[TRNN	E,DMPBIT
BPJRSTFXMODEC						PJRST	FXMODE
BPOPJPC	005030'	254000	007172'			POPJ	P,]
BTRNNEDMPBITC	005031'	606240	040000		TRNN	E,DMPBIT	;SHOULD NOT BE ON
BPOPJPC	005032'	263740	000000		POPJ	P,
BSETOMRANAC.LOWC	005033'	476000	001760'		SETOM	RANAC.(LOW)	;SET TO RANDOM ACCESS
BPUSHPAC	005034'	261740	000001		PUSH	P,A
BMOVEADVNUM.LOWC	005035'	200040	000113'		MOVE	A,DVNUM.(LOW)	;GET F4 UNIT NUMBER
BIFNREENTC				IFN REENT,<ADDI	A,(LOW)>
BMOVEAFILE1.AC	005036'	200061	000613'		MOVE	A,@FILE1.(A)	;GET CURRENT POSITION
BMOVEMAASVAR.LOWC	005037'	202040	001764'		MOVEM	A,ASVAR.(LOW)	;MAKE THAT THE NEW POSITION
BPOPPAC	005040'	262740	000001		POP	P,A
BPOPJPC	005041'	263740	000000		POPJ	P,
BC
BGETDV.MOVEDVNUM.LOWC	005042'	200000	000113'	GETDV.:	MOVE	0,DVNUM.(LOW)	;RESTORE DEVICE LOGICAL NUMBER
BC				;       CAILE	0,DVTOT.	;LEGAL DEVICE?
BC				;	ERROR	DEVER.		;NO
BCAIGDVTOT.C	005043'	307000	000000*	        CAIG    0,DVTOT.        ;LARGER THAN DEVICE TOTAL NUM :CLC:
BJRSTC	005044'	254000	005047'	        JRST    .+3             ;NO THEN IS LEGAL DEVICE :CLC: 1-25-74
BCAIENEG1.C	005045'	302000	000000*	        CAIE    0,NEG1.         ;IS IT THE TTY DEVICE :CLC: 1-25-74
BERRORDEVER.C	005046'	260740	004203*	        ERROR   DEVER.          ;NO IT AIN'T SO PUNT :CLC: 1-25-74
BTLNEIOPF.C	005047'	603440	004000		TLNE	I,OPF.		;IF OPEN STATEMENT
BJRSTUSEOPNC	005050'	254000	005104'		JRST	USEOPN		;THEN  USE OPEN DEVICE
BSKIPGERANAC.LOWC	005051'	335000	001760'		SKIPGE	RANAC.(LOW)	;IF RANDOM ACCESS
BJRSTUSEDSKC	005052'	254000	005102'		JRST	USEDSK		;THEN ALWAYS USE DISK
BMOVNICDEVTB.C	005053'	211140	000000*		MOVNI	C,DEVTB.	;CALCULATE ADDR. OF DEVICE NAME
BADDICLOWC	005054'	271140	000001		ADDI	C,1(LOW)
BSKIPGBC	005055'	337100	000000		SKIPG	B,0		;DEVICE NO. NEGATIVE?
BIFNREENTC				IFN REENT,<JRST	[	>
BADDIBDEVND.CC	005056'	271103	000000*		ADDI	B,DEVND.(C)	;YES,GO TO END OF TABLE
BIFNREENTC				IFN REENT,<JRST	.+2]
BC					ADDI	B,(LOW)	>
BSKIPETTYUN.BC	005057'	332002	001053'		SKIPE	TTYUN.(B)	;IS THIS UNIT THE TTY
BJRSTUSETTYC	005060'	254000	005107'		JRST	USETTY		;YES
BMOVEBDEVTB.BC	005061'	200102	005053*		MOVE	B,DEVTB.(B)	;PICK UP DEVICE NAME
BCAMNBSIXBITC	005062'	316100	007175'		CAMN	B,[SIXBIT /REREAD/]
BJRSTREREADC	005063'	254000	005472'		JRST	REREAD		;SET UP TO REREAD 
BSAVDNMSKIPNEBC	005064'	336240	000002	SAVDNM:	SKIPN	E,B		;GET DEV NAME AND
BERRORILRED.C	005065'	260740	004301*		ERROR	ILRED.		;FAIL IF IT WAS RELEASED.
BTLCEC	005066'	641240	446353		TLC	E,'DSK'		;TEST FOR DSK
BTLCNEC	005067'	647240	446353		TLCN	E,'DSK'		;AS FIRST 3 CHARS.
BTLNEEC	005070'	603240	331424		TLNE	E,-1-'DSK'	;TEST FOR D OR DS
BJRSTSAVDN2C	005071'	254000	005075'		JRST	SAVDN2		;NO, USE ENTIRE ENTRY
BTRZEC	005072'	620240	007777		TRZ	E,007777	;STRIP OFF CHARS. 5 & 6
BTRNNEC	005073'	606240	400000		TRNN	E,400000	;CHAR. 4 A LETTER?
BTRZEC	005074'	620240	770000		TRZ	E,770000	;NO, STRIP IT TOO
BSAVDN2MOVEMEDEVNAMLOWC	005075'	202240	001502'	SAVDN2:	MOVEM	E,DEVNAM(LOW)	;SAVE DEVICE FOR INITIALIZATION
BDEVCHREC	005076'	047240	000004		DEVCHR	E,
BCAMEBSIXBITC	005077'	312100	007176'		CAME	B,[SIXBIT .DSK.] ;HAS DISK BEEN TRIED
BTLNEEAVABITC	005100'	603240	000040		TLNE	E,AVABIT	;IS DEVICE AVAILABLE FOR USE
BPOPJPDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-49
FORSE.MAC	26-JUL-84 01:16		SUBROUTINE TO LOOK AT DEVCHR BITS

BC	005101'	263740	000000		POPJ	P,		;YES
BUSEDSKMOVSIBSIXBITC	005102'	205100	446353	USEDSK:	MOVSI	B,(SIXBIT .DSK.) ;NO. USE DISK AS DEVICE
BJRSTUSEOTHC	005103'	254000	005105'		JRST	USEOTH
BUSEOPNMOVEBOPNDEVLOWC	005104'	200100	000114'	USEOPN:	MOVE	B,OPNDEV(LOW)	;GET DEVICE FROM OPEN STATEMENT
BUSEOTHMOVEEBC	005105'	200240	000002	USEOTH:	MOVE	E,B
BJRSTSAVDN2C	005106'	254000	005075'		JRST	SAVDN2
BUSETTYMOVSIBSIXBITC	005107'	205100	646471	USETTY:	MOVSI	B,(SIXBIT .TTY.)
BJRSTUSEOTHC	005110'	254000	005105'		JRST	USEOTH
BC
BDEVFNDMOVEBDVNUM.LOWC	005111'	200100	000113'	DEVFND:	MOVE	B,DVNUM.(LOW)
BMOVEMBFILNUMLOWC	005112'	202100	000131'		MOVEM	B,FILNUM(LOW)	;SAVE F4 DEVICE NUMBER
BSKIPGEINPDEVLOWC	005113'	335000	000110'	        SKIPGE  INPDEV(LOW)     ;TYM  MOVED UP TWO
BPUSHJPCKDVEQC	005114'	260740	005261'	        PUSHJ   P, CKDVEQ       ;TYM  MOVED UP TWO
BJUMPLIC	005115'	321440	005117'		JUMPL	I,.+2		;SKIP ON OUTPUT
BMOVEMBRERDN.LOWC	005116'	202100	001501'		MOVEM	B,RERDN.(LOW)	;SAVE DEV. # FOR REREAD
BMOVEMDEVIC.LOWC	005117'	202000	001476'		MOVEM	0,DEVIC.(LOW)	;SAVE DEVICE NAME
BC				;	SKIPGE	INPDEV(LOW)	;IS THIS AN ASCII INPUT DEVICE ?
BC				;	PUSHJ	P,CKDVEQ	;YES, SEE IF THE SAME AS LAST INPUT DEV.
BHRLZMCC	005120'	514340	000003		HRLZ	M,C		;DEVICE NUMBER
BASHMC	005121'	240340	000005		ASH	M,5		;DEVICE NO. IN AC FIELD
BPUSHJPBUFCA.C	005122'	260740	005322'		PUSHJ	P,BUFCA.	;GET HEADER ADDRESS
BHRRGDC	005123'	540640	000004		HRR	G,D		;ADDR. FOR THIS DEVICE NAME
BMOVEMGDNAMELOWC	005124'	202640	001477'		MOVEM	G,DNAME(LOW)	;SAVE DEVICE NAME ADDR
BSKIPLEINPDEVLOWC	005125'	333000	000110'		SKIPLE	INPDEV(LOW)	;IS THIS A NEW INPUT DEVICE ?
BPUSHJPSAVPTRC	005126'	260740	005273'		PUSHJ	P,SAVPTR	;YES,SAVE NEW POINTER FOR REREAD
BTLNNNTTYFL.C	005127'	607700	000001		TLNN	N,TTYFL.	;IS THE DEVICE THE TTY OR LPT ?
BPUSHJPJSBC	005130'	260740	005307'		PUSHJ	P,JSB		;NO,CHECK FOR CHANGE IN MODE
BJUMPGEIDVFC	005131'	325440	005137'		JUMPGE I,DVF		;DONT CHECK ON INPUT FOR CHANGE IN I/O
BSKIPGMC	005132'	337007	777775		SKIPG	-3(M)		;HAS AN INPUT BEEN DONE YET?
BJRSTDVFC	005133'	254000	005137'		JRST	DVF		;NO,CONTINUE
BMOVEDDC	005134'	200204	000000		MOVE	D,(D)		;
BTRNNDC	005135'	606200	000002		TRNN	D,2		;OUTPUT LAST?
BTLONRDWFL.C	005136'	661700	000020		TLO	N,RDWFL.	;SET READ TO WRITE FLAG
BDVFTLNEIFCF.C	005137'	603440	000200	DVF:	TLNE	I,FCF.		;FILE COMMAND?
BJRSTFCMC	005140'	254000	006031'		JRST	FCM		;YES
BTLNEIOPF.C	005141'	603440	004000		TLNE	I,OPF.		;OPEN STATEMENT
BJRSTOPCMC	005142'	254000	005635'		JRST	OPCM		;YES
BTLNNISTPFF.C	005143'	607440	000400		TLNN	I,STPFF.	;SPECIAL TAPE FUNCTION?
BTLNNIDDF.C	005144'	607440	000040		TLNN	I,DDF.		;DSK OR DECTAPE?
BJRSTFTST1C	005145'	254000	005202'		JRST	FTST1
BMOVEDCC	005146'	200200	000003		MOVE	D,C		;YES,GET DEV. NO.
BASHDC	005147'	240200	000001		ASH	D,1		;SET INDEX FOR FILE NAME
BJUMPGIC	005150'	327440	005152'		JUMPG	I,.+2		;SKIP ON INPUT
BADDIDC	005151'	271200	000001		ADDI	D,1		;INDEX FOR OUTPUT FILE
BIFNREENTC				IFN REENT,<ADDI	D,(LOW)>
BSKIPETNAME.DC	005152'	332004	000133'		SKIPE	TNAME.(D)	;ANY NAME THERE?
BJRSTFTST1C	005153'	254000	005202'		JRST	FTST1		;FILE NAME ALREADY SET
BPUSHPAC	005154'	261740	000001		PUSH	P,A
BSETZMTEMP.LOWC	005155'	402000	000101'		SETZM	TEMP.+4(LOW)	;CLEAR DATE, TIME AND PROTECTION
BMOVEBFILNUMLOWC	005156'	200100	000131'		MOVE	B,FILNUM(LOW)
BIFNREENTC				IFN REENT,<ADDI	B,(LOW)>
BCAILEBDYDVL.LOWC	005157'	303100	000020		CAILE	B,DYDVL.(LOW)	;INDEX TOO BIG?
BJRSTFTST5C	005160'	254000	005163'		JRST	FTST5		;YES, USE DEFAULT NAMES
BSKIPEAFILE5.BDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-50
FORSE.MAC	26-JUL-84 01:16		SUBROUTINE TO LOOK AT DEVCHR BITS

BC	005161'	332042	001013'		SKIPE	A,FILE5.(B)	;IS THERE A FILE NAME?
BJRSTSETNAMC	005162'	254000	005254'		JRST	SETNAM		;YES, GO PUT IT IN TEMP FOR LOOKUP ETC.
BFTST5LDBPOINTFILNUMLOWC	005163'	135000	007177'	FTST5:	LDB	0,[POINT 6,FILNUM(LOW),35]    ;NO, GET POSITIVE F4 DEVICE NO
BIDIVIC	005164'	231000	000012		IDIVI	0,12		;CONVERT TO 6BIT
BLSHC	005165'	242000	000006		LSH	0,6
BORC	005166'	434000	000001		OR	0,1
BIORFORZROC	005167'	434000	007052'		IOR	0,FORZRO	;SIXBIT FOR00
BLSHC	005170'	242000	000006		LSH	0,6
BMOVEMTEMP.LOWC	005171'	202000	000077'		MOVEM	0,TEMP.+2(LOW)
BMOVSIAC	005172'	205040	444164		MOVSI	A,444164	;SIXBIT 'DAT'
BMOVEMATEMP.LOWC	005173'	202040	000100'		MOVEM	A,TEMP.+3(LOW)	;SET 'DAT' UP FOR EXTENSION
BCAILEBDYDVL.LOWC	005174'	303100	000020		CAILE	B,DYDVL.(LOW)	;
BJRSTDEFALTC	005175'	254000	005200'		JRST	DEFALT
BSETPPNSKIPEAFILE3.BC	005176'	332042	000713'	SETPPN:	SKIPE	A,FILE3.(B)	;IS THERE A PPN FOR LOOKUPS OR ENTER?
BMOVEMATEMP.LOWC	005177'	202040	000076'		MOVEM	A,TEMP.+1(LOW)	;YES, SET IT UP
BDEFALTPOPPAC	005200'	262740	000001	DEFALT:	POP	P,A		;NO,FORGET IT
BPUSHJPFCM1.C	005201'	260740	006044'		PUSHJ	P,FCM1.		;DO LOOKUP OR ENTER
BFTST1TLNENRDWFL.C	005202'	603700	000020	FTST1:	TLNE	N,RDWFL.	;TRYING TO READ THEN WRITE?
BJRSTRDWRC	005203'	254000	006524'		JRST	RDWR		;YES,GO SET UP BUFFERS ETC
BFTST0JUMPGEIFTST2C	005204'	325440	005211'	FTST0:	JUMPGE	I,FTST2		;OUTPUT?
BTLNNNTTYFL.C	005205'	607700	000001		TLNN	N,TTYFL.	;AND NOT THE TERMINAL
BPUSHJPCLOSI.C	005206'	260740	006221'		PUSHJ	P,CLOSI.	;YES,DO INPUT CLOSE FOR LAST READ
BSKIPGMC	005207'	337007	000000		SKIPG	(M)		;DUMMY OUTPUT NEC. ?
BPUSHJPOUTT.C	005210'	260740	006262'		PUSHJ	P,OUTT.		;YES
BC								;IT INTO THE OUTPUT BUFFER
BFTST2TLNEINLIOF.C	005211'	603440	002000	FTST2:	TLNE	I,NLIOF.	;NAMELIST?
BJRSTNAMELC	005212'	254000	005504'		JRST	NAMEL		;YES
BTLNEISTPFF.C	005213'	603440	000400		TLNE	I,STPFF.	;SPECIAL TAPE FUNCTION?
BJRSTTPFCN.C	005214'	254000	000000*		JRST	TPFCN.		;YES,GO TO FUNCTION DISPATCH
BSKIPLRANAC.LOWC	005215'	331000	001760'		SKIPL	RANAC.(LOW)	;RANDOM FILE
BJRSTFTST3C	005216'	254000	005224'		JRST	FTST3		;NO
BMOVECFILNUMLOWC	005217'	200140	000131'		MOVE	C,FILNUM(LOW)	;F4 UNIT NUMBER
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BSOSGEASVAR.LOWC	005220'	375000	001764'		SOSGE	ASVAR.(LOW)	;CONVERT FILE POSITION TO 0-INDEXING
BERRORILLPS.C	005221'	260740	000000*		ERROR	ILLPS.		;ILLEGAL POSITION
BSKIPECFILE2.CC	005222'	332143	000653'		SKIPE	C,FILE2.(C)	;IS IT A FIXED LENGTH RECORD
BIMULMCASVAR.LOWC	005223'	222140	001764'		IMULM	C,ASVAR.(LOW)	;YES. CONVERT TO WORD OR CHAR COUNT
BFTST3TLNNIFIOF.C	005224'	607440	000100	FTST3:	TLNN	I,FIOF.		;FORMAT?
BJRSTBINWR.C	005225'	254000	006742'		JRST	BINWR.		;NO,GO TO BINARY READ & WRITE
BTLNNNTTYFL.C	005226'	607700	000001		TLNN	N,TTYFL.	;TTY OR LPT?
BJRSTFTST4C	005227'	254000	005232'		JRST	FTST4		;NOT TTY OR LPT SO USE LINE BUFFER
BTLNNNSPLFL.C	005230'	607700	000100		TLNN	N,SPLFL.	;IF SPOOLING USE LINE BUFFER
BJRSTIORETC	005231'	254000	002312'		JRST	IORET		;YES
BFTST4LDBCPOINTMC	005232'	135140	007200'	FTST4:	LDB	C,[POINT 9,@(M),17];PICK UP BUFFER WORD-SIZE
BSKIPGERANAC.LOWC	005233'	335000	001760'		SKIPGE	RANAC.(LOW)	;RANDOM ACCESS?
BMOVEICC	005234'	201140	000201		MOVEI	C,201		;DSK  BUFFER SIZE
BSUBICLINWDSC	005235'	275140	000201		SUBI	C,LINWDS+1
BJUMPLCIORETC	005236'	321140	002312'		JUMPL	C,IORET		;DON'T USE LINE BUFFER IF
BC				         			;DEVICE BUFFER SIZE TOO SMALL
BHRRZMMHDRADDLOWC	005237'	552340	000074'		HRRZM	M,HDRADD(LOW)	;ADDRESS OF REAL BUFFER HEADER
BJUMPGEIIORETC	005240'	325440	002312'		JUMPGE	I,IORET		;ON INPUT,DON'T SET UP LINE BUFFER
BPUSHJPSETOU.C	005241'	260740	006176'		PUSHJ	P,SETOU.	;SET OUTPUT BIT
BMOVEICLINBUFLOWC	005242'	201140	001515'		MOVEI	C,LINBUF-2(LOW)	;INITIALIZE LINE BUFFER HEADER
BMOVEMCLINHDRLOWDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-51
FORSE.MAC	26-JUL-84 01:16		SUBROUTINE TO LOOK AT DEVCHR BITS

BC	005243'	202140	001717'		MOVEM	C,LINHDR(LOW)
BMOVECLBPTRLOWC	005244'	200140	000002'		MOVE	C,LBPTR(LOW)	;POINTER TO LINE BUFFER
BMOVEMCLINHDRLOWC	005245'	202140	001720'		MOVEM	C,LINHDR+1(LOW)
BMOVEICLINCHC	005246'	201140	001177		MOVEI	C,LINCH		;ITEM COUNT
BMOVEMCLINHDRLOWC	005247'	202140	001721'		MOVEM	C,LINHDR+2(LOW)
BHRRIMLINHDRLOWC	005250'	541340	001717'		HRRI	M,LINHDR(LOW)	;HEADER ADDRESS
BLDBCPOINTMC	005251'	135140	007077'		LDB	C,[POINT 4,M,12]	;GET CHAN #
BIFNREENTC				IFN REENT,<ADDI C,(LOW)	>
BSETOMPAKFL.CC	005252'	476003	000233'		SETOM	PAKFL.(C)	;SET PACK FLAG ON CHANNEL
BJRSTIORETC	005253'	254000	002312'		JRST	IORET		;GO TO FORMAT SCAN
BC				;SET UP PROJ,PROG NO,  FILENAME,  EXT FOR I/O.
BC
BSETNAMMOVEMATEMP.LOWC	005254'	202040	000077'	SETNAM:	MOVEM	A,TEMP.+2(LOW)	;SET UP DESIRED FILENAME
BSKIPEAFILE4.BC	005255'	332042	000753'		SKIPE	A,FILE4.(B)	;GET EXT IF ANY & SET IT UP
BHLLZMATEMP.LOWC	005256'	512040	000100'		HLLZM	A,TEMP.+3(LOW)
BDPBAPOINTTEMP.LOWC	005257'	137040	007201'		DPB	A,[POINT 9,TEMP.+4(LOW),8]	;PROTECTION CODE
BJRSTSETPPNC	005260'	254000	005176'		JRST	SETPPN		;SET UP PPN IF ANY
BC
BC
BC				;CHECK TO SEE IF CURRENT INPUT DEVICE IS THE SAME AS LAST ONE
BCKDVEQSKIPNINPDV.LOWC	005261'	336000	000112'	CKDVEQ:	SKIPN	INPDV.(LOW)	;IS THIS THE FIRST INPUT DEV. ?
BJRSTCKDVQ1C	005262'	254000	005265'	        JRST    CKDVQ1          ;YES,THEREFORE NOT SAME DEVICE (TYM:DMQ)
BCAMNINPDV.LOWC	005263'	316000	000112'		CAMN	0,INPDV.(LOW)	;ARE THE TWO DEVICES THE SAME ?
BJRSTCKDVQ2C	005264'	254000	005270'	        JRST    CKDVQ2          ;TYM  NEED TO TEST MORE
BC				;	POPJ	P,		;YES, RETURN
BCKDVQ1MOVEMINPDV.LOWC	005265'	202000	000112'	CKDVQ1: MOVEM   0,INPDV.(LOW)   ;NO,MOVE NEW DEV. INTO HOLDING AREA
BXORMINPDEVLOWC	005266'	432000	000110'		XORM	0,INPDEV(LOW)	;SET UP FLAG TO SAY THEY ARE DIFF.
BPOPJPC	005267'	263740	000000		POPJ	P,		;RETURN
BCKDVQ2CAMNBRERDN.LOWC	005270'	316100	001501'	CKDVQ2: CAMN    B, RERDN.(LOW)  ;TYM  TEST AGAINST LAST VALUE OF
BC				                                ;TYM  REREAD F4 DEV NUMBER
BPOPJPC	005271'	263740	000000	        POPJ    P,              ;TYM  IT IS ALSO THE SAME
BJRSTCKDVQ1C	005272'	254000	005265'	        JRST    CKDVQ1          ;TYM  NOT THE SAME, ACT AS DIFF. DEV.
BC
BC				;SAVE THE CURRENT POINTER AND ITEM COUNT FOR REREAD
BC
BSAVPTRHRRZMC	005273'	550007	000000	SAVPTR:	HRRZ	0,(M)		;GET BUFFER HEADER
BMOVEMRPTR2LOWC	005274'	202000	001510'		MOVEM	0,RPTR2(LOW)	;SAVE IN RPTR2
BMOVEMC	005275'	200007	000001		MOVE	0,1(M)		;GET POINTER
BSUBMRPTR2LOWC	005276'	276000	001510'		SUBM	0,RPTR2(LOW)	;ADJUST RPTR2
BMOVEMC	005277'	200007	000002		MOVE	0,2(M)		;GET ITEM COUNT
BMOVEMRCNT2LOWC	005300'	202000	001512'		MOVEM	0,RCNT2(LOW)	;SAVE IN RCNT2
BPUSHPCC	005301'	261740	000003		PUSH	P,C
BLDBCPOINTMC	005302'	135140	007077'		LDB	C,[POINT 4,M,12]	;CHANNEL NUMBER
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BMOVEINCNT.CC	005303'	200003	000273'		MOVE	0,INCNT.(C)	;BLOCK NUMBER
BMOVEMRINC2LOWC	005304'	202000	001514'		MOVEM	0,RINC2(LOW)
BPOPPCC	005305'	262740	000003		POP	P,C
BPOPJPC	005306'	263740	000000		POPJ	P,		;RETURN
BC				;RESET STATUS FOR CURRENT DEVICE
BC
BJSBTLNNIFIOF.C	005307'	607440	000100	JSB:	TLNN	I,FIOF.		;IS THE MODE ASCII ?
BPOPJPC	005310'	263740	000000		POPJ	P,		;NO, RETURN
BLDBPOINTMC	005311'	135000	007202'		LDB	0,[POINT 6,1(M),11];YES, GET POINTER SIZE
BCAIEDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-52
FORSE.MAC	26-JUL-84 01:16		SUBROUTINE TO LOOK AT DEVCHR BITS

BC	005312'	302000	000044		CAIE	0,44		;IS THE POINTER BINARY ?
BPOPJPC	005313'	263740	000000		POPJ	P,		;NO,RETURN
BMOVEIC	005314'	201000	000700		MOVEI	0,0700		;YES,SET UP ASCII POINTER
BHRLMMC	005315'	506007	000001		HRLM	0,1(M)		;PUT NEW POINTER INTO BUFFER HEADER
BMOVEMC	005316'	200007	000002		MOVE 	0,2(M)		;ADJUST WORD COUNT
BIMULIC	005317'	221000	000005		IMULI	0,5		;FOR ASCII MODE
BMOVEMMC	005320'	202007	000002		MOVEM	0,2(M)		;REPLACE WITH NEW COUNT
BPOPJPC	005321'	263740	000000		POPJ	P,		;RETURN WITH MODE CHANGED
BC
BC				;SET BUFFER HEADER ADDRESS FOR CURRENT DEVICE
BC
BBUFCA.LDBPOINTMC	005322'	135000	007077'	BUFCA.:	LDB	0,[POINT 4,M,12];DEVICE NUMBER
BIMULIC	005323'	221000	000006		IMULI	0,6		;SIX WORDS FOR EACH DEVICE
BADDIBUFHD.LOWC	005324'	271000	001336'		ADDI	0,BUFHD.(LOW)	;BASE ADDRESS
BHRLSC	005325'	507000	000000		HRLS	0		;IN BOTH HALVES
BHLLGC	005326'	500640	000000		HLL	G,0		;ADDRESS OF INPUT BUFFER HEADER
BSKIPLRANAC.LOWC	005327'	331000	001760'		SKIPL	RANAC.(LOW)	;ONLY ONE BUFFER IF RANDOM ACCESS
BADDXWDC	005330'	270000	007150'		ADD	0,[XWD 3,0]	;OUTPUT ADDR.,INPUT ADDR.
BHLRMC	005331'	544340	000000		HLR	M,0		;HEADER ADDRESS
BJUMPLICPOPJC	005332'	321440	003335'		JUMPL	I,CPOPJ		;SKIP ON OUTPUT
BHRRMC	005333'	540340	000000		HRR	M,0		;HEADER ADDRESS
BPOPJPC	005334'	263740	000000		POPJ	P,
BC
BC				;HERE TO SET UP DUMP MODE BUFFER FOR RANDOM ACCESS
BC
BSNGLBFPUSHPBC	005335'	261740	000002	SNGLBF:	PUSH	P,B		;SAVE FOR FNDSPC
BPUSHJPFNDSPCC	005336'	260740	006667'		PUSHJ	P,FNDSPC	;CAN ANY SPACE BE REUSED
BJRSTC	005337'	254000	005341'		JRST	.+2		;NO. ALLOCATE NEW SPACE
BJRSTSNGLB1C	005340'	254000	005350'		JRST	SNGLB1		;LOCATION OF BUFFER REUSED
BHRRZ.JBFFC	005341'	550000	004746*		HRRZ	0,.JBFF		;TOP OF FREE CORE
BADDIC	005342'	271000	000202		ADDI	0,202		;BUFFER SPACE
BCAMLE.JBRELC	005343'	313000	004744*		CAMLE	0,.JBREL	;WILL IT FIT
BPUSHJPXPANDC	005344'	260740	005365'		PUSHJ	P,XPAND		;NO
BADDIC	005345'	271000	000001		ADDI	0,1		;POINT TO FIRST FREE WORD
BEXCH.JBFFC	005346'	250000	005341*		EXCH	0,.JBFF		;ALLOCATE SPACE
BMOVEBC	005347'	200100	000000		MOVE	B,0		;MOVE BUFFER ADDRESS START
BSNGLB1ADDIBC	005350'	271100	000001	SNGLB1:	ADDI	B,1		;POINT TO SECOND WORD OF BUFFER
BHRRZMBMC	005351'	552107	000000		HRRZM	B,(M)		;STORE BUFFER POINTER
BHRLIBC	005352'	505100	000201		HRLI	B,201		;SET UP BUFFER SIZE FOR ANYONE WHO NEEDS IT
BMOVEMBBC	005353'	202102	000000		MOVEM	B,(B)		;MAKE BUFFER POINT TO SELF
BSETZMBC	005354'	402002	777777		SETZM	-1(B)		;ZERO STATUS WORD
BADDIBC	005355'	271100	000001		ADDI	B,1		;POINT TO WORD BEFORE DATA
BMOVSIBPOINTC	005356'	205100	000700		MOVSI	B,(POINT 7,,35)	;ASSUME ASCII
BTRNEIC	005357'	602440	000017		TRNE	I,17		;WAS IT
BMOVSIBPOINTC	005360'	205100	004400		MOVSI	B,(POINT 36,,35)	;NO, BINARY
BMOVEMBMC	005361'	202107	000001		MOVEM	B,1(M)		;STORE BYTE POINTER
BSETZMMC	005362'	402007	000002		SETZM	2(M)		;CLEAR WORD COUNT
BPOPPBC	005363'	262740	000002	        POP	P,B		;RESTORE REGISTER
BPOPJPC	005364'	263740	000000		POPJ	P,		;RETURN
BC
BC				;HERE TO EXPAND CORE
BC
BXPANDPUSHPAC	005365'	261740	000001	XPAND:	PUSH	P,A		;SAVE AN AC
BMOVEADFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-53
FORSE.MAC	26-JUL-84 01:16		SUBROUTINE TO LOOK AT DEVCHR BITS

BC	005366'	200040	000000		MOVE	A,0		;CORE NEEDED
BCOREAC	005367'	047040	000011		CORE	A,		;TRY
BERRORBUFER.C	005370'	260740	005005*		ERROR	BUFER.		;FAILED, PRINT MESSAGE
BPOPPAC	005371'	262740	000001		POP	P,A
BPOPJPC	005372'	263740	000000		POPJ	P,
BC
BC				;HERE TO CHANGE MODE FOR RANDOM ACCESS/SEQUENTIAL CHANGE
BC
BFXMODETLNEISTPFF.C	005373'	603440	000400	FXMODE:	TLNE	I,STPFF.	;AN MTOP. UUO?
BPOPJPC	005374'	263740	000000		POPJ	P,		;YES, RANAC IS NEVER SETUP
BHRLZMCC	005375'	514340	000003		HRLZ	M,C		;DEVICE NUMBER
BASHMC	005376'	240340	000005		ASH	M,5		;PUT IN ACC FIELD
BPUSHJPBUFCA.C	005377'	260740	005322'		PUSHJ	P,BUFCA.	;GET BUFFER HEADER INTO M (RH)
BMOVEGC	005400'	200000	000015		MOVE	0,G		; *356* BUFFER HEADER
BHRRCC	005401'	540000	000003		HRR	0,C		; *356* DEVICE NUMBER
BADDIDYNDV.LOWC	005402'	271000	000313'		ADDI	0,DYNDV.(LOW)	; *356* DEVICE TABLE PLUS OFFSET
BMOVEMDNAMELOWC	005403'	202000	001477'		MOVEM	0,DNAME(LOW)	; *356* SET UP DNAME (EXPECTED LATER)
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BSKIPNRANAC.LOWC	005404'	336000	001760'		SKIPN	RANAC.(LOW)	;DO WE WANT DUMP MODE NOW?
BJRSTFX2ASCC	005405'	254000	005431'		JRST	FX2ASC		;NO
BPUSHJPCLOS.C	005406'	260740	006231'		PUSHJ	P,CLOS.		;OUTPUT LAST BLOCK IF NEED BE
BHLRMGC	005407'	544340	000015		HLR	M,G		;PUT INPUT BUFFER IN M
BPUSHPAC	005410'	261740	000001		PUSH	P,A		;SAVE SOME ACCS
BPUSHPBC	005411'	261740	000002		PUSH	P,B
BPUSHPDC	005412'	261740	000004		PUSH	P,D
BPUSHJPLNKBUFC	005413'	260740	004565'		PUSHJ	P,LNKBUF	;LINK THE BUFFERS
BPOPPDC	005414'	262740	000004		POP	P,D
BPOPPBC	005415'	262740	000002		POP	P,B
BPOPPAC	005416'	262740	000001		POP	P,A
BHLLZMC	005417'	510000	000007		HLLZ	0,M		;GET CHAN. #
BHRRIC	005420'	541000	000016		HRRI	0,16		;DUMP MODE
BTLONSETSTC	005421'	661000	060000		TLO	0,NSETST	;FORM UUO
BXCTC	005422'	256000	000000		XCT	0		;DO IT
BMOVEC	005423'	200000	007152'		MOVE	0,[1,,203]
BMOVEMBUFSZ.CC	005424'	202003	000253'	        MOVEM	0,BUFSZ.(C)	;SIGNAL NO BUFFERS
BPUSHJPSNGLBFC	005425'	260740	005335'		PUSHJ	P,SNGLBF	;GET A DUMP MODE BUFFER
BJRSTFXDRETC	005426'	254000	005444'		JRST	FXDRET		;RETURN
BC
BJUMPGEIC	005427'	325440	005431'		JUMPGE	I,.+2		;SKIP IF INPUT
BSUBIMC	005430'	275340	000003		SUBI	M,3		;USE INPUT HEADER FOR OUTPUT
BFX2ASCSETZMBLOCK.LOWC	005431'	402000	001761'	FX2ASC:	SETZM	BLOCK.(LOW)	;CLEAR WANTED BLOCK. #
BSKIPGERANDV.CC	005432'	335003	000353'		SKIPGE	RANDV.(C)	;ANYTHING TO GO OUT?
BPUSHJPROUTP.C	005433'	260740	006340'		PUSHJ	P,ROUTP.	;YES, DUMP LAST BLOCK
BHLLZMC	005434'	510000	000007		HLLZ	0,M		;GET CHAN. #
BTLONSETSTC	005435'	661000	060000		TLO	0,NSETST	;SETSTS UUO 
BXCTC	005436'	256000	000000		XCT	0		;CHANGE MODE TO ASCII
BPUSHJPLNKBUFC	005437'	260740	004565'		PUSHJ	P,LNKBUF	;RELEASE BUFFERS
BMOVEIINIT.LOWC	005440'	201000	001727'		MOVEI	0,INIT.(LOW)	;DEVICE NAME
BDEVSIZC	005441'	047000	000101		DEVSIZ	0,		;GET BUFFER SIZE
BSETOC	005442'	474000	000000		  SETO	0,		;FAILED
BMOVEMBUFSZ.CC	005443'	202003	000253'		MOVEM	0,BUFSZ.(C)	;STORE INFO.
BFXDRETSETZMRANDV.CC	005444'	402003	000353'	FXDRET:	SETZM	RANDV.(C)	;CLEAR INCORE BLOCK
BMOVEEDYNCH.CC	005445'	200243	000333'		MOVE	E,DYNCH.(C)	;GET DEVCHR WORD
BTRCEDMPBITDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-54
FORSE.MAC	26-JUL-84 01:16		SUBROUTINE TO LOOK AT DEVCHR BITS

BC	005446'	640240	040000		TRC	E,DMPBIT	;PUT BIT RIGHT WAY 
BMOVEMEDYNCH.CC	005447'	202243	000333'		MOVEM	E,DYNCH.(C)	;IN TABLE
BIFNREENTC				IFN REENT,<SUBI	C,(LOW)>
BJUMPGEICPOPJC	005450'	325440	003335'		JUMPGE	I,CPOPJ		;INPUT?
BSKIPNRANAC.LOWC	005451'	336000	001760'		SKIPN	RANAC.(LOW)	;SAME BUFFER IF RANDOM ACCESS
BADDIMC	005452'	271340	000003		ADDI	M,3		;NO
BPOPJPC	005453'	263740	000000		POPJ	P,		;RETURN
BC
BSUBTTLC				SUBTTL	INF. AND OUT. UUOS
BC
BOUTFMOVSIIIOF.FCF.C	005454'	205440	400200	OUTF:	MOVSI	I,IOF.!FCF.	;OUTPUT,FILE COMMAND,ASCII
BJRSTINFC	005455'	254000	005457'		JRST	INF+1		;GET NAME AND DO INIT
BC
BINFMOVSIIFCF.C	005456'	205440	000200	INF:	MOVSI	I,FCF.		;FILE COMMAND,ASCII
BMOVESAVEACLOWC	005457'	200000	000031'		MOVE	0,SAVEAC(LOW)	;**V31/01**
BHRRZMFNM.LOWC	005460'	552000	000115'		HRRZM	0,FNM.(LOW)	;SAVE FILE NAME ADDRESS
BLDBPOINTC	005461'	135000	007203'		LDB	0,[POINT 4,0,12]	;GET TYPE CODE
BMOVEIBC	005462'	201100	777777		MOVEI	B,777777	;ASSUME HOLLERITH
BCAIGEC	005463'	305000	000005		CAIGE	0,5		;IS IT ONE WORD LONG
BMOVEIBC	005464'	201100	000005		MOVEI	B,1*5		;YES
BCAILEC	005465'	303000	000005		CAILE	0,5		;IS IT TWO WORDS LONG
BMOVEIBC	005466'	201100	000012		MOVEI	B,2*5		;YES
BMOVEMBFNMCNTLOWC	005467'	202100	000116'		MOVEM	B,FNMCNT(LOW)	;SAVE MAXIMUM FILE NAME SIZE
BPUSHJPFLNAMC	005470'	260740	005710'		PUSHJ	P,FLNAM		;**V31/01**
BJRSTNFIC	005471'	254000	004154'		JRST	NFI		;**V31/01**
BC
BSUBTTLC				SUBTTL	REREAD UUO--FORMAT SIMILAR TO READ
BC
BREREADTLOIRRF.C	005472'	661440	000010	REREAD:	TLO	I,RRF.		;REREAD , ASCII
BTLONRRDFL.C	005473'	661700	000010		TLO	N,RRDFL.	;SET REREAD USE FLAG ON
BMOVEBRERDN.LOWC	005474'	200100	001501'		MOVE	B,RERDN.(LOW)	;PICK UP LAST INPUT DEVICE NUMBER
BMOVEMBDVNUM.LOWC	005475'	202100	000113'		MOVEM	B,DVNUM.(LOW)	;MAKE IT THIS DEVICE NUMBER
BMOVEBRERDV.LOWC	005476'	200100	001500'		MOVE	B,RERDV.(LOW)	;PICK UP LAST INPUT DEVICE NAME
BJRSTSAVDNMC	005477'	254000	005064'		JRST	SAVDNM		;RETURN
BC
BSUBTTLC				SUBTTL	NAMELIST (NLIN.,NLOUT.) UUO'S
BC
BNLIMOVSIINLIOF.C	005500'	205440	002000	NLI:	MOVSI	I,NLIOF.	;NAMELIST
BJRSTNFIC	005501'	254000	004154'		JRST	NFI		;INITIALIZE DEVICE
BC
BNLOMOVSIIIOF.NLIOF.C	005502'	205440	402000	NLO:	MOVSI	I,IOF.!NLIOF.	;OUTPUT,NAMELIST,ASCII
BJRSTNFIC	005503'	254000	004154'		JRST	NFI
BC
BC				;NAMELIST SET UP
BC
BNAMELLDBAPTRUC	005504'	135040	007051'	NAMEL:	LDB	A,PTRU		;AC FIELD OF NAMELIST UUO
BIFNREENTC				IFN REENT,<ADDI	A,(LOW)>
BMOVEIASAVEACAC	005505'	201061	000031'		MOVEI	A,@SAVEAC(A)	;POINTER TO NAMELIST TABLE
BPUSHJPNMLST.C	005506'	260740	000000*		PUSHJ	P,NMLST.	;GO OFF TO NAMELIST ROUTINE
BJRSTIORTR.C	005507'	254000	002467'		JRST	IORTR.		;RETURN TO USER
BC
BSUBTTLC				SUBTTL	BINARY TAPE READ(RTB) / WRITE(WTB)  UUO
BC				;DEVICE NO. IN RIGHT HALF OF UUO
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-55
FORSE.MAC	26-JUL-84 01:16		BINARY TAPE READ(RTB) / WRITE(WTB)  UUO

BC
BC
BWTBSKIPAIXWDIOF.C	005510'	334440	007204'	WTB:	SKIPA	I,[XWD IOF.,14]	;OUTPUT BINARY
BRTBMOVEIIC	005511'	201440	000014	RTB:	MOVEI	I,14		;INPUT BINARY
BSKIPLRANAC.LOWC	005512'	331000	001760'		SKIPL	RANAC.(LOW)	;RANDOM ACCESS?
BJRSTNFIC	005513'	254000	004154'		JRST	NFI		;NO, SEQUENTIAL I/O
BMOVERECNO.LOWC	005514'	200000	001757'		MOVE	0,RECNO.(LOW)	;YES SET UP ASSOCIATED VARIABLE
BMOVEMASVAR.LOWC	005515'	202000	001764'		MOVEM	0,ASVAR.(LOW)	;
BTLZNFKNFL.C	005516'	621700	000200		TLZ	N,FKNFL.	;CLEAR ASCII RANDOM ACCESS FLAG
BJRSTNFIC	005517'	254000	004154'		JRST	NFI		;DO INITIALIZATION
BC
BSUBTTLC				SUBTTL	SPECIAL TAPE FUNCTIONS
BC				;DEVICE NO. IN RIGHT HALF OF UUO
BC				;FUNCTION IN AC FIELD OF UUO
BC
BRRBBWLDBIPTRUC	005520'	135440	007051'	RRBBW:	LDB	I,PTRU		;AC FIELD OF UUO
BTROISTPFF.C	005521'	660440	000400		TRO	I,STPFF.	;SPECIAL FUNCTION
BHRLZSIC	005522'	517000	000011		HRLZS	I		;SWAP AND ZERO RH FOR ASCII
BJRSTNFIC	005523'	254000	004154'		JRST	NFI		;DO INITIALIZATION
BC
BSUBTTLC				SUBTTL	ENCODE/DECODE
BC
BC				;++ ENCODE COMES HERE
BC
BENCHRLIIIOF.FIOF.C	005524'	505440	400100	ENC:	HRLI	I,IOF.!FIOF.	;++ FORMAT, OUTPUT.
BMOVEIMENCHDRLOWC	005525'	201340	001113'		MOVEI	M,ENCHDR(LOW)	;++ SET UP ENCODE BUFFER HEADER
BPUSHJPDECENCC	005526'	260740	005536'		PUSHJ	P,DECENC	;++ SET UP HEADER WORDS
BJRSTGETACC	005527'	254000	002341'		JRST	GETAC		;++ GO TO FORMAT SCAN
BC
BC				;++ DECODE COMES HERE
BC
BDECHRLIIFIOF.C	005530'	505440	000100	DEC:	HRLI	I,FIOF.		;++ INPUT ASCII
BAOSINIFLGLOWC	005531'	350000	000072'		AOS	INIFLG(LOW)	;++ ??
BMOVEIMDECHDRLOWC	005532'	201340	001116'		MOVEI	M,DECHDR(LOW)	;++ SET UP DECODE BUFFER HDR
BPUSHJPDECENCC	005533'	260740	005536'		PUSHJ	P,DECENC	;++SET UP HEADER WORDS
BXCTIIB.C	005534'	256000	003637'		XCT	IIB.		;++ MOVE POINTER UP ONE
BJRSTGETACC	005535'	254000	002341'		JRST	GETAC		;++ GO TO FORMAT SCAN
BC
BDECENCTLONENCFL.C	005536'	661700	000040	DECENC:	TLO	N,ENCFL.	;++ SET ENCODE/DECODE FLAG
BHRRZMAMC	005537'	552047	000002		HRRZM	A,2(M)		;++ GET # CHARS PUT IN HDR
BHRLIC	005540'	505000	000700		HRLI	0,700		;++ SET UP HEADER
BHRRVADDR.LOWC	005541'	540000	000106'		HRR	0,VADDR.(LOW)	;++ GET ADR OF 1ST WORD
BMOVEMMC	005542'	202007	000001		MOVEM	0,1(M)		;++ SET UP BYTE PTR
BSOSMC	005543'	370007	000001		SOS	1(M)		;++POINT TO WORD BEFORE DATA FOR ENC.
BPOPJPC	005544'	263740	000000		POPJ	P,		;++ RETURN
BC
BEDMESSASCIZC	005545'			EDMESS:	ASCIZ /
BC	005545'	064250	547206	ENCODE - DECODE ERROR!
	005546'	476110	520132
	005547'	202110	541636
	005550'	422124	042644
	005551'	512372	220432
BC	005552'	050000	000000	/
BEDERRMTTCALLEDMESSDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-56
FORSE.MAC	26-JUL-84 01:16		ENCODE/DECODE

BC	005553'	051140	005545'	EDERRM:	TTCALL	3,EDMESS	;++ TYPE OUT ERROR MESSAGE
BSETZMEDERRLOWC	005554'	402000	000105'		SETZM	EDERR(LOW)	;++ CLEAR ERROR FLAG
BJRSTEDFINC	005555'	254000	003770'		JRST	EDFIN		;++ GO TO FIN UUO DIRECTLY SKIPPING OTHERS
BC
BC
BC
BSUBTTLC				SUBTTL	POSITION STATEMENT
BC
BPOSSMOVSIIPOSS.C	005556'	205440	100000	POSS:	MOVSI	I,POSS.		;SET POSITION STATEMENT FLAG
BSETOMRANAC.LOWC	005557'	476000	001760'		SETOM	RANAC.(LOW)	;IS A RANDOM FILE OPERATION
BLDBPTRUC	005560'	135000	007051'		LDB	0,PTRU		;GET ACC FIELD OF UUO
BADDISAVEACLOWC	005561'	271000	000031'		ADDI	0,SAVEAC(LOW)	;ADDRESS IN AC SAVE BLOCK
BMOVEC	005562'	200020	000000		MOVE	0,@0		;GET NEW POSITION
BMOVEMASVAR.LOWC	005563'	202000	001764'		MOVEM	0,ASVAR.(LOW)	;NEW FILE POSITION
BJRSTNFIC	005564'	254000	004154'		JRST	NFI		;GO GET CHANNEL AND POSITION
BC
BSUBTTLC				SUBTTL	OPEN STATEMENT
BC
BFNMHRRZBAC	005565'	550100	000001	FNM:	HRRZ	B,A		;GET ADDRESS OF UUO
BCAIGEBC	005566'	305100	000020		CAIGE	B,20		;IS FILE NAME IN REGISTER
BADDIBSAVEACLOWC	005567'	271100	000031'		ADDI	B,SAVEAC(LOW)	;YES. REFERENCE REGISTER SAVE BLOCK
BMOVEMBFNM.LOWC	005570'	202100	000115'		MOVEM	B,FNM.(LOW)	;SAVE ADDRESS OF FILE NAME
BLDBBPTRUC	005571'	135100	007051'		LDB	B,PTRU		;GET VARIABLE TYPE CODE
BMOVEICC	005572'	201140	777777		MOVEI	C,777777	;ASSUME HOLLERITH. INFINITE COUNT
BCAIGEBC	005573'	305100	000005		CAIGE	B,5		;IS IT A ONE WORD FILE NAME
BMOVEICC	005574'	201140	000005		MOVEI	C,1*5		;YES. FIVE CHARACTERS
BCAILEBC	005575'	303100	000005		CAILE	B,5		;IS IT A TWO WORD FILE NAME
BMOVEICC	005576'	201140	000012		MOVEI	C,2*5		;YES. TEN CHARACTERS
BMOVEMCFNMCNTLOWC	005577'	202140	000116'		MOVEM	C,FNMCNT(LOW)	;SAVE COUNT FOR FILE NAME SCAN
BJRSTFI.C	005600'	254000	003506'		JRST	FI.		;RETURN TO PROGRAM
BC
BFLISTHRRZBAC	005601'	550100	000001	FLIST:	HRRZ	B,A		;ADDRESS OF START OF FILE NAME
BMOVEMBFNM.LOWC	005602'	202100	000115'		MOVEM	B,FNM.(LOW)	;SAVE FOR SCAN OF FILE NAME
BHRRZBUUOH.LOWC	005603'	550120	002076'		HRRZ	B,@UUOH.(LOW)	;ARRAY LENGTH
BAOSUUOH.LOWC	005604'	350020	002076'		AOS	@UUOH.(LOW)	;SKIP ON EXIT OVER ARRAY LENGTH
BLDBCPTRUC	005605'	135140	007051'		LDB	C,PTRU		;GET VARIABLE TYPE
BCAILCC	005606'	301140	000006		CAIL	C,6		;TWO WORD ENTRIES
BASHBC	005607'	240100	000001		ASH	B,1		;YES. DOUBLE ARRAY LENGTH
BIMULIBC	005610'	221100	000005		IMULI	B,5		;COMPUTE NUMBER OF CHARACTERS
BMOVEMBFNMCNTLOWC	005611'	202100	000116'		MOVEM	B,FNMCNT(LOW)	;SAVE FOR SCAN
BJRSTFI.C	005612'	254000	003506'		JRST	FI.		;RETURN TO PROGRAM
BC
BOPENFLDBPTRUC	005613'	135000	007051'	OPENF:	LDB	0,PTRU		;GET AC FIELD
BADDISAVEACLOWC	005614'	271000	000031'		ADDI	0,SAVEAC(LOW)
BMOVEC	005615'	200020	000000		MOVE	0,@0		;GET REGISTER ZERO
BMOVSIIFIOF.C	005616'	205440	000100		MOVSI	I,FIOF.		;ASSUME SYMBOLIC FILE
BTRNEC	005617'	602000	000001		TRNE	0,1		;IS IT SYMBOLIC
BMOVEIIC	005620'	201440	000014		MOVEI	I,14		;NO. BINARY
BTLNEC	005621'	603000	000005		TLNE	0,5		;OUTPUT FILE
BTLOIIOF.C	005622'	661440	400000		TLO	I,IOF.		;YES
BTLNEC	005623'	603000	000006		TLNE	0,6		;RANDOM FILE
BC				;*** PART OF I/O CONSISTENCY CHECKING PATCH *** [TJB 3-4-82]
BHLRZMRANAC.LOWC	005624'	556000	001760'		HLRZM	0,RANAC.(LOW)	;YES: SAVE FILE TYPE (RESET BY SETRW)
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-57
FORSE.MAC	26-JUL-84 01:16		OPEN STATEMENT

BC				;*** END PATCH
BTLOIOPF.C	005625'	661440	004000		TLO	I,OPF.		;SET OPEN STATEMENT FLAG
BSETZMTEMP.LOWC	005626'	402000	000076'		SETZM	TEMP.+1(LOW)	;ASSUME NO USER NAME
BMOVSISIXBITC	005627'	205000	446353		MOVSI	0,(SIXBIT .DSK.)	;ASSUME DEVICE IS DISK
BMOVEMOPNDEVLOWC	005630'	202000	000114'		MOVEM	0,OPNDEV(LOW)
BTLZIOPDV.C	005631'	621440	002000		TLZ	I,OPDV.		;ASSUME NO DEVICE IN OPEN STRING
BPUSHJPFLNAMC	005632'	260740	005710'		PUSHJ	P,FLNAM		;GET FILE NAME
BTLZIOPDV.C	005633'	621440	002000		TLZ	I,OPDV.		;CLEAR DEVICE IN OPEN STRING BIT
BJRSTNFIC	005634'	254000	004154'		JRST	NFI		;GET CHANNEL
BC
BOPCMMOVERLEN.LOWC	005635'	200000	000117'	OPCM:	MOVE	0,RLEN.(LOW)	;RECORD LENGTH
BMOVEAFILNUMLOWC	005636'	200040	000131'		MOVE	A,FILNUM(LOW)	;F4 UNIT NUMBER
BIFNREENTC				IFN REENT,<ADDI	A,(LOW)>
BMOVEMFILE2.AC	005637'	202001	000653'		MOVEM	0,FILE2.(A)	;SAVE RECORD LENGTH
BMOVEIFILPS.AC	005640'	201001	000453'		MOVEI	0,FILPS.(A)	;LOCATION OF POSITION WORD
BMOVEMFILE1.AC	005641'	202001	000613'		MOVEM	0,FILE1.(A)	;SAVE TO SAVE NEW POSITION
BMOVEIC	005642'	201000	000001		MOVEI	0,1		;START FILE AT POSITION 1
BMOVEMFILPS.AC	005643'	202001	000453'		MOVEM	0,FILPS.(A)	;STORE STARTING POSITION
BSETZMASVAR.LOWC	005644'	402000	001764'		SETZM	ASVAR.(LOW)	;INITIALIZE POSITION
BPUSHJPFCM1.C	005645'	260740	006044'		PUSHJ	P,FCM1.		;OPEN FILE
BSKIPLRANAC.LOWC	005646'	331000	001760'		SKIPL	RANAC.(LOW)	;RANDOM FILE
BJRSTIORTR.C	005647'	254000	002467'		JRST	IORTR.		;RETURN TO PROGRAM
BSKIPEATEMP.LOWC	005650'	332040	000102'		SKIPE	A,TEMP.+5(LOW)	;YES. IS FILE SIZE NONZERO
BTLNNIFIOF.C	005651'	607440	000100		TLNN	I,FIOF.		;AND IS IT A SYMBOLIC FILE
BJRSTOPCM11C	005652'	254000	005671'		JRST	OPCM11		;NO. COUNT OK
BSOJAC	005653'	360040	000000		SOJ	A,		;CONVERT COUNT TO 0-INDEX
BIDIVIAC	005654'	231040	000200		IDIVI	A,200		;DETERMINE BLOCK NUMBER
BAOJAC	005655'	340040	000000		AOJ	A,		;BLOCK # IS 1-INDEXED
BMOVEMABLOCK.LOWC	005656'	202040	001761'		MOVEM	A,BLOCK.(LOW)	;SAVE BLOCK
BPUSHJPRINP.C	005657'	260740	006306'		PUSHJ	P,RINP.		;READ LAST BLOCK OF FILE
BADDBMC	005660'	270107	000001		ADD	B,1(M)		;BYTE POINTER TO LAST WORD OF BLOCK
BMOVEATEMP.LOWC	005661'	200040	000102'		MOVE	A,TEMP.+5(LOW)	;GET WORD COUNT
BSOJAC	005662'	360040	000000		SOJ	A,		;REMOVE LAST WORD
BIMULIAC	005663'	221040	000005		IMULI	A,5		;CONVERT TO CHAR COUNT
BMOVEICC	005664'	201140	000005		MOVEI	C,5		;LOOK AT CHARS IN LAST WORD
BOPCM10ILDBBC	005665'	134000	000002	OPCM10:	ILDB	0,B		;GET NEXT CHAR
BJUMPEOPCM11C	005666'	322000	005671'		JUMPE	0,OPCM11	;TERMINATE ON NULL
BAOJAC	005667'	340040	000000		AOJ	A,		;INCREMENT CHAR COUNT
BSOJGCOPCM10C	005670'	367140	005665'		SOJG	C,OPCM10	;ONLY CHECK FIVE CHARS
BOPCM11LDBCPOINTMC	005671'	135140	007077'	OPCM11:	LDB	C,[POINT 4,M,12]	;GET CHANNEL NUMBER
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BSETZMRANDV.CC	005672'	402003	000353'		SETZM	RANDV.(C)	;CLEAR CURRENT BLOCK
BMOVEDAC	005673'	200200	000001		MOVE	D,A		;GET FILE SIZE IN ELEMENTS (WORDS OR CHARACTERS)
BMOVEIBC	005674'	201100	000200		MOVEI	B,200		;IF BINARY, 200 WORDS/BLOCK
BTLNEIFIOF.C	005675'	603440	000100		TLNE	I,FIOF.		;IS IT SYMBOLIC
BMOVEIBC	005676'	201100	001200		MOVEI	B,5*200		;YES. 5*200 CHARACTERS/BLOCK
BIDIVDBC	005677'	230200	000002		IDIV	D,B		;GET BLOCK NUMBER
BAOJDC	005700'	340200	000000		AOJ	D,		;BLOCK NUMBERS START FROM 1
BMOVEMDRLBNOCC	005701'	202203	000373'		MOVEM	D,RLBNO(C)	;SAVE BLOCK NUMBER OF LAST BLOCK
BMOVEMERLBSIZCC	005702'	202243	000413'		MOVEM	E,RLBSIZ(C)	;SAVE NUMBER OF ELEMENTS IN LAST BLOCK
BMOVECDVNUM.LOWC	005703'	200140	000113'		MOVE	C,DVNUM.(LOW)	;F4 UNIT NUMBER
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BSKIPEBFILE2.CC	005704'	332103	000653'		SKIPE	B,FILE2.(C)	;IS IT A FIXED LENGTH RECORD
BIDIVABDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-58
FORSE.MAC	26-JUL-84 01:16		OPEN STATEMENT

BC	005705'	230040	000002		IDIV	A,B		;YES. CONVERT TO # OF RECORDS
BMOVEMAFILSZ.CC	005706'	202043	000513'		MOVEM	A,FILSZ.(C)	;STORE FILE SIZE
BJRSTIORTR.C	005707'	254000	002467'		JRST	IORTR.		;RETURN TO PROGRAM
BC
BFLNAMPUSHPAC	005710'	261740	000001	FLNAM:	PUSH	P,A		;SAVE REGISTER
BMOVEBFNM.LOWC	005711'	200100	000115'		MOVE	B,FNM.(LOW)	;ADDRESS OF FILE NAME
BHRLIBPOINTC	005712'	505100	440700		HRLI	B,(POINT 7)	;POINT TO CHAR BEFORE FIRST
BPUSHJPFNMNBKC	005713'	260740	006014'		PUSHJ	P,FNMNBK	;GET FIRST NON BLANK
BJRSTOPCMEC	005714'	254000	006010'		JRST	OPCME		;ERROR. EMPTY FILE NAME
BCAIEC	005715'	302000	000010		CAIE	0,"("-40	;IS THERE A USER NAME BEFORE FILE NAME
BJRSTOPCM3C	005716'	254000	005740'		JRST	OPCM3		;NO
BTLNNIOPF.C	005717'	607440	004000		TLNN	I,OPF.		;OPEN STATEMENT
BJRSTOPCMEC	005720'	254000	006010'		JRST	OPCME		;NO. DO NOT ALLOW USER NAME
BMOVEIDUSRNAMLOWC	005721'	201200	000103'		MOVEI	D,USRNAM(LOW)	;ADDRESS OF NAME BUFFER
BMOVEMDTEMP.LOWC	005722'	202200	000076'		MOVEM	D,TEMP.+1(LOW)	;PPN POINTS TO USER NAME
BSETZMUSRNAMLOWC	005723'	402000	000103'		SETZM	USRNAM(LOW)	;SET USER NAME TO NULLS
BSETZMUSRNAMLOWC	005724'	402000	000104'		SETZM	USRNAM+1(LOW)
BHRLIDPOINTC	005725'	505200	440600		HRLI	D,(POINT 6)	;POINTER FOR SIXBIT USER NAME
BMOVEIAC	005726'	201040	000014		MOVEI	A,14		;ONLY ALLOW 12 CHARACTERS IN USER NAME
BOPCM1PUSHJPFNMCHRC	005727'	260740	006021'	OPCM1:	PUSHJ	P,FNMCHR	;GET NEXT CHAR OF USER NAME
BJRSTOPCMEC	005730'	254000	006010'		JRST	OPCME		;PREMATURE TERMINATION. ERROR
BCAINC	005731'	306000	000011		CAIN	0,")"-40	;IS IT THE END OF THE USER NAME
BJRSTOPCM2C	005732'	254000	005736'		JRST	OPCM2		;YES
BSOJLAOPCM1C	005733'	361040	005727'		SOJL	A,OPCM1		;IGNORE IF MORE THAN 12 CHARS
BIDPBDC	005734'	136000	000004		IDPB	0,D		;STORE CONVERTED CHAR
BJRSTOPCM1C	005735'	254000	005727'		JRST	OPCM1		;GET NEXT CHAR
BOPCM2PUSHJPFNMNBKC	005736'	260740	006014'	OPCM2:	PUSHJ	P,FNMNBK	;GET FIRST NONBLANK
BJRSTTLNEIOPDV.C					JRST	[TLNE I,OPDV.	;HAS DEVICE BEEN SPECIFIED
BJRSTOPCM9C						JRST OPCM9	;YES. FILE NAME NOT REQUIRED
BJRSTOPCMEC	005737'	254000	007205'			JRST OPCME]	;ERROR. EMPTY FILE NAME
BOPCM3SETZMTEMP.LOWC	005740'	402000	000077'	OPCM3:	SETZM	TEMP.+2(LOW)	;SET FILE NAME TO NULLS
BSETZMTEMP.LOWC	005741'	402000	000100'		SETZM	TEMP.+3(LOW)	;SET EXTENTION TO NULLS
BMOVEIDTEMP.LOWC	005742'	201200	000077'		MOVEI	D,TEMP.+2(LOW)	;ADDRESS OF FILE NAME WORD
BHRLIDPOINTC	005743'	505200	440600		HRLI	D,(POINT 6)	;MAKE IT A SIXBIT POINTER
BMOVEIAC	005744'	201040	000006		MOVEI	A,6		;LIMIT FILE NAME TO 6 CHARS
BOPCM4CAINC	005745'	306000	000016	OPCM4:	CAIN	0,"."-40	;IS IT THE BEGINNING OF AN EXTENSION
BJRSTOPCM5C	005746'	254000	005766'		JRST	OPCM5		;YES
BTLNEIOPF.C	005747'	603440	004000		TLNE	I,OPF.		;OPEN STATEMENT
BCAIEC	005750'	302000	000032		CAIE	0,":"-40	;DEVICE NAME
BJRSTOPCM41C	005751'	254000	005757'		JRST	OPCM41		;BOTH NOT TRUE. NO DEVICE NAME
BMOVETEMP.LOWC	005752'	200000	000077'		MOVE	0,TEMP.+2(LOW)	;GET DEVICE NAME
BJUMPEOPCMEC	005753'	322000	006010'		JUMPE	0,OPCME		;NULL DEVICE NAME
BMOVEMOPNDEVLOWC	005754'	202000	000114'		MOVEM	0,OPNDEV(LOW)	;SAVE AS OPEN DEVICE
BTLOIOPDV.C	005755'	661440	002000		TLO	I,OPDV.		;INDICATE DEVICE IN OPEN STRING
BJRSTOPCM2C	005756'	254000	005736'		JRST	OPCM2		;GET FILE NAME
BOPCM41JUMPEOPCM9C	005757'	322000	006000'	OPCM41:	JUMPE	0,OPCM9		;TERMINATE ON BLANK
BPUSHJPFNMCHKC	005760'	260740	006002'		PUSHJ	P,FNMCHK	;CHECK FOR ALLOWED CHARACTERS
BSOSLAC	005761'	371000	000001		SOSL	A		;IGNORE IF MORE THAN SIX CHARS
BIDPBDC	005762'	136000	000004		IDPB	0,D		;STORE CHAR IN FILE NAME
BPUSHJPFNMCHRC	005763'	260740	006021'		PUSHJ	P,FNMCHR	;GET NEXT CHAR OF FILE NAME
BJRSTOPCM9C	005764'	254000	006000'		JRST	OPCM9		;END OF FILE NAME
BJRSTOPCM4C	005765'	254000	005745'		JRST	OPCM4		;GO GET NEXT CHAR
BOPCM5MOVEIDTEMP.LOWC	005766'	201200	000100'	OPCM5:	MOVEI	D,TEMP.+3(LOW)	;EXTENTION WORD ADDRESS
BHRLIDPOINTDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-59
FORSE.MAC	26-JUL-84 01:16		OPEN STATEMENT

BC	005767'	505200	440600		HRLI	D,(POINT 6)	;MAKE A SIXBIT POINTER
BMOVEIAC	005770'	201040	000003		MOVEI	A,3		;LIMIT EXTENTION TO THREE CHARACTERS
BOPCM6PUSHJPFNMCHRC	005771'	260740	006021'	OPCM6:	PUSHJ	P,FNMCHR	;GET NEXT CHAR
BJRSTOPCM9C	005772'	254000	006000'		JRST	OPCM9		;END OF FILE NAME
BJUMPEOPCM9C	005773'	322000	006000'		JUMPE	0,OPCM9		;TERMINATE ON A BLANK
BSOJLAOPCM9C	005774'	361040	006000'	        SOJL    A, OPCM9        ;TYM CHECK FOR MORE THAN 3 CHARS
BC				                                ;TYM INTERCHANGED ORDER WITH 
BC				                                ;TYM .+1
BPUSHJPFNMCHKC	005775'	260740	006002'		PUSHJ	P,FNMCHK	;CHECK FOR ALLOWED CHARACTERS
BC				;	SOJL	A,OPCM9		;TERMINATE IF MORE THAN THREE CHARS
BIDPBDC	005776'	136000	000004		IDPB	0,D		;STORE CHAR OF EXTENSION
BJRSTOPCM6C	005777'	254000	005771'		JRST	OPCM6		;GO GET NEXT CHAR
BOPCM9POPPAC	006000'	262740	000001	OPCM9:	POP	P,A		;RESTORE REGISTER
BPOPJPC	006001'	263740	000000		POPJ	P,
BC
BFNMCHKCAILC	006002'	301000	000020	FNMCHK:	CAIL	0,"0"-40	;IS CHAR<"0"
BCAILEC	006003'	303000	000072		CAILE	0,"Z"-40	;OR IS CHAR>"Z"
BJRSTOPCMEC	006004'	254000	006010'		JRST	OPCME		;YES. ILLEGAL CHAR
BCAILEC	006005'	303000	000031		CAILE	0,"9"-40	;IS CHAR<="9" (HENCE A DIGIT)
BCAILC	006006'	301000	000041		CAIL	0,"A"-40	;OR IS CHAR>="A" (HENCE A LETTER)
BPOPJPC	006007'	263740	000000		POPJ	P,		;YES. LEGAL CHAR
BOPCMETLNEIOPF.C	006010'	603440	004000	OPCME:	TLNE	I,OPF.		;OPEN STATEMENT
BSKIPNERR.LOWC	006011'	336000	000121'		SKIPN	ERR.(LOW)	;ERROR SWITCH SET
BERRORILLFN.C	006012'	260740	000000*		ERROR	ILLFN.		;ILLEGAL FILE NAME
BJRSTFI.C	006013'	254000	003506'		JRST	FI.
BC
BFNMNBKPUSHJPFNMCHRC	006014'	260740	006021'	FNMNBK:	PUSHJ	P,FNMCHR	;GET NEXT FILE NAME CHAR
BPOPJPC	006015'	263740	000000		POPJ	P,		;NO MORE CHARS
BJUMPEFNMNBKC	006016'	322000	006014'		JUMPE	0,FNMNBK	;IGNORE BLANKS
BAOSPC	006017'	350017	000000		AOS	(P)		;SKIP RETURN
BPOPJPC	006020'	263740	000000		POPJ	P,
BC
BFNMCHRSOSGEFNMCNTLOWC	006021'	375000	000116'	FNMCHR:	SOSGE	FNMCNT(LOW)	;ANYMORE CHARS IN FILE NAME
BPOPJPC	006022'	263740	000000		POPJ	P,		;NO. TERMINATE FILE NAME
BILDBBC	006023'	134000	000002		ILDB	0,B		;GET NEXT CHAR
BJUMPECPOPJC	006024'	322000	003335'		JUMPE	0,CPOPJ		;TERMINATE ON NULL
BSUBIC	006025'	275000	000040		SUBI	0,40		;CONVERT TO SIXBIT
BJUMPLFNMCHRC	006026'	321000	006021'		JUMPL	0,FNMCHR		;IGNORE CONTROL CHARS
BAOSPC	006027'	350017	000000		AOS	(P)		;SKIP RETURN
BPOPJPC	006030'	263740	000000		POPJ	P,
BC
BC
BSUBTTLC				SUBTTL	DO LOOKUP AND ENTER FOR FILE NAMES ON TAPE.
BC				;DEVICE NO. IN ACZ AND FILE NAME IN TEMP
BC
BFCMPUSHJPCLOSI.C	006031'	260740	006221'	FCM:	PUSHJ	P,CLOSI.	;DO INPUT CLOSE ON DEVICE
BPUSHPDC	006032'	261740	000004		PUSH	P,D		;JUST TO BE SAFE
BLDBDPOINTMC	006033'	135200	007077'		LDB	D,[POINT 4,M,12] ;GET CHANNEL
BIFNREENTC				IFN REENT,<ADDI	D,(LOW)>
BSETZMPAKFL.DC	006034'	402004	000233'		SETZM	PAKFL.(D)	;ZERO FLAG FOR THIS CHANNEL
BPOPPDC	006035'	262740	000004		POP	P,D		;RESTORE D
BSKIPETEMP.LOWC	006036'	332000	000100'		SKIPE	TEMP.+3(LOW)
BJRSTC	006037'	254000	006042'		JRST	.+3
BMOVSISIXBITDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-60
FORSE.MAC	26-JUL-84 01:16		DO LOOKUP AND ENTER FOR FILE NAMES ON TAPE.

BC	006040'	205000	444164		MOVSI	0,(SIXBIT /DAT/)
BMOVEMTEMP.LOWC	006041'	202000	000100'		MOVEM	0,TEMP.+3(LOW)	;SET EXTENSION
BPUSHJPFCM1.C	006042'	260740	006044'		PUSHJ	P,FCM1.		;DO LOOKUP OR ENTER
BJRSTFI.C	006043'	254000	003506'		JRST	FI.		;RETURN
BC
BC
BC
BFCM1.MOVEIC	006044'	201000	000005	FCM1.:	MOVEI	0,5		;FIVE WORDS IN LOOKUP/ENTER BLOCK
BMOVEMTEMP.LOWC	006045'	202000	000075'		MOVEM	0,TEMP.(LOW)
BSKIPGERANAC.LOWC	006046'	335000	001760'		SKIPGE	RANAC.(LOW)	;RANDOM ACCESS?
BJRSTRFCMC	006047'	254000	006105'		JRST	RFCM		;YES, USE UPDATE MODE
BFCM2HLLZTEMP.LOWC	006050'	510000	000100'	FCM2:	HLLZ	0,TEMP.+3(LOW)	;GET EXTENSION
BMOVEMINIT.LOWC	006051'	202000	001730'		MOVEM	0,INIT.+1(LOW)	;SAVE FOR ERROR TYPEOUT
BMOVETEMP.LOWC	006052'	200000	000077'		MOVE	0,TEMP.+2(LOW)	;GET FILE NAME
BASHCC	006053'	240140	000001		ASH	C,1		;SET INDEX FOR LOC. OF NAME
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BJUMPLIOENTERC	006054'	321440	006067'		JUMPL	I,OENTER	;JUMP ON OUTPUT
BPUSHJPCLOS.C	006055'	260740	006231'		PUSHJ	P,CLOS.		;DO CLOSE BEFORE LOOKUP
BMOVETEMP.LOWC	006056'	200000	000077'		MOVE	0,TEMP.+2(LOW)	;INPUT,GET FILE NAME
BMOVEMTNAME.CC	006057'	202003	000133'		MOVEM	0,TNAME.(C)	;SAVE THE NAME
BMOVELOOKUPTEMP.LOWC	006060'	200000	007210'		MOVE	0,[LOOKUP 0,TEMP.(LOW)]
BIFNREENTC				IFN REENT,<SUBI	C,(LOW)>
BDPBCPOINTC	006061'	137140	007211'		DPB	C,[POINT 5,0,13];DEPOSIT CHAN. NO.
BPUSHPTEMP.LOWC	006062'	261740	000076'		PUSH	P,TEMP.+1(LOW)	;SAVE PPN
BXCTC	006063'	256000	000000		XCT	0		;DO LOOKUP
BJRSTRETRYC	006064'	254000	006126'		JRST	RETRY		;DO ANOTHER LOOKUP WITHOUT THE EXT.
BPOPPTEMP.LOWC	006065'	262740	000076'		POP	P,TEMP.+1(LOW)	;REESTORE PPN
BPOPJPC	006066'	263740	000000		POPJ	P,
BC
BOENTERMOVEMTNAME.CC	006067'	202003	000134'	OENTER:	MOVEM	0,TNAME.+1(C)	;SAVE NAME
BIFNREENTC				IFN REENT,<SUBI	C,(LOW)>
BPUSHPTEMP.LOWC	006070'	261740	000076'		PUSH	P,TEMP.+1(LOW)	;SAVE PPN
BMOVEENTERTEMP.LOWC	006071'	200000	007212'		MOVE	0,[ENTER 0,TEMP.(LOW)]
BDPBCPOINTC	006072'	137140	007211'		DPB	C,[POINT 5,0,13];   CHAN. NO.
BXCTC	006073'	256000	000000		XCT	0		;DO ENTER
BJRSTFCM3C	006074'	254000	006077'		JRST	FCM3		;DIRECTORY FULL
BPOPPTEMP.LOWC	006075'	262740	000076'		POP	P,TEMP.+1(LOW)	;RESTORE PPN
BPOPJPC	006076'	263740	000000		POPJ	P,
BC
BFCM3TLNEIOPF.C	006077'	603440	004000	FCM3:	TLNE	I,OPF.		;IS AN OPEN STATEMENT BEING EXECUTED
BSKIPNERR.LOWC	006100'	336000	000121'		SKIPN	ERR.(LOW)	;AND IS AN ERROR EXIT SET
BERRORNOROM.C	006101'	260740	000000*		ERROR	NOROM.		;NO. TAKE SYSTEM ERROR EXIT
BASHCC	006102'	240140	777777		ASH	C,-1		;RESTORE CHANNEL NUMBER
BTLONRELFL.C	006103'	661700	002000		TLO	N,RELFL.	;SET TO RELEASE CHANNEL
BJRSTOPNABTC	006104'	254000	004536'		JRST	OPNABT		;GO RELEASE CHANNEL AND RETURN TO USER
BC
BC
BC				;HERE TO ENTER UPDATE MODE
BC				;LOOKUP FOLLOWED BY ENTER
BC				;IF INPUT THEN LOOKUP MUST SUCCEDE
BC
BRFCMJUMPGEIRFCMOC	006105'	325440	006110'	RFCM:	JUMPGE	I,RFCMO		;JUST DO LOOKUP/ENTER,DON'T CREATE NEW FILE(ENTER)
BTLZIIOF.C	006106'	621440	400000		TLZ	I,IOF.		;SET INPUT FLG
BTLONFKNFL.DFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-61
FORSE.MAC	26-JUL-84 01:16		DO LOOKUP AND ENTER FOR FILE NAMES ON TAPE.

BC	006107'	661700	000200		TLO	N,FKNFL.	;FORCE LOOKUP/ENTER. CREATE NEW FILE IF LOOKUP FAILS
BRFCMOLDBPOINTTEMP.LOWC	006110'	135000	007201'	RFCMO:  LDB     0,[POINT 9,TEMP.+4(LOW),8]
BPUSHPC	006111'	261740	000000	        PUSH    P,0             ;SAVE PROTECTION
BPUSHPCC	006112'	261740	000003		PUSH	P,C		;SAV AC
BPUSHJPFCM2C	006113'	260740	006050'		PUSHJ	P,FCM2		;DO LOOKUP
BPOPPCC	006114'	262740	000003		POP	P,C		;RESTORE AC
BPOPPC	006115'	262740	000000	        POP     P,0             ;RESTORE PROTECTION
BDPBPOINTTEMP.LOWC	006116'	137000	007201'	        DPB     0,[POINT 9,TEMP.+4(LOW),8]
BTLNNNFKNFL.C	006117'	607700	000200		TLNN	N,FKNFL.	;NEED ENTER FOR OUTPUT?
BPOPJPC	006120'	263740	000000		POPJ	P,		;NO, ONLY UPDATE IF REALLY NEEDED
BTLOIIOF.C	006121'	661440	400000		TLO	I,IOF.		;SET OUTPUT FLG
BPUSHJPFCM2C	006122'	260740	006050'		PUSHJ	P,FCM2		;DO ENTER
BTLZNNFKNFL.C	006123'	627700	000200		TLZN	N,FKNFL.	;LOOKUP DONE FOR OUTPUT?
BTLZIIOF.C	006124'	621440	400000		TLZ	I,IOF.		;NO, ENTER FOR INPUT.  RESET INPUT FLAG
BPOPJPC	006125'	263740	000000		POPJ	P,		;RETURN
BC
BC				;DO ANOTHER LOOKUP ON DECTAPE OR DISC---THIS TIME WITHOUT
BC				;EXTENSION "DAT" .
BC
BRETRYTLNNNFKNFL.C	006126'	607700	000200	RETRY:	TLNN	N,FKNFL.	;IS THIS A LOOKUP FOR AN OUTPUT FILE?
BJRSTRETRY2C	006127'	254000	006137'		JRST	RETRY2		;NO, REAL LOOKUP FAILURE.
BPOPPTEMP.LOWC	006130'	262740	000076'		POP	P,TEMP.+1(LOW)	;RESTORE AC(C)
BMOVECPC	006131'	200157	777777		MOVE	C,-1(P)		;RESTORE AC C
BTLOIIOF.C	006132'	661440	400000		TLO	I,IOF.		;SET OUTPUT FLAG--FORCE ENTER.
BPUSHJPFCM2C	006133'	260740	006050'		PUSHJ	P,FCM2		;DO ENTER
BTLZIIOF.C	006134'	621440	400000		TLZ	I,IOF.		;RESET FOR INPUT
BMOVECPC	006135'	200157	777777		MOVE	C,-1(P)		;RESTORE AC C
BJRSTFCM2C	006136'	254000	006050'		JRST	FCM2		;DO CLOSE,LOOKUP/ENTER
BC
BC				;FOR REAL LOOKUP FAILURE.  NOT CREATING NEW RANDOM WRITE FILE
BC
BC				;**********FILENAME PATCH****01-MAR-72****V31/01**********************
BRETRY2TLNEIOPF.C	006137'	603440	004000	RETRY2:	TLNE	I,OPF.		;IS IT AN OPEN STATEMENT
BJRSTRETRY3C	006140'	254000	006162'		JRST	RETRY3		;DON'T TRY DAT EXTENSION
BPUSHPC	006141'	261740	000000		PUSH	P,0
BMOVSISIXBITC	006142'	205000	444164		MOVSI	0,(SIXBIT/DAT/)	;TRY LOOKUP WITH DAT EXT
BMOVEMTEMP.LOWC	006143'	202000	000100'		MOVEM	0,TEMP.+3(LOW)
BPOPPC	006144'	262740	000000		POP	P,0
BPOPPTEMP.LOWC	006145'	262740	000076'		POP	P,TEMP.+1(LOW)
BPUSHPTEMP.LOWC	006146'	261740	000076'		PUSH	P,TEMP.+1(LOW)
BXCTC	006147'	256000	000000		XCT	0
BJRSTRETRY1C	006150'	254000	006153'		JRST	RETRY1
BPOPPTEMP.LOWC	006151'	262740	000100'		POP	P,TEMP.+3(LOW)	;SUCCESS - CLEAR LIST
BPOPJPC	006152'	263740	000000		POPJ	P,
BC
BC				;*****************END OF PATCH*******************************************
BRETRY1SETZMTEMP.LOWC	006153'	402000	000100'	RETRY1:	SETZM	TEMP.+3(LOW)	;CLEAR EXTENSION
BPOPPTEMP.LOWC	006154'	262740	000076'		POP	P,TEMP.+1(LOW)	;RESTORE PPN
BPUSHPTEMP.LOWC	006155'	261740	000076'		PUSH	P,TEMP.+1(LOW)	;SAVE PPN
BXCTC	006156'	256000	000000		XCT	0		;LOOKUP 0,TEMP. IN AC 0
BERRORMSNG.C	006157'	260740	000000*		ERROR	MSNG.		;COMPLETE FAILURE
BPOPPTEMP.LOWC	006160'	262740	000076'		POP	P,TEMP.+1(LOW)	;RESTORE PPN
BPOPJPC	006161'	263740	000000		POPJ	P,		;SUCCEED
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-62
FORSE.MAC	26-JUL-84 01:16		DO LOOKUP AND ENTER FOR FILE NAMES ON TAPE.

BC
BRETRY3SKIPNERR.LOWC	006162'	336000	000121'	RETRY3:	SKIPN	ERR.(LOW)	;AND IS AN ERROR EXIT SET
BERRORMSNG.C	006163'	260740	006157*		ERROR	MSNG.		;NO. TAKE SYSTEM ERROR EXIT
BASHCC	006164'	240140	777777		ASH	C,-1		;RESTORE CHANNEL NUMBER
BTLONRELFL.C	006165'	661700	002000		TLO	N,RELFL.	;SET TO RELEASE CHANNEL
BJRSTOPNABTC	006166'	254000	004536'		JRST	OPNABT		;GO RELEASE CHANNEL AND RETURN TO USER
BC
BC				;DO SPECIAL MAG TAPE OPERATION
BC
BFNCTN.HLLZMC	006167'	510000	000007	FNCTN.:	HLLZ	0,M		;DEVICE NO.
BTLONMTAPEDC	006170'	661000	072004		TLO	0,NMTAPE+D	;MTAPE UUO
BXCTC	006171'	256000	000000		XCT	0
BC				;I/O WAIT FOR MAG TAPE
BC
BMTPZ.HLLZMC	006172'	510000	000007	MTPZ.:	HLLZ	0,M		;CHAN NO
BTLONMTAPEC	006173'	661000	072000		TLO	0,NMTAPE	;MTAPE AC,0 UUO
BXCTC	006174'	256000	000000		XCT	0
BPOPJPC	006175'	263740	000000		POPJ	P,		;RETURN
BC
BC				;SET OUTPUT LAST FLAG IN WORD CONTAINING SIXBIT DEVICE NAME
BC
BSETOU.PUSHPGC	006176'	261740	000015	SETOU.:	PUSH	P,G
BMOVEGDNAMELOWC	006177'	200640	001477'		MOVE	G,DNAME(LOW)
BMOVEIC	006200'	201000	000002		MOVEI	0,2
BIORMGC	006201'	436015	000000		IORM	0,(G)
BSETOU1POPPGC	006202'	262740	000015	SETOU1:	POP	P,G
BPOPJPC	006203'	263740	000000		POPJ	P,
BC
BC				;CLEAR OUTPUT LAST FLAG
BC
BCLROU.PUSHPGC	006204'	261740	000015	CLROU.:	PUSH	P,G
BMOVEGDNAMELOWC	006205'	200640	001477'		MOVE	G,DNAME(LOW)
BMOVEIC	006206'	201000	000002		MOVEI	0,2	
BANDCAMGC	006207'	412015	000000		ANDCAM	0,(G)
BJRSTSETOU1C	006210'	254000	006202'		JRST	SETOU1
BC
BC				;CLEAR ITEM COUNT IN INPUT BUFFER HEADER
BC				;     ITEM COUNT USED AS USER-SYSTEM SYNC FLAG
BC
BCLRSY.PUSHPGC	006211'	261740	000015	CLRSY.:	PUSH	P,G
BHLRZGDNAMELOWC	006212'	554640	001477'		HLRZ	G,DNAME(LOW)
BSETZMGC	006213'	402015	000002		SETZM	2(G)
BJRSTSETOU1C	006214'	254000	006202'		JRST	SETOU1
BC
BC				;DO STATUS CHECK FOR CURRENT DEVICE
BSTAT.HLLZMC	006215'	510000	000007	STAT.:	HLLZ	0,M		;DEVICE NO.
BIORGETSTSFC	006216'	434000	007213'		IOR	0,[GETSTS F]	;GET STATUS
BXCTC	006217'	256000	000000		XCT	0
BPOPJPC	006220'	263740	000000		POPJ	P,
BC				;DO CLOSE FOR CURRENT DEVICE
BC
BCLOSI.SKIPGERANAC.LOWC	006221'	335000	001760'	CLOSI.:	SKIPGE	0,RANAC.(LOW)	;DONT WANT TO CLOSE ON RANDOM ACCESS
BPOPJPC	006222'	263740	000000		POPJ	P,
BEXCHDDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-63
FORSE.MAC	26-JUL-84 01:16		DO LOOKUP AND ENTER FOR FILE NAMES ON TAPE.

BC	006223'	250000	000004		EXCH	0,D
BLDBDPOINTMC	006224'	135200	007077'		LDB D,[POINT 4,M,12]	;GET CHAN #
BIFNREENTC				IFN REENT,<ADDI	D,(LOW)>
BSETZMINCNT.DC	006225'	402004	000273'		SETZM	INCNT.(D)	;CLEAR "INPUT"TALLY
BEXCHDC	006226'	250000	000004		EXCH	0,D
BMOVEIC	006227'	201000	000001		MOVEI	0,1		;INHIBIT OUTPUT CLOSE
BJRSTCLOSI1C	006230'	254000	006243'		JRST	CLOSI1
BC
BCLOS.PUSHPDC	006231'	261740	000004	CLOS.:	PUSH	P,D		;GET AN ACC TO PLAY WITH
BLDBDPOINTMC	006232'	135200	007077'		LDB	D,[POINT 4,M,12]
BIFNREENTC				IFN REENT,<ADDI	D,(LOW)>
BSKIPLRANDV.DC	006233'	331004	000353'		SKIPL	RANDV.(D)	;ANY OUTPUT STILL TO DO
BJRSTCLOSO1C	006234'	254000	006237'		JRST	CLOSO1		;NO
BSETZMBLOCK.LOWC	006235'	402000	001761'		SETZM	BLOCK.(LOW)	;INHIBIT INPUT OF NEXT BLOCK
BPUSHJPROUTP.C	006236'	260740	006340'		PUSHJ	P,ROUTP.	;DUMP CURRENT BUFFERFUL
BCLOSO1SETZMRANDV.DC	006237'	402004	000353'	CLOSO1:	SETZM	RANDV.(D)	;CLEAR INCORE BLOCK
BSETZMPAKFL.DC	006240'	402004	000233'		SETZM	PAKFL.(D)	;CLEAR PACKED I/O FLAG FOR THIS CHAN.
BPOPPDC	006241'	262740	000004		POP	P,D
BSETZC	006242'	400000	000000		SETZ	0,		;CLOSE BOTH INPUT AND OUTPUT
BCLOSI1HLLMC	006243'	500000	000007	CLOSI1:	HLL	0,M		;DEVICE NO.
BTLONCLOSEC	006244'	661000	070000		TLO	0,NCLOSE	;CLOSE UUO
BXCTC	006245'	256000	000000		XCT	0
BJRSTCLRSY.C	006246'	254000	006211'		JRST	CLRSY.		;CLEAR SYNC FLAG
BC
BSUBTTLC				SUBTTL	DO INPUT FOR CURRENT DEVICE
BC
BINP.SKIPGERANAC.LOWC	006247'	335000	001760'	INP.:	SKIPGE	RANAC.(LOW)	;@@@ARE WE DOING DIRECT ACCESS?
BPJRSTNXRINPC	006250'	254000	006305'		PJRST	NXRINP		;YES, DO DUMP MODE INPUT
BHLLZMC	006251'	510000	000007		HLLZ	0,M		;DEVICE NO.
BTLONINPUTC	006252'	661000	066000		TLO	0,NINPUT	;INPUT UUO
BSKIPNMC	006253'	336007	000000		SKIPN	(M)		;BUFFERS SET UP
BPUSHJPGETSPCC	006254'	260740	006655'		PUSHJ	P,GETSPC	;NO, TRY TO RECLAIN SOME SPACE
BXCTC	006255'	256000	000000		  XCT	0
BLDBPOINTMC	006256'	135000	007077'		LDB	0,[POINT 4,M,12]	;GET CHAN#
BADDIINCNT.LOWC	006257'	271000	000273'		ADDI	0,INCNT.(LOW)	;POINT TO COUNT
BAOSC	006260'	350020	000000		AOS	@0		;TALLY UP # OF "INPUTS" DONE
BJRSTCLROU.C	006261'	254000	006204'		JRST	CLROU.		;CLEAR FLAGS.
BSUBTTLC				SUBTTL	DO OUTPUT FOR CURRENT DEVICE
BC
BOUTT.SKIPGERANAC.LOWC	006262'	335000	001760'	OUTT.:	SKIPGE	RANAC.(LOW)	;RANDOM ACCESS?
BPJRSTNXROUTC	006263'	254000	006337'		PJRST	NXROUT		;YES, DO DUMP MODE OUTPUT
BHLLZMC	006264'	510000	000007		HLLZ	0,M		;DEVICE NO.
BTLONOUTPTC	006265'	661000	067000		TLO	0,NOUTPT	;OUTPUT UUO
BSKIPNMC	006266'	336007	000000		SKIPN	(M)		;HAVE BUFFERS BEEN SET UP?
BPUSHJPGETSPCC	006267'	260740	006655'		PUSHJ	P,GETSPC	;FIND SOME SPACE FOR THEM
BXCTC	006270'	256000	000000		  XCT	0
BPUSHJPSETOU.C	006271'	260740	006176'		PUSHJ	P,SETOU.	;SET OUTPUT LAST FLAG
BJRSTCLRSY.C	006272'	254000	006211'		JRST	CLRSY.		;CLEAR USER-SYS SYNCH FLAG
BC
BC
BUSETI.C	006273'			USETI.:
BIUSETHLLZMC	006273'	510000	000007	IUSET:	HLLZ	0,M		;CHAN #
BTLONUSETIC	006274'	661000	074000		TLO	0,NUSETI	;USETI OPCODE
BJRSTUSETIODFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-64
FORSE.MAC	26-JUL-84 01:16		DO OUTPUT FOR CURRENT DEVICE

BC	006275'	254000	006300'		JRST	USETIO		;COMMON CODE
BC
BUSETO.C	006276'			USETO.:
BUSETHLLZMC	006276'	510000	000007	USET:	HLLZ	0,M		; CHAN #
BTLONUSETOC	006277'	661000	075000		TLO	0,NUSETO	;USETO UUO OPCODE
BUSETIOSKIPNBLOCK.LOWC	006300'	336000	001761'	USETIO:	SKIPN	BLOCK.(LOW)	;BLOCK 0 ?
BAOSBLOCK.LOWC	006301'	350000	001761'		AOS	BLOCK.(LOW)	;YES, DON'T ALLOW USETO TO  IT
BHRRBLOCK.LOWC	006302'	540000	001761'		HRR	0,BLOCK.(LOW)	;BLOCK WHERE RECORD STARTS
BXCTC	006303'	256000	000000		XCT	0		;
BPOPJPC	006304'	263740	000000		POPJ	P,
BC	
BSUBTTLC				SUBTTL	RANDOM ACCESS DUMP MODE INPUT/OUTPUT ROUTINES
BC
BNXRINPAOSBLOCK.LOWC	006305'	350000	001761'	NXRINP:	AOS	BLOCK.(LOW)	;GET NEXT BLOCK
BRINP.PUSHPCC	006306'	261740	000003	RINP.:	PUSH	P,C		;SAVE AN ACC
BLDBCPOINTMC	006307'	135140	007077'		LDB	C,[POINT 4,M,12]
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BSKIPLRANDV.CC	006310'	331003	000353'		SKIPL	RANDV.(C)	;DO WE NEED TO OUTPUT INCORE BLOCK
BJRSTRINP1C	006311'	254000	006315'		JRST	RINP1		;NO, JUST DO INPUT
BPUSHJPROUTPFC	006312'	260740	006351'		PUSHJ	P,ROUTPF	;YES, OUTPUT IT BEFORE NEXT INPUT
BHRRERANDV.CC	006313'	570003	000353'		HRRE	0,RANDV.(C)	;RECOVER REQUIRED BLOCK
BMOVEMBLOCK.LOWC	006314'	202000	001761'		MOVEM	0,BLOCK.(LOW)	;SET IT UP AGAIN
BRINP1PUSHJPIUSETC	006315'	260740	006273'	RINP1:	PUSHJ	P,IUSET		;SET ON REQUIRED BLOCK
BROUTP1HRREMRANDV.CC	006316'	572003	000353'	ROUTP1:	HRREM	0,RANDV.(C)	;INCORE BLOCK (SOON TO BE)
BPUSHJPRINPFC	006317'	260740	006322'		PUSHJ	P,RINPF		;DO INPUT
BPOPCPOPPCC	006320'	262740	000003	POPC:	POP	P,C		;RESTORE C
BPOPJPC	006321'	263740	000000		POPJ	P,		;RETURN
BC
BRINPFSKIPEHDRADDLOWC	006322'	332000	000074'	RINPF:	SKIPE	HDRADD(LOW)	;LINE BUFFER IN USE?
BJRSTMOVEHDRADDLOWC					JRST	[MOVE	0,@HDRADD(LOW)	;GET REAL BUFFER ADDRESS
BJRSTC	006323'	254000	007214'			JRST	.+2]		;SKIP RETURN
BHRRZMC	006324'	550007	000000		HRRZ	0,(M)		;POINT TO DATA-2
BADDIC	006325'	271000	000001		ADDI	0,1		;FORM I/O ADDRESS
BHRLIC	006326'	505000	777600		HRLI	0,-200		;ALWAYS WRITE A FULL BLOCK
BMOVEMDMPIO.LOWC	006327'	202000	000000'		MOVEM	0,DMPIO.(LOW)	;STORE ADDRESS IN IOWD
BHLLMC	006330'	500000	000007		HLL	0,M		;CHAN. #
BHRRIDMPIO.LOWC	006331'	541000	000000'		HRRI	0,DMPIO.(LOW)	;POINT TO I/O LIST
BTLONINPUTC	006332'	661000	066000		TLO	0,NINPUT	;SET UP UUO
BXCTC	006333'	256000	000000		XCT	0		;DUMP MODE INPUT
BPUSHJPCHKSTSC	006334'	260740	006416'		PUSHJ	P,CHKSTS	;CHECK STATUS
BSETZMRANBMCC	006335'	402003	000433'		SETZM	RANBM(C)	;BUFFER IS AN INPUT BUFFER
BPJRSTFIXBFC	006336'	254000	006500'		PJRST	FIXBF		;FIXUP BUFFER HEADERS
BC
BNXROUTAOSBLOCK.LOWC	006337'	350000	001761'	NXROUT:	AOS	BLOCK.(LOW)	;GET NEXT BLOCK
BROUTP.PUSHPCC	006340'	261740	000003	ROUTP.:	PUSH	P,C		;SAVE AN AC
BLDBCPOINTMC	006341'	135140	007077'		LDB	C,[POINT 4,M,12]
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BPUSHJPROUTPFC	006342'	260740	006351'		PUSHJ	P,ROUTPF	;OUTPUT BLOCK
BSKIPNRANDV.CC	006343'	336003	000353'		SKIPN	RANDV.(C)	;IS REQUIRED BLOCK = 0?
BPJRSTPOPCC	006344'	254000	006320'		PJRST	POPC		;YES, MEANS DON'T DO INPUT (CLOSE ONLY)
BPUSHJPIUSETC	006345'	260740	006273'		PUSHJ	P,IUSET		;SET ON NEXT BLOCK
BHRRERANDV.CC	006346'	570003	000353'		HRRE	0,RANDV.(C)	;GET SAVED BLOCK NUMBER
BEXCHBLOCK.LOWC	006347'	250000	001761'		EXCH	0,BLOCK.(LOW)	;RESTORE BLOCK NUMBER
BJRSTROUTP1DFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-65
FORSE.MAC	26-JUL-84 01:16		RANDOM ACCESS DUMP MODE INPUT/OUTPUT ROUTINES

BC	006350'	254000	006316'		JRST	ROUTP1		;DO INPUT OF REQUIRED BLOCK
BC
BROUTPFHRRERANDV.CC	006351'	570003	000353'	ROUTPF:	HRRE	0,RANDV.(C)	;GET INCORE BLOCK #
BEXCHBLOCK.LOWC	006352'	250000	001761'		EXCH	0,BLOCK.(LOW)	;MAY NOT BE SAME
BMOVEMRANDV.CC	006353'	202003	000353'		MOVEM	0,RANDV.(C)	;SAVE REQUIRED BLOCK
BPUSHJPUSETC	006354'	260740	006276'		PUSHJ	P,USET		;SET ON THIS BLOCK
BPUSHPDC	006355'	261740	000004		PUSH	P,D		;GET A REGISTER
BSKIPNDHDRADDLOWC	006356'	336200	000074'		SKIPN	D,HDRADD(LOW)	;LINE BUFFER IN USE
BMOVEDMC	006357'	200200	000007		MOVE	D,M		;NO
BMOVEBLOCK.LOWC	006360'	200000	001761'		MOVE	0,BLOCK.(LOW)	;NUMBER OF BLOCK TO BE WRITTEN
BCAMGERLBNOCC	006361'	315003	000373'		CAMGE	0,RLBNO(C)	;IS IT THE LAST OR AFTER THE LAST BLOCK
BJRSTMOVNIC					JRST	[MOVNI	0,200	;NO. WRITE A FULL BUFFER
BJRSTRTPF1C	006362'	254000	007216'			JRST	RTPF1]
BPUSHJPSAVSIZC	006363'	260740	006403'		PUSHJ	P,SAVSIZ	;SAVE LAST BLOCK SIZE AND NUMBER
BMOVERLBSIZCC	006364'	200003	000413'		MOVE	0,RLBSIZ(C)	;GET NUMBER OF ELEMENTS TO BE WRITTEN
BTLNEIFIOF.C	006365'	603440	000100		TLNE	I,FIOF.		;IS IT A CHARACTER FILE
BJRSTPUSHPAC					JRST	[PUSH	P,A	;YES. CONVERT TO WORDS
BIDIVIC						IDIVI	0,5
BSKIPEAC						SKIPE	A	;ROUND UP TO FULL WORDS
BAOJC						AOJ	0,
BPOPPAC						POP	P,A
BJRSTC	006366'	254000	007220'			JRST	.+1]
BMOVNC	006367'	210000	000000		MOVN	0,0		;NEGATE NUMBER OF WORDS TO WRITE FOR IOWD
BRTPF1HRLC	006370'	504000	000000	RTPF1:	HRL	0,0		;WORD COUNT TO LEFT HALF
BHRRDC	006371'	540004	000000		HRR	0,(D)		;GET BUFFER ADDRESS
BADDIC	006372'	271000	000001		ADDI	0,1		;GET ADDRESS OF DATA-1
BMOVEMDMPIO.LOWC	006373'	202000	000000'		MOVEM	0,DMPIO.(LOW)	;STORE IOWD
BAOSBLOCK.LOWC	006374'	350000	001761'		AOS	BLOCK.(LOW)	;SET TO INPUT NEXT BLOCK
BPOPPDC	006375'	262740	000004		POP	P,D
BHLLMC	006376'	500000	000007		HLL	0,M		;CHAN. #
BHRRIDMPIO.LOWC	006377'	541000	000000'		HRRI	0,DMPIO.(LOW)	;POINT TO I/O LIST
BTLONOUTPTC	006400'	661000	067000		TLO	0,NOUTPT
BXCTC	006401'	256000	000000		XCT	0		;DO OUTPUT
BPJRSTCHKSTSC	006402'	254000	006416'		PJRST	CHKSTS		;CHECK STATUS
BC
BSAVSIZSKIPLRANBMCC	006403'	331003	000433'	SAVSIZ:	SKIPL	RANBM(C)	;IS BUFFER AN OUTPUT BUFFER
BPOPJPC	006404'	263740	000000		POPJ	P,		;NO. DON'T SAVE SIZE
BCAMERLBNOCC	006405'	312003	000373'		CAME	0,RLBNO(C)	;IS IT THE LAST BLOCK
BJRSTMOVEMRLBNOCC					JRST	[MOVEM	0,RLBNO(C)	;NO. SET NEW LAST BLOCK
BSETZMRLBSIZCC						SETZM	RLBSIZ(C)	;ASSUME NO WORDS IN NEW LAST BLOCK
BJRSTC	006406'	254000	007226'			JRST	.+1]
BMOVEIC	006407'	201000	000200		MOVEI	0,200		;IF BINARY, 200 WORDS/BLOCK
BTLNEIFIOF.C	006410'	603440	000100		TLNE	I,FIOF.		;IS IT SYMBOLIC
BMOVEIC	006411'	201000	001200		MOVEI	0,5*200		;YES. 5*200 CHARACTERS/BLOCK
BSUBDC	006412'	274004	000002		SUB	0,2(D)		;CALCULATE NUMBER OF ELEMENTS TO BE WRITTEN
BCAMLERLBSIZCC	006413'	313003	000413'		CAMLE	0,RLBSIZ(C)	;IS IT MORE THAN WAS PREVIOUSLY IB LAST BLOCK
BMOVEMRLBSIZCC	006414'	202003	000413'		MOVEM	0,RLBSIZ(C)	;YES. SET NEW VALUE
BPOPJPC	006415'	263740	000000		POPJ	P,
BC
BC				;HERE TO CHECK STATUS OF DUMP MODE I/O
BC
BCHKSTSPUSHPFC	006416'	261740	000006	CHKSTS:	PUSH	P,F		;SAVE F-USED FOR STATUS
BPUSHJPSTAT.C	006417'	260740	006215'		PUSHJ	P,STAT.		;GET STATUS
BCHKST1TRNEFIOWERRIODERRIOPERRIOBKTLIOTENDDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-66
FORSE.MAC	26-JUL-84 01:16		RANDOM ACCESS DUMP MODE INPUT/OUTPUT ROUTINES

BC	006420'	602300	742000	CHKST1:	TRNE	F,IOWERR!IODERR!IOPERR!IOBKTL!IOTEND
BERRORIOERR.C	006421'	260740	003745'		ERROR	IOERR.		;I/O ERRORS
BTRNNFIODENDC	006422'	606300	020000		TRNN	F,IODEND	;END OF FILE?
BPJRSTPOPFC	006423'	254000	003654'		PJRST	POPF		;NO RESTORE F AND RETURN
BMOVEBLOCK.LOWC	006424'	200000	001761'		MOVE	0,BLOCK.(LOW)	;GET THE NUMBER WE TRIED
BCAMNC	006425'	316000	007073'		CAMN	0,[-1]		;-1 IS SPECIAL
BJRSTGOTOM1C	006426'	254000	006440'		JRST	GOTOM1		;IT WAS
BJUMPGEIREOFTSC	006427'	325440	006436'		JUMPGE	I,REOFTS	;TRUE EOF IF INPUT
BSKIPLLEVEL.LOWC	006430'	331000	001766'		SKIPL	LEVEL.(LOW)	;HOPE ITS LEVEL D
BJRSTLCALOCC	006431'	254000	006457'		JRST	LCALOC		;NO SUCH LUCK
BPUSHJPZBUFRC	006432'	260740	006445'		PUSHJ	P,ZBUFR		;CLEAR BUFFER
BTRZFIODENDC	006433'	620300	020000		TRZ	F,IODEND	;CLEAR EOF
BPUSHJPSESTA.C	006434'	260740	006575'		PUSHJ	P,SESTA.	;IS STATUS WORD
BPJRSTPOPFC	006435'	254000	003654'		PJRST	POPF		;NO, ALL IS WELL
BREOFTSSETZMRANDV.CC	006436'	402003	000353'	REOFTS:	SETZM	RANDV.(C)	;CLEAR INCORE BLOCK # SINCE IT NEVER MADE IT
BJRSTEOFTS.C	006437'	254000	003760'		JRST	EOFTS. 		;AND GIVE UP
BC
BC				;HERE IF BLOCK # IS -1
BC
BGOTOM1PUSHJPZBUFRC	006440'	260740	006445'	GOTOM1:	PUSHJ	P,ZBUFR		;CLEAR BUFFER
BHRRZMRANDV.LOWC	006441'	552000	000353'		HRRZM	0,RANDV.(LOW)	;SET IN CORE BLOCK TO BE -1
BTRZFIODENDC	006442'	620300	020000		TRZ	F,IODEND	;CLEAR EOF
BPUSHJPSESTA.C	006443'	260740	006575'		PUSHJ	P,SESTA.	;IN STATUS WORD
BJRSTCHKST1C	006444'	254000	006420'		JRST	CHKST1		;RETURN
BC
BZBUFRPUSHPAC	006445'	261740	000001	ZBUFR:	PUSH	P,A		;NEED SOME ACCS
BPUSHPBC	006446'	261740	000002		PUSH	P,B
BHRRZBDMPIO.LOWC	006447'	550100	000000'		HRRZ	B,DMPIO.(LOW)	;ADDRESS OF DATA -1
BSETZMBC	006450'	402002	000001		SETZM	1(B)		;ZERO FIRST WORD
BHRLIABC	006451'	505042	000001		HRLI	A,1(B)		;FORM ALT WORD
BHRRIABC	006452'	541042	000002		HRRI	A,2(B)
BBLTABC	006453'	251042	000200		BLT	A,200(B)
BPOPPBC	006454'	262740	000002		POP	P,B		;RESTORE B
BPOPPAC	006455'	262740	000001		POP	P,A		;AND A
BPOPJPC	006456'	263740	000000		POPJ	P,
BC
BC				;HERE TO CREATE NEW FILE IF LEVEL C, A VERY SLOW LOOP 
BC
BLCALOCPUSHJPZBUFRC	006457'	260740	006445'	LCALOC:	PUSHJ	P,ZBUFR		;CLEAR BUFFER
BALOCMRPUSHJPUSETC	006460'	260740	006276'	ALOCMR:	PUSHJ	P,USET		;SET ON BLOCK WE NEED
BTLCC	006461'	641000	012000		TLC	0,012000	;USETO TO OUTPUT
BHRRIDMPIO.LOWC	006462'	541000	000000'		HRRI	0,DMPIO.(LOW)	;I/O LIST ADDRESS
BXCTC	006463'	256000	000000		XCT	0		;DUMP ONE BLOCK
BTRZFIODENDC	006464'	620300	020000		TRZ	F,IODEND	;CLEAR EOF
BPUSHJPSESTA.C	006465'	260740	006575'		PUSHJ	P,SESTA.	;IN STATUS WORD
BPUSHJPIUSETC	006466'	260740	006273'		PUSHJ	P,IUSET		;BACK ON BLOCK
BTLCC	006467'	641000	012000		TLC	0,012000	;USETI TO INPUT
BHRRIDMPIO.LOWC	006470'	541000	000000'		HRRI	0,DMPIO.(LOW)	;PUT ADDRESS BACK ALSO
BXCTC	006471'	256000	000000		XCT	0		;TRY INPUT
BPUSHJPSTAT.C	006472'	260740	006215'		PUSHJ	P,STAT.		;SEE IF WE WON
BTRNEFIOWERRIODERRIOPERRIOBKTLIOTENDC	006473'	602300	742000		TRNE	F,IOWERR!IODERR!IOPERR!IOBKTL!IOTEND
BERRORIOERR.C	006474'	260740	003745'		ERROR	IOERR.		;I/O ERRORS
BTRNEFIODENDC	006475'	602300	020000		TRNE	F,IODEND	;EOF STILL?
BJRSTALOCMRDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-67
FORSE.MAC	26-JUL-84 01:16		RANDOM ACCESS DUMP MODE INPUT/OUTPUT ROUTINES

BC	006476'	254000	006460'		JRST	ALOCMR		;NOT DONE YET
BJRSTCHKST1C	006477'	254000	006420'		JRST	CHKST1		;CONTINUE
BC
BC				;HERE TO SETUP FAKE BUFFER COUNT AND BYTE POINTER
BC
BFIXBFPUSHPDC	006500'	261740	000004	FIXBF:	PUSH	P,D		;GET AN ACC
BSKIPNDHDRADDLOWC	006501'	336200	000074'		SKIPN	D,HDRADD(LOW)	;LINE BUFFER IN USE?
BMOVEDMC	006502'	200200	000007		MOVE	D,M		;NO
BMOVEDC	006503'	200004	000001		MOVE	0,1(D)		;GET BYTE POINTER
BTLZC	006504'	621000	770077		TLZ	0,770077	;CLEAR OUT REST OR IT
BJUMPNC	006505'	326000	006507'		JUMPN	0,.+2		;IF NOT SET UP YET
BMOVSIPOINTC	006506'	205000	000700		MOVSI	0,(POINT 7,,35)	;ASSUME ASCII
BHRRDC	006507'	540004	000000		HRR	0,(D)		;GET ADDRESS
BADDIC	006510'	271000	000001		ADDI	0,1		;POINT TO DATA
BMOVEMDC	006511'	202004	000001		MOVEM	0,1(D)		;STORE BYTE POINTER
BMOVEBLOCK.LOWC	006512'	200000	001761'		MOVE	0,BLOCK.(LOW)	;CURRENT BLOCK
BCAMLRLBNOCC	006513'	311003	000373'		CAML	0,RLBNO(C)	;IS IT BEFORE THE LAST BLOCK ON INPUT
BJRSTPUSHJPSAVSIZC					JRST	[PUSHJ	P,SAVSIZ	;NO. SAVE LAST BLOCK INFO
BTLNEIIOF.C						TLNE	I,IOF.	;INPUT OR OUTPUT
BJRSTC						JRST	.+1	;OUTPUT. USE FULL BLOCK SIZE
BMOVERLBSIZCC						MOVE	0,RLBSIZ(C)	;INPUT. USE LAST BLOCK SIZE
BJRSTFIXBF1C	006514'	254000	007231'			JRST	FIXBF1]
BMOVEIC	006515'	201000	000200		MOVEI	0,200		;YES. SET FULL BUFFER ELEMENT COUNT
BTLNEIFIOF.C	006516'	603440	000100		TLNE	I,FIOF.		;SYMBOLIC FILE?
BMOVEIC	006517'	201000	001200		MOVEI	0,5*200		;YES
BFIXBF1MOVEMDC	006520'	202004	000002	FIXBF1:	MOVEM	0,2(D)		;STORE ELEMENT COUNT IN BUFFER HEADER
BMOVEMIRANBMCC	006521'	202443	000433'		MOVEM	I,RANBM(C)	;SAVE STATE OF BUFFER
BPOPPDC	006522'	262740	000004		POP	P,D
BPOPJPC	006523'	263740	000000		POPJ	P,
BRDWRSKIPLRANAC.LOWC	006524'	331000	001760'	RDWR:	SKIPL	RANAC.(LOW)	;RETURN IF RANDOM ACCESS
BTLNNIFIOF.C	006525'	607440	000100		TLNN	I,FIOF.		;FORMAT I/O?
BJRSTFTST0C	006526'	254000	005204'		JRST	FTST0		;NO,BINWR TAKES CARE OF THIS FOR BINARY
BTLNNNTTYFL.C	006527'	607700	000001		TLNN	N,TTYFL.	;TTY IS OK.
BTLNEINLIOF.STPFF.C	006530'	603440	002400		TLNE	I,NLIOF.!STPFF.	;NAMELIST OR TAPE FUNCTION?
BJRSTFTST0C	006531'	254000	005204'		JRST	FTST0		;YES,DON'T SET UP BUFFERS ETC
BTLNNEDSKBITMTABITC	006532'	607240	200020		TLNN	E,DSKBIT!MTABIT	;MTA?OR DSK?
BJRSTRDWRERC	006533'	254000	006573'		JRST	RDWRER		 ;NO,PRINT ERROR MESSAGE
BMOVEMC	006534'	200007	777777		MOVE	0,-1(M)		;GET NO OF CHARS.(LOW)
BMOVEMCHARS.LOWC	006535'	202000	001762'		MOVEM	0,CHARS.(LOW)	;STORE IT
BHRRZMC	006536'	550007	777776		HRRZ	0,-2(M)		;BYTE PTR
BHRRZBMC	006537'	550107	777775		HRRZ	B,-3(M)		;BUFFER PTR
BSUBBC	006540'	274000	000002		SUB	0,B		;GET NO WORDS USED
BSUBIC	006541'	275000	000002		SUBI	0,2		;MAKE UP FOR 3RD WORD & IN/OUT DIFFERENCES
BMOVEMWORDS.LOWC	006542'	202000	001763'		MOVEM	0,WORDS.(LOW)	;STORE IT
BSKIPGMC	006543'	337007	000000		SKIPG	(M)		;OUTPUT RING SETUP?
BPUSHJPOUTT.C	006544'	260740	006262'		PUSHJ	P,OUTT.		;NO DO DUMMY OUTPUT
BHRRZBMC	006545'	550127	000000		HRRZ	B,@(M)		;GET 2ND WD IN BUFFER
BHLRZBBC	006546'	554102	000000		HLRZ	B,(B)		;# WORDS IN THIS BUFFER
BHRRZDMC	006547'	550207	000000		HRRZ	D,(M)		;GET BUFFER ADDRESS
BADDMBDC	006550'	272100	000004		ADDM	B,D		;GET FINAL ADDRESS
BIFEREENTHRRMDBLOTZC	006551'	542200	006555'	IFE REENT,<HRRM	D,BLOTZ		;SET UP BLT>
BIFNREENTC				IFN REENT,<MOVSI 0,(BLT D,)
BC					HRR	0,D>
BHRLZDMDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-68
FORSE.MAC	26-JUL-84 01:16		RANDOM ACCESS DUMP MODE INPUT/OUTPUT ROUTINES

BC	006552'	514207	777775		HRLZ	D,-3(M)		;-FROM- INPUT BUFFER
BHRRDMC	006553'	540207	000000		HRR	D,(M)		;-TO-   OUTPUT BUFFER
BAOBJPDC	006554'	252200	006555'		AOBJP	D,.+1		;ST DATA WORD
BIFEREENTBLOTZBLTDC	006555'	251200	000000	IFE REENT,<BLOTZ: BLT	D,0	;***THIS INST GETS CHANGED, DO BLT>
BIFNREENTC				IFN REENT,<XCT	0>
BMOVECHARS.LOWC	006556'	200000	001762'		MOVE	0,CHARS.(LOW)	;PICK UP CHAR COUNT
BMOVEMMC	006557'	202007	000002		MOVEM	0,2(M)		;SET IT UP FOR OUTPUT
BHRRZMC	006560'	550007	000001		HRRZ	0,1(M)		;OUTPUR POINTER
BADDWORDS.LOWC	006561'	270000	001763'		ADD	0,WORDS.(LOW)	;SKIP OVER WORDS USED ALREADY
BHRRMMC	006562'	542007	000001		HRRM	0,1(M)		;SET UP OUTPUT POINTER
BTLNNIDDF.C	006563'	607440	000040		TLNN	I,DDF.		;DSK?
BJRSTMOVEIDC					JRST	[MOVEI	D,7	;BACKSPACE CODE
BPUSHJPFNCTN.C						PUSHJ	P,FNCTN.;NO,MTA. DO A BACKSPACE
BPUSHJPCLOSI.C						PUSHJ	P,CLOSI. ;CLOSE INPUT
BJRSTFTST2C	006564'	254000	007236'			JRST	FTST2]	;CONTINUE,SET UP LINE BUFFERS ETC.
BLDBDPOINTMC	006565'	135200	007077'		LDB	D,[POINT 4,M,12];CHANNEL NUMBER
BIFNREENTC				IFN REENT,<ADDI	D,(LOW)>
BMOVEINCNT.DC	006566'	200004	000273'		MOVE	0,INCNT.(D)	;GET COUNT OF # OF INPUTS DONE
BMOVEMBLOCK.LOWC	006567'	202000	001761'		MOVEM	0,BLOCK.(LOW)	;SET UP BLOCK#
BPUSHJPCLOSI.C	006570'	260740	006221'		PUSHJ	P,CLOSI.	;CLOSE INPUT
BPUSHJPUSETC	006571'	260740	006276'		PUSHJ	P,USET		;DO USETI ON 'BLOCK'
BJRSTFTST2C	006572'	254000	005211'		JRST	FTST2		;CONTINUE,SET UP LINE BUFFERS ETC
BC				;THE USER HAS ATTEMPTED TO CHANGE FROM READ TO WRITE WHILE DOING FORMATTED
BC				;I/O, BUT THE DEVICE CANNOT BE BACKSPACED AND THE OUTPUT MAY BE GARBELED
BC
BRDWRERTTCALLASCIZC				RDWRER:	TTCALL	3,[ASCIZ /
BC				WARNING! FORMATTED READ FOLLOWED BY WRITE MAY FAIL.
BC	006573'	051140	007242'	/]
BJRSTFTST0C	006574'	254000	005204'		JRST	FTST0		;CONTINUE
BSUBTTLC				SUBTTL	SET STATUS FOR CURRENT DEVICE
BC
BSESTA.HLLZMC	006575'	510000	000007	SESTA.:	HLLZ	0,M		;DEVICE NO.
BTLONSETSTFC	006576'	661000	060006		TLO	0,NSETST+F	;SET STATUS UUO
BXCTC	006577'	256000	000000		XCT	0
BPOPJPC	006600'	263740	000000		POPJ	P,
BC
BC				;I-O WAIT FOR CURRENT DEVICE
BC
BWAIT.HLLZMC	006601'	510000	000007	WAIT.:	HLLZ	0,M		;DEVICE NO.
BIORWAITC	006602'	434000	007256'		IOR	0,[WAIT]	;WAIT
BXCTC	006603'	256000	000000		XCT	0
BPOPJPC	006604'	263740	000000		POPJ	P,
BC				;DUMMY LOOKUP FOR CURRENT DEVICE-CLEARS SYSTEM CLOSE BIT
BC
BLOOK.HLLZMC	006605'	510000	000007	LOOK.:	HLLZ	0,M		;DEVICE NO.
BTLONLOKUPC	006606'	661000	076000		TLO	0,NLOKUP	;LOOKUP UUO
BXCTC	006607'	256000	000000		XCT	0
BJFCLC	006610'	255000	000000		JFCL			;ERROR RETURN
BPOPJPC	006611'	263740	000000		POPJ	P,
BSUBTTLC				SUBTTL	MAGTAPE ROUTINES
BC				; WE ARE ABOUT TO INIT A MAG TAPE UNIT
BC				; SEE IF MAGDEN HAS BEEN CALLED FOR THIS UNIT, IF SO SET
BC				; THE APPROPRIATE MODE BITS IN THE RIGHT HALF OF THE INIT.
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-69
FORSE.MAC	26-JUL-84 01:16		MAGTAPE ROUTINES

BC
BMGINITPUSHPGC	006612'	261740	000015	MGINIT:	PUSH	P,G		;SAVE
BPUSHPCC	006613'	261740	000003		PUSH	P,C		;AC'S
BPUSHPDC	006614'	261740	000004		PUSH	P,D		;G,C,D
BSETZDC	006615'	400200	000000		SETZ	D,		;INIT
BMOVEIGTABPT.LOWC	006616'	201640	001130'		MOVEI	G,TABPT.(LOW)	;POINTERS
BFINDLPMOVECGC	006617'	200155	000000	FINDLP:	MOVE	C,(G)		;GET A NAME
BTRZCC	006620'	620140	000077		TRZ	C,77		;CLEAR FLAG BITS
BCAMNCBC	006621'	316140	000002		CAMN	C,B		;IS IT THE ONE WE WANT?
BJRSTSETMODC	006622'	254000	006632'		JRST	SETMOD		;YES, GO SET MODE
BJUMPNCMGNDTSC	006623'	326140	006625'		JUMPN	C,MGNDTS	;NO, IS IT AN EMPTY SLOT?
BMOVEDGC	006624'	200200	000015		MOVE	D,G		;YES, SAVE POINTER
BMGNDTSSUBIGC	006625'	275640	000001	MGNDTS:	SUBI	G,1		;NO, DECREMENT POINTER AND
BCAIEGMBFBG.LOWC	006626'	302640	001120'		CAIE	G,MBFBG.(LOW)	;SEE IF DONE WITH TABLE
BJRSTFINDLPC	006627'	254000	006617'		JRST	FINDLP		;NOT DONE, GET NEXT NAME
BJUMPEDTBLER.C	006630'	322200	000000*		JUMPE	D,TBLER.	;IF NOT ENTERED & NO ROOM, FAIL!
BJRSTSETRETC	006631'	254000	006635'		JRST	SETRET		;RETURN
BSETMODLDBCPOINTGC	006632'	135140	007257'	SETMOD:	LDB	C,[POINT 6,(G),35]	;GET MODE BITS
BLSHCC	006633'	242140	000006		LSH	C,6		;POSITION THEM
BHRRMCINIT.LOWC	006634'	542140	001727'		HRRM	C,INIT.(LOW)	;PUT THEM IN INIT.
BSETRETMOVEICIOCONC	006635'	201140	000040	SETRET:	MOVEI	C,IOCON		;SYNC MODE BIT
BIORMCINIT.LOWC	006636'	436140	001727'		IORM	C,INIT.(LOW)	;SET SYNC MODE FOR INIT
BPOPPDC	006637'	262740	000004		POP	P,D		;RESTORE
BPOPPCC	006640'	262740	000003		POP	P,C		;AC'S D,C,G
BPOPPGC	006641'	262740	000015		POP	P,G
BPOPJPC	006642'	263740	000000		POPJ	P,		;RETURN
BC
BC				;THIS ROUTINE CONVERTS A NEG F4 DEV NUM TO A POS DEV NUM.
BC				;EXPECTS (0)=DEV NUM, RETURNS DEV NUM IN 0.
BC
BC
BMAKPOSCAMGC	006643'	317000	007136'	MAKPOS:	CAMG	0,[-6]		;LEGAL NUM?
BERRORILRED.C	006644'	260740	005065*		ERROR	ILRED.		;NO, PROBABLY "REREAD".
BADDIPOSTABC	006645'	271000	006655'		ADDI	0,POSTAB+5	;GET ADDRESS IN TABLE
BHRRZC	006646'	550020	000000		HRRZ	0,@0		;GET POSITIVE DEV. NUM. IN 0
BPOPJPC	006647'	263740	000000		POPJ	P,		;RETURN.
BC
BPOSTABEXPNEG5.C	006650'	000000	000000*	POSTAB:	EXP	NEG5.		;CDR
BEXPNEG1.C	006651'	000000	005045*		EXP	NEG1.		;TTY
BEXPNEG3.C	006652'	000000	000000*		EXP	NEG3.		;LPT
BEXPNEG2.C	006653'	000000	000000*		EXP	NEG2.		;PTP
BEXPNEG1.C	006654'	000000	006651*		EXP	NEG1.		;TTY
BSUBTTLC				SUBTTL	ROUTINES TO RE-USE OLD BUFFER SPACE
BC				;LINK.:	CONTAINS ADDRESS OF CHAIN OF BUFFERS (LEFT HALF)
BC				;BUFFERS CONTAIN XWD BACKWARDS LINK,, FORWARDS LINK
BC				;SET UP BY RELEAS SUBROUTINE
BC				;SECOND WORD IS RETURN FROM DEVSIZ UUO (NUMBER OF BUFFERS ,, SIZE OF BUFFER)
BC
BGETSPCPUSHPBC	006655'	261740	000002	GETSPC:	PUSH	P,B		;SAVE FOR FNDSPC RETURN
BPUSHJPFNDSPCC	006656'	260740	006667'		PUSHJ	P,FNDSPC	;CAN SPACE BE REUSED
BJRSTPOPPBC					JRST	[POP	P,B	;NO. LET I/O OPERATION GET SPACE
BPOPJPC	006657'	254000	007260'			POPJ	P,]
BPUSHP.JBFFC	006660'	261740	005346*		PUSH	P,.JBFF		;SAVE END OF MEMORY
BHRRZMB.JBFFDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-70
FORSE.MAC	26-JUL-84 01:16		ROUTINES TO RE-USE OLD BUFFER SPACE

BC	006661'	552100	006660*		HRRZM	B,.JBFF		;SET END OF MEMORY TO REUSABLE SPACE
BXCTC	006662'	256000	000000		XCT	0		;DO I/O OPERATION TO GET SPACE
BPOPP.JBFFC	006663'	262740	006661*		POP	P,.JBFF		;RESTORE END OF MEMORY
BPOPPBC	006664'	262740	000002		POP	P,B
BAOSPC	006665'	350017	000000		AOS	(P)		;SET SKIP RETURN
BPOPJPC	006666'	263740	000000		POPJ	P,		;RETURN
BC
BFNDSPCSKIPNLINK.LOWC	006667'	336000	000132'	FNDSPC:	SKIPN	LINK.(LOW)	;ANY SPACE TO RECOVER?
BPOPJPC	006670'	263740	000000		POPJ	P,		;NO, JUST RETURN
BPUSHPCC	006671'	261740	000003		PUSH	P,C
BLDBCPOINTMC	006672'	135140	007077'		LDB	C,[POINT 4,M,12];GET CHANNEL NUMBER
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BMOVECBUFSZ.CC	006673'	200143	000253'		MOVE	C,BUFSZ.(C)	;GET REQUIRED BUFFER SIZE AND NUMBER
BHLRZBLINK.LOWC	006674'	554100	000132'		HLRZ	B,LINK.(LOW)	;START OF CHAIN
BCAMNCBC	006675'	316142	000001		CAMN	C,1(B)		;WILL THIS SPACE DO
BJRSTGOTSPCC	006676'	254000	006703'		JRST	GOTSPC		;YES
BHRRZBBC	006677'	550102	000000		HRRZ	B,(B)		;TRY NEXT
BJUMPNBC	006700'	326100	006675'		JUMPN	B,.-3		;UNLESS FINISHED
BSPCRETPOPPCC	006701'	262740	000003	SPCRET:	POP	P,C		;RESTORE ACCS
BPOPJPC	006702'	263740	000000		POPJ	P,
BC
BGOTSPCPUSHPBC	006703'	261740	000002	GOTSPC:	PUSH	P,B		;SAVE REG FOR LINKING
BMOVEBBC	006704'	200102	000000		MOVE	B,(B)		;GET POINTER WORD
BTRNNBC	006705'	606100	777777		TRNN	B,-1		;LAST LINK IN CHAIN?
BJRSTHLRMBLINK.LOWC					JRST	[HLRM	B,LINK.(LOW)	;YES, BACKUP LINK.
BJRSTC	006706'	254000	007262'			JRST	.+2]		;SKIP NEXT INST
BHLLMBBC	006707'	502102	000000		HLLM	B,(B)		;REMOVE THIS SPACE FROM CHAIN
BMOVSSBC	006710'	207000	000002		MOVSS	B
BTRNNBC	006711'	606100	777777		TRNN	B,-1		;FIRST LINK IN CHAIN?
BJRSTHLLMBLINK.LOWC					JRST	[HLLM	B,LINK.(LOW)	;YES, ADVANCE LINK.
BTLNNBC						TLNN	B,-1		;ONLY WORD IN LINK.
BSETZMLINK.LOWC						SETZM	LINK.(LOW)	;YES
BJRSTC	006712'	254000	007264'			JRST	.+2]		;SKIP NEXT INST.
BHLRMBBC	006713'	546102	000000		HLRM	B,(B)		;BY REPLACING POINTERS
BAOSPC	006714'	350017	777776		AOS	-2(P)		;SET FOR SKIP RETURN
BPOPPBC	006715'	262740	000002		POP	P,B
BJRSTSPCRETC	006716'	254000	006701'		JRST	SPCRET		;AND RETURN
BC
BSUBTTLC				SUBTTL	BINARY ROUTINES
BC				;BINARY DATA TRANSMISSION
BC
BBINDT.AOSASVAR.LOWC	006717'	350000	001764'	BINDT.:	AOS	ASVAR.(LOW)	;INCREMENT WORD COUNT
BJUMPGEIBININC	006720'	325440	007017'		JUMPGE	I,BININ		;JUMP ON INPUT
BSKIPGMC	006721'	337007	000002		SKIPG	2(M)		;DO OUTPUT NOW?
BPUSHJPOUTPTC	006722'	260740	006733'		PUSHJ	P,OUTPT		;YES
BSKIPLRANAC.LOWC	006723'	331000	001760'		SKIPL	RANAC.(LOW)	;IS IT RANDOM OUTPUT
BJRSTBINDT1C	006724'	254000	006727'		JRST	BINDT1		;NO
BLDBCPOINTMC	006725'	135140	007077'		LDB	C,[POINT 4,M,12]	;GET CHANNEL NUMBER
BHRROSRANDV.CC	006726'	563003	000353'		HRROS	RANDV.(C)	;MARK AS NEEDS TO BE OUTPUTTED
BBINDT1MOVECDADDR.LOWC	006727'	200160	001335'	BINDT1:	MOVE	C,@DADDR.(LOW)	;DATA
BIDPBCMC	006730'	136147	000001		IDPB	C,1(M)		;DEPOSIT DATA
BSOSMC	006731'	370007	000002		SOS	2(M)		;DECREMENT COUNT
BJRSTIORTR.C	006732'	254000	002467'		JRST	IORTR.		;GET DATA OR FIN
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-71
FORSE.MAC	26-JUL-84 01:16		BINARY ROUTINES

BC				;BINARY OUTPUT
BC
BOUTPTPUSHJPOUTT.C	006733'	260740	006262'	OUTPT:	PUSHJ	P,OUTT.		;DO OUTPUT
BSKIPGERANAC.LOWC	006734'	335000	001760'		SKIPGE	RANAC.(LOW)	;ALREADY CHECKED IF RANDOM ACCESS
BPOPJPC	006735'	263740	000000		POPJ	P,		;YES
BPUSHJPSTAT.C	006736'	260740	006215'		PUSHJ	P,STAT.		;STATUS CHECK
BTRNEFIODERRIOPERRIOWERRIOTENDIOBKTLC	006737'	602300	742000		TRNE	F,IODERR!IOPERR!IOWERR!IOTEND!IOBKTL
BPUSHJPIOERR.C	006740'	260740	003745'		PUSHJ	P,IOERR.	;ERRORS
BPOPJPC	006741'	263740	000000		POPJ	P,
BC
BC				;BINARY TAPE INITIALIZATION BEFORE DATA
BC
BBINWR.SKIPGEMC	006742'	335007	000000	BINWR.:	SKIPGE	(M)		;CLOSE DONE LAST?
BJUMPLIC	006743'	321440	006745'		JUMPL	I,.+2		;OUTPUT?
BJRSTC	006744'	254000	006746'		JRST	.+2		;NO, NO
BPUSHJPOUTT.C	006745'	260740	006262'		PUSHJ	P,OUTT.		;DO DUMMY OUTPUT
BSKIPGERANAC.LOWC	006746'	335000	001760'		SKIPGE	RANAC.(LOW)	;RANDOM ACCESS?
BPUSHJPRANBINC	006747'	260740	006775'		PUSHJ	P,RANBIN	;YES SET UP BLOCK# ETC
BTLNEIPOSS.C	006750'	603440	100000		TLNE	I,POSS.		;IS IT THE POSITION STATEMENT
BJRSTFIB.C	006751'	254000	003464'		JRST	FIB.		;YES. NO IO REQUIRED
BPUSHJPBUFCA.C	006752'	260740	005322'		PUSHJ	P,BUFCA.	;GET BUFFER HEADER ADDRESS
BLDBAPOINTMC	006753'	135040	007077'		LDB	A,[POINT 4,M,12]	;GET CHAN #
BIFNREENTC				IFN REENT,<ADDI A,(LOW)		;LOW SEGMENT OFFSET>
BSKIPLPAKFL.AC	006754'	331001	000233'		SKIPL	PAKFL.(A)	;PACKED INPUT/OUTPUT LAST?
BJRSTSETPTRC	006755'	254000	006763'		JRST	SETPTR		;NO,GO DO BINARY READ/WRITE
BSETZMPAKFL.AC	006756'	402001	000233'		SETZM	PAKFL.(A)	;YES,RESET FLAG
BJUMPGEIBINPUC	006757'	325440	006762'		JUMPGE	I,BINPU		;SEE IF INPUT OR OUTPUT
BPUSHJPOUTT.C	006760'	260740	006262'		PUSHJ	P,OUTT.		;OUTPUT DONE LAST,FORCE OUTPUT
BJRSTSETPTRC	006761'	254000	006763'		JRST	SETPTR		;DON'T DO INPUT
BBINPUPUSHJPINPT.C	006762'	260740	007025'	BINPU:	PUSHJ	P,INPT.		;DO INPUT
BSETPTRLDBPOINTMC	006763'	135000	007202'	SETPTR:	LDB	0,[POINT 6,1(M),11]; GET POINTER SIZE
BCAINC	006764'	306000	000044		CAIN	0,44		;INIT AS BINARY?
BJRSTIORTR.C	006765'	254000	002467'		JRST	IORTR.		;YES
BMOVEIC	006766'	201000	004400		MOVEI	0,4400		;NO,SET UP POINTER
BHRLMMC	006767'	506007	000001		HRLM	0,1(M)		;POINTER
BMOVEMC	006770'	200007	000002		MOVE	0,2(M)		;ADJUST WORD COUNT
BJUMPEIORTR.C	006771'	322000	002467'		JUMPE	0,IORTR.	;JUMP IF NO ITEM COUNT
BIDIVIC	006772'	231000	000005		IDIVI	0,5
BMOVEMMC	006773'	202007	000002		MOVEM	0,2(M)		;RESTORE WORD COUNT
BJRSTIORTR.C	006774'	254000	002467'		JRST	IORTR.		;GET DATA
BC
BC				;CALCULATE BLOCK # WHERE BINARY RECORD STARTS. THIS IS FOR BINARY INPUT
BC
BRANBINMOVEAASVAR.LOWC	006775'	200040	001764'	RANBIN:	MOVE	A,ASVAR.(LOW)	;GET WORD #
BIDIVIAC	006776'	231040	000200		IDIVI	A,200		;GET BLOCK WHERE RECORD STARTS
BAOJAC	006777'	340040	000000		AOJ	A,		;POINT TO 1ST BLOCK OF RECORD
BMOVEMABLOCK.LOWC	007000'	202040	001761'		MOVEM	A,BLOCK.(LOW)	;STORE IT
BMOVEMBWORDS.LOWC	007001'	202100	001763'		MOVEM	B,WORDS.(LOW)	;SAVE WORDS FROM START OF BLOCK
BLDBCPOINTMC	007002'	135140	007077'		LDB	C,[POINT 4,M,12]
BIFNREENTC				IFN REENT,<ADDI	C,(LOW)>
BHRRZBRANDV.CC	007003'	550103	000353'		HRRZ	B,RANDV.(C)	;GET INCORE BLOCK
BCAMEBBLOCK.LOWC	007004'	312100	001761'		CAME	B,BLOCK.(LOW)	;IS IT THE ONE WE WANT?
BPUSHJPRINP.C	007005'	260740	006306'		PUSHJ	P,RINP.		;NO
BJUMPGEIDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-72
FORSE.MAC	26-JUL-84 01:16		BINARY ROUTINES

BC	007006'	325440	007011'		JUMPGE	I,.+3		;OUTPUT?
BTLNNIPOSS.C	007007'	607440	100000		TLNN	I,POSS.		;AND NOT POSITION STATEMENT
BHRROSRANDV.CC	007010'	563003	000353'		HRROS	RANDV.(C)	;YES, SIGNAL OUTPUT FOR THIS BLOCK
BPUSHJPFIXBFC	007011'	260740	006500'		PUSHJ	P,FIXBF		;RESET WORD COUNT AND BYTE POINTER
BMOVEAWORDS.LOWC	007012'	200040	001763'		MOVE	A,WORDS.(LOW)	;ADJUST BYTE POINTER AND COUNT
BADDMAMC	007013'	272047	000001		ADDM	A,1(M)
BSUBAMC	007014'	274047	000002		SUB	A,2(M)		;DECREMENT COUNT
BMOVNMAMC	007015'	212047	000002		MOVNM	A,2(M)
BPOPJPC	007016'	263740	000000		POPJ	P,
BC
BC				;BINARY DATA INPUT
BC
BBININSKIPGMC	007017'	337007	000002	BININ:	SKIPG	2(M)		;DROP WORD COUNT
BJRSTPUSHJPINPT.C					JRST	[PUSHJ	P,INPT.	;FILL BUFFER
BJRSTBININC	007020'	254000	007270'			JRST	BININ]	;SEE IF ANYTHING IN BUFFER
BSOSMC	007021'	370007	000002		SOS	2(M)		;DECREMENT WORD COUNT
BILDBCMC	007022'	134147	000001		ILDB	C,1(M)		;GET WORD
BMOVEMCDADDR.LOWC	007023'	202160	001335'		MOVEM	C,@DADDR.(LOW)	;STORE DATA
BJRSTIORTR.C	007024'	254000	002467'		JRST	IORTR.		;RETURN
BC
BC				;BINARY INPUT
BC
BINPT.PUSHJPINP.C	007025'	260740	006247'	INPT.:	PUSHJ	P,INP.		;DO INPUT
BSKIPGERANAC.LOWC	007026'	335000	001760'		SKIPGE	RANAC.(LOW)	;RANDOM ACCESS?
BPOPJPC	007027'	263740	000000		POPJ	P,		;YES, STATUS CHECKED ALREADY
BPUSHJPSTAT.C	007030'	260740	006215'		PUSHJ	P,STAT.		;DO STATUS CHECK
BTRNEFIODENDC	007031'	602300	020000		TRNE	F,IODEND
BJRSTEOFTS.C	007032'	254000	003760'		JRST	EOFTS.		;END OF FILE
BTRNEFIOTENDIODERRIOPERRIOBKTLC	007033'	602300	342000		TRNE	F,IOTEND!IODERR!IOPERR!IOBKTL
BERRORIOERR.C	007034'	260740	003745'		ERROR	IOERR.		;ERRORS
BPOPJPC	007035'	263740	000000		POPJ	P,
BC
BC				; CALLED BY: PUSHJ P,FNDSLT
BC				; FINDS AN AVAILABLE SLOT IN DYNDV.
BC				; BAD RETURN: TBLER.---DYNDV. IS REALLY FULL.
BC				; GOOD RETURN: (C)=THE NUMBER OF THIS CHANNEL,(D)=PTR TO SLOT IN DYNDV.
BC
BEXTERNJOBJDAJOBHCUC				        EXTERNAL        JOBJDA,JOBHCU         ;JOBDAT LOCATION JOBJDA(0-17) **
BFNDSLTMOVEIDDYNDV.LOWC	007036'	201200	000314'	FNDSLT:	MOVEI	D,DYNDV.+1(LOW)	;PTR TO FIRST USABLE SLOT
BIFN%352C				IFN %352,<
BC				SLLOP1:	MOVE	C,(D)
BC					TRZ	C,77		;CLEAR I/O BITS
BC					CAMN	C,DEVNAM(LOW)	;IS IT SAME DEVICE UNDER A DIFFERENT NUMBER?
BC					JRST	GOTSLT		;YES
BC					CAIGE	D,DYNND.(LOW)	;END OF LIST
BC					AOJA	D,SLLOP1	;NO.
BC					MOVEI	D,DYNDV.+1(LOW)	;NOT THERE, FIND A VACANCY>
BSLLOOPSKIPNDC	007037'	336004	000000	SLLOOP:	SKIPN	(D)		;IS SLOT EMPTY?
BC				; ** FIX FOR FORSE./IOCS CONFLICT WHILE LOOKING UP CHANNEL
BJRSTMOVEICDYNDV.LOWC				        JRST    [MOVEI C,DYNDV.(LOW)    ;C=OFFSET OF (D)
BSUBMDCC				                SUBM D,C        ;COMPUTE CHANNEL NUMBER FOR JOBJDA
BCAMGCJOBHCUC						CAMG C,JOBHCU	;SKIP IF IT IS GOOD
BSKIPNJOBJDACC				                SKIPN JOBJDA(C) ;SKIP IF THE CHANNEL IS BUSY
BJRSTGOTSLTDFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 1-73
FORSE.MAC	26-JUL-84 01:16		BINARY ROUTINES

BC				                JRST GOTSLT     ;CHANNEL IS FREE, GO TO IT
BJRSTC	007040'	254000	007272'	                JRST .+1]       ;CHANNEL IS NOT FREE, TRY NEXT CHANNEL
BCAIGEDDYNND.LOWC	007041'	305200	000332'		CAIGE	D,DYNND.(LOW)	;DONE?
BAOJADSLLOOPC	007042'	344200	007037'		AOJA	D,SLLOOP	;NO, LOOP BACK.
BERRORTBLER.C	007043'	260740	006630*		ERROR	TBLER.		;YES, FAIL!
BC
BGOTSLTC	007044'			GOTSLT: ; ** END OF FIX FOR FORSE./IOCS CONFLICT
BIFN%352C				IFN %352,<DPB	C,DYPNT.(LOW)	;MARK THE DEVICE ON THIS CHANNEL.
BC					SKIPE	(D)		;NEW DEVICE?
BC					JRST	[POP	P,(P)	;NO
BC						JRST	MATSET]>
BCAMLECDEVNO.LOWC	007044'	313140	000071'		CAMLE	C,DEVNO.(LOW)	;HIGHER THAN PREVIOUS NUMBER?
BMOVEMCDEVNO.LOWC	007045'	202140	000071'		MOVEM	C,DEVNO.(LOW)	;YES, UPDATE
BPOPJPC	007046'	263740	000000		POPJ	P,		;RETURN
BC
BXVARXWDVAR.VAR.C	007047'	000100	000100	XVAR:	XWD	VAR.,VAR.	;LENGTH OF PUSHDOWN LIST
BACBLTXWDBSAVEACBC	007050'	000002	000033'	ACBLT:	XWD	B,SAVEAC+B	;BLT POINTER FOR AC SAVE
BPTRUPOINTAC	007051'	270400	000001	PTRU:	POINT	4,A,12		;AC FIELD OF UUO
BFORZROSIXBITC	007052'	004657	622020	FORZRO:	SIXBIT	/ FOR00/
BENDC					END
BFORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84
FORSE.MAC	26-JUL-84 01:16		C
TYPFL.	UNDEFINED 
?6 ERRORS DETECTED
PROGRAM BREAK IS 007300
4K CORE USED
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 2
FORSE.MAC	26-JUL-84 01:16		SYMBOL TABLE

A		000001		CLSBIT		001516'		DIG		002415'		END.		000120'	INT
ACBLT		007050'		CNVT		002714'		DIGPTR		001723'		ENDLN.		003361'	INT
AEIOU		002622'		CO		003131'		DIRBIT		000004	SPD	ENDLN1		003376'	
AEIOU1		002623'		CO1		003142'		DISAB.		003563'	INT	ENDTP.		003756'	EXT
ALOCMR		006460'		COMA		002634'		DISENB		003570'		ENDTST		003542'	
ALPHA.		000071'		COMMA		002641'		DISTAB		003070'		EOFFL.		000213'	INT
AROPN.		004241'	EXT	COMMA1		002653'		DLB		003227'		EOFTS.		003760'	INT
ASSCON		400000	SPD	CORE	047000	000011		DLB1		003245'		EOL.		001334'	INT
ASSFL.		001000	SPD	CPOPJ		003335'		DLB2		003266'		ERR.		000121'	INT
ASVAR.		001764'	INT	CR		000015	SPD	DLB3		003267'		ERRCT.		001754'	INT
AVABIT		000040	SPD	CRDBIT		100000	SPD	DLB4		003256'		ERRIN.		002132'	EXT
B		000002		CRTN		003423'		DMPBIT		040000	SPD	ERRLN.		000020	SIN
BFDONE		004714'		CRTN1		003410'		DMPIO.		000000'		ERRMX.		001752'	INT
BINDT.		006717'		D		000004		DNAME		001477'		ERROR	260740	000000	
BINDT1		006727'		D0		002316'		DOINP		003623'		ERROR.		003120'	EXT
BININ		007017'		D1		002334'		DOINP1		003636'		ERROR1		003120'	
BINPU		006762'		DADDR.		001335'		DOLFL.		000004	SPD	ERRTB.		001732'	INT
BINWR.		006742'	ENT	DATA		002664'		DOLSGN		002616'		ERRTST		003534'	
BLOCK.		001761'	INT	DATA.	020000	000000		DONMTA		004514'		ESC		000175	SPD
BLOTZ		006555'		DATA1		002667'		DPSF.		000020	SPD	ESCCHN		000002	SPD
BPHSE.		000000	EXT	DATTB.		001131'	INT	DQ		000042	SPD	ESCCLR		000123'	
BTLER.		003754'	EXT	DAYTM.		001753'	INT	DSESC.		000122'	INT	ESCFIN		003777'	
BUFCA.		005322'	INT	DBLQTE		002563'		DSKBIT		200000	SPD	ET		002571'	
BUFER.		005370'	EXT	DCONV		002637'		DSKSIZ		004435'		ETYP.		400000	SPD
BUFHD.		001336'	INT	DDF.		000040	SPD	DSKSZ0		004443'		EXIT	047000	000012	
BUFST		003427'		DEBUG.		002103'	EXT	DTYP.		100000	SPD	EXITP.		002135'	EXT
BUFSZ.		000253'		DEC		005530'		DUMER.		007072'	EXT	F		000006	
C		000003		DEC.	033000	000000		DVF		005137'		FCALL.	035000	000000	
CDSFL.		000002	SPD	DECENC		005536'		DVNUM.		000113'	INT	FCALL0		004462'	
CHAIN.		002177'	SEX	DECERR		003656'		DVTOT.		005043'	EXT	FCALL1		004467'	
CHARS.		001762'		DECFLG		000107'		DYCHR.		001776'	INT	FCALL2		004460'	
CHECK		002745'		DECHDR		001116'		DYDVL.		000020	SIN	FCALL3		004456'	
CHINN.		003601'	INT	DECPT		002425'		DYEND.		002006'	INT	FCALLI		004447'	
CHINNN		003577'		DECREL		000000	SPD	DYNCH.		000333'	INT	FCF.		000200	SPD
CHKCLS		004530'		DECSPE		000032	SPD	DYNDV.		000313'	INT	FCM		006031'	
CHKOT1		004707'		DEFALT		005200'		DYNND.		000332'	INT	FCM1.		006044'	INT
CHKST1		006420'		DELIM.		001726'	INT	DYPNT.		001773'	INT	FCM2		006050'	
CHKSTS		006416'		DEPOT.		003121'	INT	E		000005		FCM3		006077'	
CHN.	013000	000000		DEPOT1		003126'		ECONV		002636'		FF		000014	SPD
CHNIN.		002141'	SEX	DEVCHR	047000	000004		EDERR		000105'		FI.		003506'	INT
CKDVEQ		005261'		DEVER.		005046'	EXT	EDERRM		005553'		FI2		003500'	
CKDVQ1		005265'		DEVFND		005111'		EDFIN		003770'		FIB.		003464'	
CKDVQ2		005270'		DEVIC.		001476'	INT	EDMESS		005545'		FIDL1		005026'	
CLOS.		006231'	INT	DEVNAM		001502'		ENAB.		003566'	INT	FIDLDV		005006'	
CLOSI.		006221'	INT	DEVND.		005056'	EXT	ENC		005524'		FIEND		003465'	
CLOSI1		006243'		DEVNO.		000071'	INT	ENC.	034000	000000		FILE1.		000613'	INT
CLOSO1		006237'		DEVSIZ	047000	000101		ENCEN1		003673'		FILE2.		000653'	INT
CLRBFI	051440	000000		DEVTB.		005061'	EXT	ENCEND		003664'		FILE3.		000713'	INT
CLRBFO	051500	000000		DEVTYP	047000	000053		ENCFL.		000040	SPD	FILE4.		000753'	INT
CLRBFZ		004770'		DF.		000001	SPD	ENCHDR		001113'		FILE5.		001013'	INT
CLRMTA		004505'		DFLBIT		200000	SPD	ENCLND		003342'		FILNUM		000131'	
CLROU.		006204'	INT	DFLDEV		004166'		ENCOU1		003344'		FILPS.		000453'	INT
CLRSY.		006211'	INT	DFLFL.		000400	SPD	ENCOUT		003336'		FILSZ.		000513'	INT
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 2-2
FORSE.MAC	26-JUL-84 01:16		SYMBOL TABLE

FIN		003450'		GETSPC		006655'		IORTR.		002467'	INT	MAKPOS		006643'	
FIN.	021000	000000		GETTAB	047000	000041		IOTEND		002000	SPD	MATFND		004233'	
FIN1		003453'		GOTCOR		004746'		IOWERR		400000	SPD	MATNFD		004232'	
FINDLP		006617'		GOTOM1		006440'		IRTAB		003056'		MBFBG.		001120'	SIN
FINFL.	777777	777777	SPD	GOTSLT		007044'		ITMCNT		001765'		MGINIT		006612'	
FINUX		002065'		GOTSPC		006703'		IUSET		006273'		MGNDTS		006625'	
FIOF.		000100	SPD	GRPRPT		001724'		J		000012		MI		003326'	
FIXBF		006500'		GTYP.		200000	SPD	JOBHCU		007274'	EXT	MOVUUO		003772'	
FIXBF1		006520'		H		000010		JOBJDA		007275'	EXT	MSNG.		006163'	EXT
FKNFL.		000200	SPD	HDPB		002530'		JSB		005307'		MSP		002500'	
FLADD	110000	000000		HDRADD		000074'		JTABU		002221'		MTABF.		001121'	INT
FLDIV	113000	000000		HINDPB		002554'		K		000013		MTABIT		000020	SPD
FLIST		005601'		HINPT		002533'		KA10		000000	SPD	MTANUM		000010	SPD
FLIST.	007000	000000		HIO		002514'		KA10.		001767'	INT	MTOP.	024000	000000	
FLMUL	112000	000000		HLDB		002522'		KI10		000001	SPD	MTPZ.		006172'	INT
FLNAM		005710'		HRS		002366'		L		000014		N		000016	
FMTBG.		001333'	INT	HRS1		002773'		LASTBF		004764'		NAMEL		005504'	
FMTEN.		001332'	INT	I		000011		LASTLP		001331'		NAS		002775'	
FMTER.		002405'	EXT	IIB.		003637'	INT	LBCRCK		003147'		NASBAK		002471'	
FMTOUT		002315'		ILLCH.		002746'	EXT	LBPTR		000002'		NCLOSE		070000	SPD
FNCTN.		006167'	INT	ILLEG.		000073'	INT	LBXCD		003215'		NEG1.		006654'	EXT
FNDSLT		007036'		ILLFN.		006012'	EXT	LCALOC		006457'		NEG2.		006653'	EXT
FNDSPC		006667'		ILLMG.		000000	EXT	LDEVC1		004421'		NEG3.		006652'	EXT
FNDTTY		004250'		ILLPS.		005221'	EXT	LDEVCH		004412'		NEG5.		006650'	EXT
FNM		005565'		ILRED.		006644'	EXT	LENGTH		000024	SPD	NEGNUM		004277'	
FNM.		000115'	INT	ILUUO.		004451'	EXT	LESCOR		004776'		NEGSC		002502'	
FNM.	010000	000000		IN		002400'		LEVEL.		001766'	INT	NFI		004154'	
FNMCHK		006002'		IN.	016000	000000		LF		000012	SPD	NFI1		004211'	
FNMCHR		006021'		IN2		002407'		LINBUF		001517'		NFI2		004255'	
FNMCNT		000116'		INCNT.		000273'	INT	LINCH		001177	SPD	NFI3		004266'	
FNMNBK		006014'		INF		005456'		LINEN1		003443'		NINBUF		064000	SPD
FOBPDP		000003'	INT	INF.	026000	000000		LINEND		003442'		NINPUT		066000	SPD
FORESC		003547'		INIACT		002160'	SEX	LINHDR		001717'		NLI		005500'	
FORSE.		000000'	ENT	INIER.		004345'	EXT	LINK.		000132'	INT	NLI.	031000	000000	
FORTRU		003556'		INIFLG		000072'		LINK1		004611'		NLIOF.		002000	SPD
FORZRO		007052'		INIT.		001727'	INT	LINK2		004617'		NLO		005502'	
FRPTC.		001725'		INP		004145'		LINK3		004625'		NLO.	032000	000000	
FRSTCH		003301'		INP.		006247'	INT	LINK4		004630'		NLOKUP		076000	SPD
FRSTM.		002143'	EXT	INPDEV		000110'		LINK5		004632'		NMLST.		005506'	EXT
FTST0		005204'		INPDV.		000112'	INT	LINK6		004637'		NMTAPE		072000	SPD
FTST1		005202'		INPT.		007025'	INT	LINK7		004640'		NOCORE		005005'	
FTST2		005211'		INTAB.		000000	EXT	LINK8		004650'		NOINDX		002060'	
FTST3		005224'		INTENB	047000	777744		LINKUP		004600'		NOLOK1		003334'	
FTST4		005232'		IOADR.		002632'	EXT	LINWDS		000200	SPD	NOROM.		006101'	EXT
FTST5		005163'		IOBKTL		040000	SPD	LISTB.		000000	EXT	NOTGTY		002724'	
FX2ASC		005431'		IOCON		000040	SPD	LNKBUF		004565'		NOTSP1		004401'	
FXDRET		005444'		IODEND		020000	SPD	LNKUP1		004603'		NOTSPL		004363'	
FXMODE		005373'		IODERR		200000	SPD	LOGEN.		007133'	EXT	NOTTL		003377'	
G		000015		IOERR.		003745'	INT	LOOK.		006605'	INT	NOUBUF		065000	SPD
GCONV		002621'		IOF.		400000	SPD	LOW		000000		NOUTPT		067000	SPD
GETAC		002341'		IOK		003605'		LPTBIT		040000	SPD	NRES		002162'	
GETCOR		004772'		IOPERR		100000	SPD	LSTBYT		000001	SPD	NRMEM.		001515'	
GETDV.		005042'	INT	IORET		002312'		M		000007		NRMESC		000126'	
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 2-3
FORSE.MAC	26-JUL-84 01:16		SYMBOL TABLE

NRMTRU		000127'		PARG		002474'		RESET.	015000	000000		SFMTFL		004147'	
NSETST		060000	SPD	PARL		002457'		RETCR		003743'		SFSF.		200000	SPD
NUSETI		074000	SPD	PARLF		002432'		RETRY		006126'		SIZF.		020000	SPD
NUSETO		075000	SPD	PARLF0		002444'		RETRY1		006153'		SL		000017	SPD
NXRINP		006305'		PARLF1		002446'		RETRY2		006137'		SLASH		002505'	
NXROUT		006337'		PARLF2		002445'		RETRY3		006162'		SLIOF.		010000	SPD
NXTBUF		004756'		PARR		002450'		RFCM		006105'		SLISB0		003010'	
NXTCR		003675'		PAT.		002006'		RFCMO		006110'		SLISB1		003015'	
NXTCR.		003702'	INT	PDERR		004203'		RIN.		002375'	INT	SLISB2		003016'	
NXTCR1		003706'		PDLST.		000004'	INT	RINC1		001513'		SLISB4		003033'	
NXTCT.		002146'	EXT	PDP6		000000	SPD	RINC2		001514'		SLISB5		003036'	
NXTFL.		002142'	EXT	PIO		002610'		RINP.		006306'		SLIST		002752'	
NXTLN.		003712'	INT	PJRST	254000	000000		RINP1		006315'		SLIST.	025000	000000	
NXTLN1		003721'		POPA		003332'		RINPF		006322'		SLIST1		002755'	
NXTLN2		003732'		POPC		006320'		RLBNO		000373'		SLISTB		003002'	
OENTER		006067'		POPF		003654'		RLBSIZ		000413'		SLLOOP		007037'	
OMEGA.		002041'	SPD	POS.	012000	000000		RLEN.		000117'	INT	SMTTY.		004000	SPD
ONLY1.		000173'	INT	POSDEV		004170'		RLMN1		004675'		SNGLB1		005350'	
OPCM		005635'		POSF.		040000	SPD	ROUTP.		006340'		SNGLBF		005335'	
OPCM1		005727'		POSS		005556'		ROUTP1		006316'		SOSO		002734'	
OPCM10		005665'		POSS.		100000	SPD	ROUTPF		006351'		SPCRET		006701'	
OPCM11		005671'		POSTAB		006650'		RPF.		000002	SPD	SPLBIT		100000	SPD
OPCM2		005736'		PPN		003436'		RPTR1		001507'		SPLFL.		000100	SPD
OPCM3		005740'		PTRTAB		003047'		RPTR2		001510'		SQF.		001000	SPD
OPCM4		005745'		PTRU		007051'		RRBBW		005520'		SQUOTE		002512'	
OPCM41		005757'		Q		000016		RRDFL.		000010	SPD	STAT.		006215'	INT
OPCM5		005766'		RANAC.		001760'	INT	RRF.		000010	SPD	STL.	014000	000000	
OPCM6		005771'		RANASC		002252'		RTB		005511'		STLF		003151'	
OPCM9		006000'		RANBIN		006775'		RTB.	022000	000000		STLF1		003166'	
OPCME		006010'		RANBM		000433'		RTNF.		100000	SPD	STLF2		003156'	
OPDV.		002000	SPD	RANDV.		000353'	INT	RTNSET		002627'		STLF3		003201'	
OPE.	011000	000000		RANER.		004330'	EXT	RTPF1		006370'		STLF4		003176'	
OPEN.		004344'		RCNT1		001511'		RWERR		004055'		STPFF.		000400	SPD
OPENF		005613'		RCNT2		001512'		SAVDN2		005075'		SXBTNO		000130'	
OPF.		004000	SPD	RDWFL.		000020	SPD	SAVDNM		005064'		TABLE		003347'	
OPNABT		004536'		RDWR		006524'		SAVEAC		000031'	INT	TABP1.		001131'	SIN
OPNDEV		000114'		RDWRER		006573'		SAVFAC		000051'	INT	TABPT.		001130'	SPD
OUT.	017000	000000		RECNO.		001757'	INT	SAVPTR		005273'		TABU		002223'	
OUTCHR	051040	000000		REDER.		003746'	EXT	SAVSCN		001722'		TBLER.		007043'	EXT
OUTCNV		002741'		REE.		001774'	INT	SAVSIZ		006403'		TCNT1.		001505'	INT
OUTF		005454'		REENT		000000	SPD	SESTA.		006575'	INT	TCNT2.		001506'	INT
OUTF.	027000	000000		REL		002110'		SETBFS		004677'		TEMP.		000075'	INT
OUTOK		003271'		RELES		004472'		SETMOD		006632'		TERMF.		010000	SPD
OUTP		004143'		RELFL.		002000	SPD	SETNAM		005254'		TFB		002707'	
OUTPT		006733'		RELI		004155'		SETOU.		006176'	INT	TFB3		002712'	
OUTSTR	051140	000000		RELMEM		004661'		SETOU1		006202'		TFBF.		000004	SPD
OUTT.		006262'	INT	REOFTS		006436'		SETPPN		005176'		TFBM3		002704'	
OVCNT.		001771'	INT	RERDN.		001501'		SETPTR		006763'		TFF.		020000	SPD
OVFLS.		000111'	INT	RERDV.		001500'	INT	SETRET		006635'		TFMT.		002643'	EXT
OVPC.		001770'	INT	REREAD		005472'		SETRW		004013'		TIO		002615'	
P		000017		RERED.	030000	000000		SETTYP		004001'		TNAME.		000133'	INT
PAKFL.		000233'		RERTN		002074'		SETUP1		004716'		TPFCN.		005214'	EXT
PARER.		003750'	EXT	RESET	047000	000000		SETUPB		004740'		TPNTR.		001504'	INT
FORSE. 	 FORTRAN IV OPERATING SYSTEM 	MACRO 12.5-46.0 01:18 26-JUL-84 PAGE 2-4
FORSE.MAC	26-JUL-84 01:16		SYMBOL TABLE

TRAPF.		000124'	INT	ZBUFR		006445'		
TRPFL.		002144'	EXT	ZE		003327'		
TRPIN.		002133'	EXT	ZZZ		000010	SPD	
TRPLOC		000125'		%352		000000	SPD	
TRUCHN		000001	SPD	.JBFF		006663'	EXT	
TRYAGN		004742'		.JBREL		005343'	EXT	
TSTBLK		002263'		.JBREN		002137'	EXT	
TTYBIT		000010	SPD	.JBUUO		002202'	EXT	
TTYCH.		001772'		.TYSPL		000020	SPD	
TTYFL.		000001	SIN	
TTYUN.		001053'		
TYMREL		000074	SPD	
TYMSPE		000002	SPD	
TYPCHN		004063'		
TYPE.		001503'	INT	
TYPERR		004033'		
TYPFL.		004546'	UXT	
TYPMS1		004065'		
TYPMS2		004100'		
TYPMS3		004113'		
TYPMS4		004127'		
TYPMSG		004040'		
UNITC.		000553'	INT	
USEDSK		005102'		
USEOPN		005104'		
USEOTH		005105'		
USET		006276'		
USETI.		006273'	INT	
USETIO		006300'		
USETO.		006276'	INT	
USETTY		005107'		
USRNAM		000103'		
USRTTY		020000	SPD	
UUOFL.		400000	SPD	
UUOH.		002076'	INT	
UUOL.		002072'	INT	
UXIT.		002042'		
VADDR.		000106'	INT	
VAR.		000100	SIN	
VARPDP		001231'		
VT		000013	SPD	
WAIT	047000	000010		
WAIT.		006601'	INT	
WDPREC		001756'		
WLKER.		003752'	EXT	
WORDS.		001763'		
WTB		005510'		
WTB.	023000	000000		
XCTTM.		001755'	INT	
    U